                                                                                                                                                                                                      Printed by Andreas
 Nov 10, 09 8:32                                      mc.pic                               Page 1/79            Nov 10, 09 8:32                                   mc.pic                                    Page 2/79
  1    ;##############################################################################                          81    ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  2    ;DDS−VFO fuer alle Baender.                                                                              82             __CONFIG _CONFIG1H, _HS_OSC_1H                                 ;HS oscillator
  3    ;                                                                                                        83    ;          __CONFIG _CONFIG2L, _PWRT_ON_2L & _BOR_ON_2L & _BORV_42_2L   ;Reset
  4    ;16.6.2008                                                                                               84             __CONFIG _CONFIG2L, _PWRT_OFF_2L & _BOR_OFF_2L & _BORV_42_2L   ;Reset
  5    ;(c) DL4JAL                                                                                              85             __CONFIG _CONFIG2H, _WDT_OFF_2H                                ;Watchdog timer disabled
  6    ;##############################################################################                          86              __CONFIG _CONFIG3H, _CCP2MX_ON_3H                             ;CCP2 to RC1 (rather than
  7    ;History                                                                                                         to RB3)
  8    ;13.7.2008                                                                                               87              __CONFIG _CONFIG4L, _LVP_OFF_4L                               ;RB5 enabled for I/O
  9    ;HW zum testen aufgebaut                                                                                 88    ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  10   ;30.7 Interrupt Timer2 aktiviert fuer Keyer                                                              89              endif
  11   ;03.01.09 Setup erweitert alle ZF                                                                        90    ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  12   ;23.07.09 Umstellung von PIC18F452 auf PIC18F4520                                                        91
  13   ;          Version auf 1.02 erhoeht                                                                      92    ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  14   ;          Variantenumschaltung konstruiert                                                              93            if      bytevariante >= .21     ;alle Varianten mit PIC18F4520
  15   ;                                                                                                        94    ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  16   ;01.09.09 neu V1.03                                                                                      95        __CONFIG _CONFIG1H, _OSC_HS_1H & _FCMEN_OFF_1H & _IESO_OFF_1H
  17   ;Fehler in Routine "ad9951_frq32bit_to_dds" Zeile 3673                                                   96        __CONFIG _CONFIG2L, _PWRT_OFF_2L & _BOREN_OFF_2L & _BORV_3_2L
  18   ;                                                                                                        97        __CONFIG _CONFIG2H, _WDT_OFF_2H & _WDTPS_1_2H
  19   ;02.09.09 neu V1.04                                                                                      98        __CONFIG _CONFIG3H, _CCP2MX_PORTC_3H & _PBADEN_OFF_3H & _LPT1OSC_OFF_3H & _MCLRE_OFF_3H
  20   ;Fehler bei Funktion 100kHz; geloest                                                                     99        __CONFIG _CONFIG4L, _STVREN_OFF_4L & _LVP_OFF_4L & _XINST_OFF_4L & _DEBUG_OFF_4L
  21   ;SW: Setup 23,24 hinzugekommen. Speichern und Abrufen der Konfiguration im Flash                         100       __CONFIG _CONFIG5L, _CP0_OFF_5L & _CP1_OFF_5L & _CP2_OFF_5L & _CP3_OFF_5L
  22   ;es gibt 4 Speicherplaetze fuer die Konfiguration und die Default−Konfiguration                          101       __CONFIG _CONFIG5H, _CPB_OFF_5H & _CPD_OFF_5H
  23   ;Setup 24 kann auch durch PowerON+Taste1 aufgerufen werden                                               102       __CONFIG _CONFIG6L, _WRT0_OFF_6L & _WRT1_OFF_6L & _WRT2_OFF_6L & _WRT3_OFF_6L
  24   ;                                                                                                        103       __CONFIG _CONFIG6H, _WRTC_OFF_6H & _WRTB_OFF_6H & _WRTD_OFF_6H
  25   ;04.09.09 neu V1.05                                                                                      104       __CONFIG _CONFIG7L, _EBTR0_OFF_7L & _EBTR1_OFF_7L & _EBTR2_OFF_7L & _EBTR3_OFF_7L
  26   ;Eeprom Auffrischungsroutine hinzugefuegt;                                                               105       __CONFIG _CONFIG7H, _EBTRB_OFF_7H
  27   ;wurde MT aktiviert kann jetzt mit jeder Taste deaktiviert werden ohne eine                              106   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  28   ;Funktion auszuloesen;                                                                                   107           endif
  29   ;                                                                                                        108   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  30   ;06.09.09 neu V1.06                                                                                      109
  31   ;bei txpermzf==0 nur bei CW und CWr keine ZF−Berechnung, alles ander ist bei TX mit ZF                   110
  32   ;bei ZF 9MHz VFO unterhalb und RX 3,5MHz schwingt VFO auf 5,5MHz, das wird jetzt erkannt                 111   ;;;;;;; Variables ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  33   ; RX−Frq 3,5 minus ZF 9,0 = (−)5,5MHz ;wird in Absolutwert gewandelt                                     112   var     udata_acs 0x000                         ;Beginning of Access RAM
  34   ;BUG in MODE−Erkennung bei RX−ZF=VFO                                                                     113
  35   ;                                                                                                        114   W_TEMP:                 res     1       ;variable used for context saving
  36   ;23.09.09 neu V1.07                                                                                      115   STATUS_TEMP:            res     1       ;variable used for context saving
  37   ;BUG im Setup ZF−Zuordnung pro Mode                                                                      116   BSR_TEMP:               res     1       ;variable used for context saving
  38   ;                                                                                                        117   FSR0L_TEMP:             res     1       ;variable used for context saving
  39   ;08.11.09 neu V1.08                                                                                      118   FSR0H_TEMP:             res     1       ;variable used for context saving
  40   ;aendern Mode DIGr in FM: Varinate 3 und 23                                                              119   data_ee_addr:           res     1       ;Zwischenspeicher interne Eepromadr
  41   ;beim Einschalten von der RIT werden VFO−Freqeuenzen gemerkt und beim Ausschalten                        120   data_ee_data:           res     1       ;Zwischenspeicher interne Eepromdaten
  42   ;wieder hergestellt.                                                                                     121   LCDByte:                res     1       ;Zwischenspeicher fuer LCD−Ausgabe
  43   ;Wird VFOx4 aktiv wird kein Mode im Display dargestellt sondern "MHz"                                    122   LCDByte2:               res     1       ;Zwischenspeicher fuer Stringausgabe
  44   ;Keyerpotiabfrage bei Handtastung abschalten                                                             123
  45   ;                                                                                                        124   ramanfang:              res     0       ;
  46   ;;;;;;; Assembler directives ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                          125   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
  47                                                                                                            126   ;dieser Bereich haengt zusammen im Eeprom Beginn
  48   ;          list   P=18f452, F=INHX32, C=160, N=0, ST=ON, MM=ON, X=ON                                     127   ddskonst:               res     5       ;Quarzoszikonstande
  49                                                                                                            128   step:                   res     1       ;Schrittweite 0=1Hz 1=10Hz 2=50Hz 3=1000Hz
  50   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          129   band:                   res     1       ;Band 160 − 2m = 0 − 11
  51   ;bytevariante: equ      .1      ;Variante PIC18F452 englisch                                             130   flag1:                  res     1       ;Verschiedene Flags die mit im Eeprom gespeichert werden
  52   ;bytevariante: equ      .2      ;Variante PIC18F452 deutsch                                              131   ddstype                 res     1       ;ddstype 0=ad9833/34 1=ad9850 2=ad9851 3=ad9951x4 4=ad995
  53   ;bytevariante: equ      .3      ;Variante PIC18F452 deutsch FM an Stelle DIr                                   1x5
  54   ;bytevariante: equ      .21     ;Variante PIC18F4520 englisch                                            132                                           ;5=ad9951x20 6=ad9951x1
  55   ;bytevariante: equ      .22     ;Variante PIC18F4520 deutsch                                             133   stimer                  res     1       ;Timer fuer verzoegert Sender AUS
  56   bytevariante:   equ     .23     ;Variante PIC18F4520 deutsch FM an Stelle DIr                            134   ;dieser Bereich haengt zusammen im Eeprom Ende
  57   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          135   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
  58                                                                                                            136   zwischenfrequenz:       res     4       ;Frequenz ZF
  59   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          137   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
  60           if      bytevariante >= .21     ;alle Varianten mit PIC18F4520                                   138   ;dieser Bereich haengt zusammen im Eeprom Beginn
  61   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          139   frequenza:              res     5       ;Frequenz VFO−A
  62   #include        p18f4520.inc                                                                             140   frequenzb:              res     5       ;Frequenz VFO−B
  63   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          141   modeA:                  res     1       ;
  64           endif                                                                                            142   modeB:                  res     1       ;
  65   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          143   lcdoffset:              res     5       ;Displayoffset
  66   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          144   ;dieser Bereich haengt zusammen im Eeprom Ende
  67           if      bytevariante < .21      ;alle Varianten mit PIC18F452                                    145   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
  68   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          146   flag2:                  res     1       ;Verschiedene Flags
  69   #include        p18f452.inc                                                                              147   flag3:                  res     1       ;Verschiedene Flags
  70   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          148   flag4:                  res     1       ;Verschiedene Flags
  71           endif                                                                                            149   flag5:                  res     1       ;Verschiedene Flags
  72   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          150   bandneu:                res     1       ;Band 160 − 2m = 0 − 11
  73                                                                                                            151   mode:                   res     1       ;Mode Zwischenspeicher
  74   #include           makros_pic18.inc                                                                      152   modeneu:                res     1       ;neu eingestellter Mode
  75   ;#define                   mathetest                                                                     153
  76   ;#define                   debug           ;debuglauf auf dem PC                                         154   CounterA:               res     1       ;Zellen fuer Delay
  77   ;#define                   test1                                                                         155   CounterB:               res     1       ;Zellen fuer Delay
  78                                                                                                            156   CounterC:               res     1       ;Zellen fuer Delay
  79   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          157
  80           if      bytevariante < .21      ;alle Varianten mit PIC18F452                                    158   tastennummer:           res     1       ;Nummer der gedrueckten Taste

Dienstag November 10, 2009                                                                             mc.pic                                                                                                       1/40
                                                                                                                                                                                                           Printed by Andreas
 Nov 10, 09 8:32                                    mc.pic                                     Page 3/79            Nov 10, 09 8:32                                       mc.pic                                 Page 4/79
  159   impulse:                res     1       ;Drehimpulse                                                        239   start_CAT_buffer:         res        0xf0   ;RX/TX Ring−Buffer
  160   ;..............................................................................                             240   end_CAT_buffer:           res        0      ;Buffer ende
  161   ergebnis:               res     0       ;ergebnis fuer mathe−funktion                                       241
  162   temp:                   res     D’10’   ;temporaere Speicher                                                242   ;;;;;;; Definitionen ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  163   op1:                    res     0       ;                                                                   243
  164   minuend:                res     0       ;minuend fuer mathe−funktion                                        244
  165   summand1:               res     0       ;summand fuer mathe−funktion                                        245   ;;;;;;; Definitionen ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  166   divident:               res     0       ;divident fuer mathe−funktion                                       246
  167   faktor1:                res     0       ;faktor1 fuer mathe−funktion                                        247   ;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  168   tempkonst1:             res     8       ;rechenspeicher                                                     248   ;FLAG1 wird mit gespeichert im Eeprom
  169   op2:                    res     0       ;                                                                   249   ;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  170   subtrahend:             res     0       ;subtrahend fuer mathe−funktion                                     250   #define blcdsmeter      flag1,0         ;Anstelle Frequenz das S−Meter anzeigen
  171   summand2:               res     0       ;summand fuer mathe−funktion                                        251   #define bbeleuchtung    flag1,1         ;bit fuer Beleuchtung
  172   divisor:                res     0       ;divisor fuer mathe−funktion                                        252   #define blauto          flag1,2         ;Lichautomatik
  173   faktor2:                res     0       ;faktor2 fuer mathe−funktion                                        253   #define b1hzanz         flag1,3         ;1Hz Umschaltung moeglich
  174   tempkonst2:             res     8       ;nicht trennen da gemeinsam clr                                     254   #define bkeyerein       flag1,4         ;Keyer ein/aus
  175   ;..............................................................................                             255   #define btxpermzf       flag1,5         ;Beim Senden keine ZF addieren oder subtrahieren
  176   ebene:                  res     1       ;Nummer der Menueebene                                              256   #define bbandmode       flag1,6         ;Aktive Bandumschaltung mit RS232 ausgang
  177   zs1:                    res     1       ;Zeitschleife 1                                                     257   #define bvfox4          flag1,7         ;VFO x 4 fuer I/Q−Mischer
  178   zs2:                    res     2       ;Zeitschleife 2 Sender AUS                                          258   ;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  179   zs3:                    res     1       ;Zeitschleife fuer CW (Punktlaenge im Interr.)                      259   ;FLAG1 wird mit gespeichert im Eeprom
  180   keyergeschw:            res     2       ;Keyergeschwindigkeit                                               260   ;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  181   schleife:               res     4       ;fuer schleifen                                                     261
  182                                                                                                               262   #define   bddsneu         flag2,0           ;1=DDS neu ausrechnen und laden
  183   ddsbinrx:               res     4       ;binaerwert fr DDS laden Empfangsfrequenz                           263   #define   bmenu           flag2,1           ;Menuanzeige
  184   ddsbintx:               res     4       ;binaerwert fr DDS laden Sendefrequenz                              264   #define   tonenable       flag2,2           ;Tonenable
  185   tmr0const               res     1       ;Constande fuer Mithoerton                                          265   #define   LCDr            flag2,3           ;Statusspeicher fuer LCD beim Busylesen
  186   ubatt:                  res     2       ;Batteriespannung                                                   266   #define   bvfo            flag2,4           ;0=frequenza 1=frequenzb
  187   uvor:                   res     2       ;gemessene Vorlaufleistung 0..3ff                                   267   #define   bnull           flag2,5           ;Bit fuer fuehrende Null auf LCD
  188   urueck:                 res     2       ;gemessene Ruechlaufleistung 0..3ff                                 268   #define   btaste          flag2,6           ;Bit fuer Taste wurde gedrueckt
  189   urit:                   res     2       ;gemessene Spannung am RIT−Poti                                     269   #define   bzs1ausein      flag2,7           ;Merkbit Zeit1 gestartet
  190   usmeter:                res     3       ;gemessene Spannung S−Meter                                         270
  191   ukeyer:                 res     4       ;Keyerspannungen                                                    271   #define   bzs1einaus      flag3,0           ;Merkbit Zeit1 abgelaufen
  192                                                                                                               272   #define   bpunkt          flag3,1           ;ob Keyerpunkt gedrueckt war
  193   swr:                    res     3       ;Zwischenspeicher fuer SWR u. BarGraph                              273   #define   bstrich         flag3,2           ;ob Keyerstrich gedrueckt war
  194   tempindex:              res     1       ;Index fuer Tabellenroutinen                                        274   #define   brit            flag3,3           ;fuer Rit
  195   zw:                     res     1       ;zwischenspeicher                                                   275   #define   bnofunktion     flag3,4           ;Bit fuer wichtige Funktion
  196   string:                 res     D’12’   ;fuer Stringausgabe                                                 276   #define   block           flag3,5           ;fuer LOCK
  197   laenge:                 res     1       ;fuer Stringausgabe                                                 277   #define   blcdneu         flag3,6           ;1=frequenz zeile1 neu anzeigen
  198   komma:                  res     1       ;fuer Stringausgabe                                                 278   #define   ubattneu        flag3,7           ;Batteriespannung neu anzeigen
  199   kuerzen:                res     1       ;fuer Stringausgabe                                                 279
  200   mess:                   res     0       ;Ergebnis der Spannungsmessung                                      280   #define   bkeyeranz       flag4,0           ;Keyergeschw. anzeigen
  201   messl:                  res     1       ;L−Teil                                                             281   #define   bohnezf         flag4,1           ;ohne ZF
  202   messh:                  res     1       ;H:Teil                                                             282   #define   bminuszf        flag4,2           ;Flag fuer ZF subtrahieren
  203   zeitschlitz:            res     1       ;Zaehler fuer die Zeitschlitze                                      283   #define   bergebisminus   flag4,3           ;Flag Ergebnis ist Minus
  204   sr0                     res     1       ;Register fuer AD9951                                               284   #define   bintsperren     flag4,4           ;Interrupts sperren
  205   ddsword:                res     2       ;DDS−Word                                                           285   #define   bkein_mt        flag4,5           ;keinen Mithoerton
  206   ddsdword:               res     4       ;DDS−DoppelWord                                                     286
  207   setupnr:                res     1       ;Zaehler SETUP                                                      287
  208   stemp                   res     1       ;fuer SETUP                                                         288   ;==============================================================================
  209   stemp1                  res     5       ;fuer SETUP                                                         289   ;Namen der I/O Leitungen
  210   mddskonst               res     5       ;fuer SETUP                                                         290   ;==============================================================================
  211   swrmerke                res     2       ;das SWR merken                                                     291
  212   bargraph                res     3       ;Bytes fuer Bargarphanzeige                                         292   #define   e_DrehgeberC    PORTB,0H          ;Drehgebertakt
  213   flpointer               res     3       ;Pointer fuer Flash schreiben                                       293   #define   e_strichpin     PORTB,1H          ;Keyer
  214   frqmerk:                res     .12     ;Frequenz Mode merken bei RIT                                       294   #define   e_punktpin      PORTB,2H          ;Keyer
  215   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                             295   #define   e_DrehgeberD    PORTB,3H          ;Drehgeberrichtung
  216   ;dieser Bereich haengt zusammen im Eeprom Beginn                                                            296
  217   xsm                     res     2       ;X Konstande fuer S−Meter                                           297   #define   e_Taste1        PORTB,4h          ;Taste1
  218   ysm                     res     2       ;Y Konstande fuer S−Meter                                           298   #define   e_Taste2        PORTB,5h          ;Taste2
  219   mithoerton:             res     1       ;Mithoerton fuer ADD oder SUB zur DDS−Frequ.                        299   #define   e_Taste3        PORTB,6h          ;Taste3
  220   ;dieser Bereich haengt zusammen im Eeprom Ende                                                              300   #define   e_Taste4        PORTB,7h          ;Taste4
  221   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                             301
  222   FSRL_rs232_write        res     1       ;LOW in Ringbuffer RS232 schreiben                                  302   LCDTris   equ             TRISD             ;Einstellung fuer Port LCD
  223   FSRH_rs232_write        res     1       ;HIGH in Ringbuffer RS232 schreiben                                 303   LCDPort   equ             PORTD             ;Port fuer LCDAusgabe
  224   FSRL_rs232_read         res     1       ;LOW aus Ringbuffer RS232 lesen                                     304   #define   a_LCD_RS        PORTC,3h          ;RS Pin an LCD
  225   FSRH_rs232_read         res     1       ;HIGH aus Ringbuffer RS232 lesen                                    305   #define   a_LCD_RW        PORTC,4h          ;R/W Pin
  226   CAT_in_byte             res     1       ;Merker fuer Byte aus rs232buffer                                   306   #define   a_LCD_E         PORTD,3h          ;Enable
  227   catbefehl               res     .10     ;Befehlsspeicher                                                    307   #define   ea_LCD_D4       PORTD,4h          ;Daten von LCD
  228   endecatbefehl           res     0       ;ende markieren                                                     308   #define   ea_LCD_D5       PORTD,5h          ;Daten von LCD
  229   ;..............................................................................                             309   #define   ea_LCD_D6       PORTD,6h          ;Daten von LCD
  230   ramende:                res     0       ;Merker fuer Ramende im Bankbereich 0                               310   #define   ea_LCD_D7       PORTD,7h          ;Daten von LCD
  231                                                                                                               311
  232   var3                    udata   0x300   ;Zwischenbuffer fuer Flashspeichern                                 312   #define a_senderein       PORTD,0h          ;Sender einschalten
  233   flbuffer                res     .256    ;                                                                   313   #define a_tastungein      PORTD,1h          ;Sender Tastung
  234                                                                                                               314
  235   var4                    udata   0x400   ;BSR RAM                                                            315   #define a_licht           PORTD,2h          ;LCD Hintergrundbeleuchtung
  236   txbuffer                res     0xff    ;                                                                   316
  237                                                                                                               317   #define a_mton            PORTA,4H          ;Mithoerton
  238   var5                    udata   0x500   ;BSR RAM                                                            318


Dienstag November 10, 2009                                                                                 mc.pic                                                                                                       2/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                      mc.pic                                Page 5/79            Nov 10, 09 8:32                                     mc.pic                                Page 6/79
  319   #define   a_fsync         PORTC,0h        ;DDS_BG                                                        396           ;bit 0 = Timer0 is configured as a 16−bit timer/counter
  320   #define   a_sclk          PORTC,1h        ;DDS_BG                                                        397   ;bit 5 T0CS: Timer0 Clock Source Select
  321   #define   a_sdata         PORTC,2h        ;DDS_BG                                                        398           ;bit 1 = Transition on T0CKI pin
  322   #define   a_reset         PORTC,5h        ;DDS_BG                                                        399           ;bit 0 = Internal instruction cycle clock (CLKO)
  323                                                                                                            400   ;bit 4 T0SE: Timer0 Source Edge Select
  324   ;=========================================================================                               401           ;bit 1 = Increment on high−to−low transition on T0CKI pin
  325   ; EEPROM Zellen                                                                                          402           ;bit 0 = Increment on low−to−high transition on T0CKI pin
  326   ;=========================================================================                               403   ;bit 3 PSA: Timer0 Prescaler Assignment
  327                                                                                                            404           ;bit 1 = TImer0 prescaler is NOT assigned. Timer0 clock input bypasses prescaler.
  328   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                                                           405           ;bit 0 = Timer0 prescaler is assigned. Timer0 clock input comes from prescaler output.
  329   ;Adressberechnungen fuer das laufende Programm                                                           406   ;bit 2−0 T0PS2:T0PS0: Timer0 Prescaler Select
  330   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                                                           407           ;bits 111 = 1:256 prescale value
  331                                                                                                            408           ;110 = 1:128 prescale value
  332   ddskonstlaenge          equ     5                                                                        409           ;101 = 1:64 prescale value
  333   zflaenge                equ     4       ;ZF Bereich −2.147.483.648 Hz bis 2.147.483.647 Hz               410           ;100 = 1:32 prescale value
  334   frequenzlaengeband      equ     4       ;Frequenz Bereich −2.147.483.648 Hz bis 2.147.483.647 Hz         411           ;011 = 1:16 prescale value
  335   lcdoffsetlaenge         equ     5       ;LCD−Offset Bereich −549.755.813.888 Hz bis 549.755.813.8        412           ;010 = 1:8 prescale value
        87 Hz                                                                                                    413           ;001 = 1:4 prescale value
  336   modelaenge              equ     1                                                                        414           ;000 = 1:2 prescale value
  337   steplaenge              equ     1                                                                        415   ;******************************************************************************
  338   bandlaenge              equ     1                                                                        416
  339   flaglaenge              equ     1                                                                        417   ;d_t1con                equ     b’00010001’
  340   ddstypelaenge           equ     1                                                                        418   d_t1con          equ    b’00000001’
  341   zflagelaenge            equ     2                                                                        419
  342   smlaenge                equ     2                                                                        420   ;       R/W−0 R/W−0    R/W−0    R/W−0  R/W−0 R/W−0 R/W−0
  343   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                     421   ;       RD16 âM−^@M−^T T1CKPS1 T1CKPS0 T1OSCEN T1SYNC TMR1CS TMR1ON
  344   ;Festlegung der Datenlaengen im Eeprom                                                                   422   ;
  345   grunddaten      equ     ddskonstlaenge + steplaenge + bandlaenge + flaglaenge + ddstypelaenge + 1        423   ;bit 7 RD16: 16−bit Read/Write Mode Enable bit
         + (4*zflaenge)                                                                                          424   ;       1 = Enables register Read/Write of Timer1 in one 16−bit operation
  346   bandgeslaenge   equ     (2*frequenzlaengeband) + modelaenge + modelaenge                                 425   ;       0 = Enables register Read/Write of Timer1 in two 8−bit operations
  347   trvbandlaenge   equ     (2*frequenzlaengeband) + lcdoffsetlaenge + modelaenge + modelaenge + 1           426   ;bit 6 Unimplemented: Read as ’0’
  348   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          427   ;bit 5−4 T1CKPS1:T1CKPS0: Timer1 Input Clock Prescale Select bits
  349   ;Festlegung der Adressen im Eeprom                                                                       428   ;       11 = 1:8 Prescale value
  350   addrbeginn              equ     0                                                                        429   ;       10 = 1:4 Prescale value
  351   addrddskonst            equ     addrbeginn                      ;0 1 2 3 4                               430   ;       01 = 1:2 Prescale value
  352   addrstep                equ     addrbeginn + ddskonstlaenge     ;5                                       431   ;       00 = 1:1 Prescale value
  353   addrband                equ     addrstep + steplaenge           ;6                                       432   ;bit 3 T1OSCEN: Timer1 Oscillator Enable bit
  354   addrflag                equ     addrband + bandlaenge           ;7                                       433   ;       1 = Timer1 Oscillator is enabled
  355   addrddstype             equ     addrflag + flaglaenge           ;8 9                                     434   ;       0 = Timer1 Oscillator is shut−off
  356   addrzfcw                equ     addrddstype + ddstypelaenge + 1 ;A B C D    Ausgleich zu geraden         435   ;The oscillator inverter and feedback resistor are turned off to eliminate power drain.
        Zahl                                                                                                     436   ;bit 2 T1SYNC: Timer1 External Clock Input Synchronization Select bit
  357   addrzfcwr               equ     addrzfcw + zflaenge             ;E F 10 11                               437   ;When TMR1CS = 1:
  358   addrzflsb               equ     addrzfcwr + zflaenge            ;12 13 14 15                             438   ;1 = Do not synchronize external clock input
  359   addrzfusb               equ     addrzflsb + zflaenge            ;16 17 18 19                             439   ;0 = Synchronize external clock input
  360   addrzfdig               equ     addrzfusb + zflaenge            ;1a 1b 1c 1d                             440   ;When TMR1CS = 0:
  361   addrzfdigr              equ     addrzfdig + zflaenge            ;1e 1f 20 21                             441   ;This bit is ignored. Timer1 uses the internal clock when TMR1CS = 0.
  362   addrxsm                 equ     addrzfdigr + zflaenge           ;22 23                                   442   ;bit 1 TMR1CS: Timer1 Clock Source Select bit
  363   addrysm                 equ     addrxsm + smlaenge              ;24 25                                   443   ;1 = External clock from pin RC0/T1OSO/T13CKI (on the rising edge)
  364                                                                                                            444   ;0 = Internal clock (FOSC/4)
  365   ;13 Baender                                                                                              445   ;bit 0 TMR1ON: Timer1 On bit
  366   addrbandbeginn            equ     0x28                                                                   446   ;1 = Enables Timer1
  367   addrmess                  equ     addrbandbeginn   +   (0*bandgeslaenge)                                 447   ;0 = Stops Timer1
  368   addr160m                  equ     addrbandbeginn   +   (1*bandgeslaenge)                                 448   ;******************************************************************************
  369   addr80m                   equ     addrbandbeginn   +   (2*bandgeslaenge)                                 449   ;T2CON: TIMER2 CONTROL REGISTER
  370   addr60m                   equ     addrbandbeginn   +   (3*bandgeslaenge)                                 450
  371   addr40m                   equ     addrbandbeginn   +   (4*bandgeslaenge)                                 451   d_t2con          equ     B’00100001’
  372   addr30m                   equ     addrbandbeginn   +   (5*bandgeslaenge)                                 452   ;Postscale = 5   Anpassung an 20MHz
  373   addr20m                   equ     addrbandbeginn   +   (6*bandgeslaenge)                                 453   ;Prescaler = 4
  374   addr17m                   equ     addrbandbeginn   +   (7*bandgeslaenge)                                 454
  375   addr15m                   equ     addrbandbeginn   +   (8*bandgeslaenge)                                 455   ;bit 7 Unimplemented: Read as ’0’
  376   addr12m                   equ     addrbandbeginn   +   (9*bandgeslaenge)                                 456   ;bit 6−3 TOUTPS3:TOUTPS0: Timer2 Output Postscale Select bits
  377   addr10m                   equ     addrbandbeginn   +   (.10*bandgeslaenge)                               457   ; 0000 = 1:1 Postscale
  378   addr6m                    equ     addrbandbeginn   +   (.11*bandgeslaenge)                               458   ; 0001 = 1:2 Postscale
  379   addr2m                    equ     addrbandbeginn   +   (.12*bandgeslaenge)                               459   ; 0010 = 1:3 Postscale
  380                                                                                                            460   ; 0011 = 1:4 Postscale
  381   ;5 Transverterbaender                                                                                    461   ; 0100 = 1:5 Postscale
  382   transverterbeginn       equ     addrbandbeginn + (.13*bandgeslaenge)                                     462   ;   .
  383   addrtrvband1            equ     transverterbeginn + (0*trvbandlaenge)                                    463   ;   .
  384   addrtrvband2            equ     transverterbeginn + (1*trvbandlaenge)                                    464   ;   .
  385   addrtrvband3            equ     transverterbeginn + (2*trvbandlaenge)                                    465   ; 1111 = 1:16 Postscale
  386   addrtrvband4            equ     transverterbeginn + (3*trvbandlaenge)                                    466   ;bit 2 TMR2ON: Timer2 On bit
  387   addrtrvband5            equ     transverterbeginn + (4*trvbandlaenge)                                    467   ; 1 = Timer2 is on
  388   ;==============================================================================                          468   ; 0 = Timer2 is off
  389   d_t0con                 equ     b’11000100’                                                              469   ;bit 1−0 T2CKPS1:T2CKPS0: Timer2 Clock Prescale Select bits
  390                                                                                                            470   ; 00 = Prescaler is 1
  391   ;bit 7 TMR0ON:   Timer0 On/Off Control                                                                   471   ; 01 = Prescaler is 4
  392           ;bit 1   = Enables Timer0                                                                        472   ;   .
  393           ;bit 0   = Stops Timer0                                                                          473   ;   .
  394   ;bit 6 T08BIT:   Timer0 8−bit/16−bit Control                                                             474   ;   .
  395           ;bit 1   = Timer0 is configured as an 8−bit timer/counter                                        475   ; 1x = Prescaler is 16

Dienstag November 10, 2009                                                                              mc.pic                                                                                                      3/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                    mc.pic                                  Page 7/79            Nov 10, 09 8:32                                    mc.pic                                 Page 8/79
  476   ;                                                                                                        556   ;       0 = Interrupt on falling edge
  477   ;******************************************************************************                          557   ;bit 5 INTEDG1: External Interrupt1 Edge Select bit
  478   d_t3con         equ     B’00000000’                                                                      558   ;       1 = Interrupt on rising edge
  479                                                                                                            559   ;       0 = Interrupt on falling edge
  480   ;T3CON: TIMER3 CONTROL REGISTER                                                                          560   ;bit 4 INTEDG2: External Interrupt2 Edge Select bit
  481   ;R/W−0 R/W−0 R/W−0 R/W−0 R/W−0 R/W−0 R/W−0 R/W−0                                                         561   ;       1 = Interrupt on rising edge
  482   ;RD16 T3CCP2 T3CKPS1 T3CKPS0 T3CCP1 T3SYNC TMR3CS TMR3ON                                                 562   ;       0 = Interrupt on falling edge
  483   ;                                                                                                        563   ;bit 3 Unimplemented: Read as ’0’
  484   ;bit 7 RD16: 16−bit Read/Write Mode Enable bit                                                           564   ;bit 2 TMR0IP: TMR0 Overflow Interrupt Priority bit
  485   ; 1 = Enables register Read/Write of Timer3 in one 16−bit operation                                      565   ;       1 = High priority
  486   ; 0 = Enables register Read/Write of Timer3 in two 8−bit operations                                      566   ;       0 = Low priority
  487   ;bit 6−3 T3CCP2:T3CCP1: Timer3 and Timer1 to CCPx Enable bits                                            567   ;bit 1 Unimplemented: Read as ’0’
  488   ; 1x = Timer3 is the clock source for compare/capture CCP modules                                        568   ;bit 0 RBIP: RB Port Change Interrupt Priority bit
  489   ; 01 = Timer3 is the clock source for compare/capture of CCP2,                                           569   ;       1 = High priority
  490   ; Timer1 is the clock source for compare/capture of CCP1                                                 570   ;       0 = Low priority
  491   ; 00 = Timer1 is the clock source for compare/capture CCP modules                                        571   ;******************************************************************************
  492   ;bit 5−4 T3CKPS1:T3CKPS0: Timer3 Input Clock Prescale Select bits                                        572
  493   ; 11 = 1:8 Prescale value                                                                                573   d_intcon3:     equ     B’00000000’
  494   ; 10 = 1:4 Prescale value                                                                                574
  495   ; 01 = 1:2 Prescale value                                                                                575   ;bit 7 INT2IP: INT2 External Interrupt Priority bit
  496   ; 00 = 1:1 Prescale value                                                                                576   ;       1 = High priority
  497   ;bit 2 T3SYNC: Timer3 External Clock Input Synchronization Control bit                                   577   ;       0 = Low priority
  498   ; (Not usable if the system clock comes from Timer1/Timer3)                                              578   ;bit 6 INT1IP: INT1 External Interrupt Priority bit
  499   ; When TMR3CS = 1:                                                                                       579   ;       1 = High priority
  500   ; 1 = Do not synchronize external clock input                                                            580   ;       0 = Low priority
  501   ; 0 = Synchronize external clock input                                                                   581   ;bit 5 Unimplemented: Read as ’0’
  502   ; When TMR3CS = 0:                                                                                       582   ;bit 4 INT2IE: INT2 External Interrupt Enable bit
  503   ; This bit is ignored. Timer3 uses the internal clock when TMR3CS = 0.                                   583   ;       1 = Enables the INT2 external interrupt
  504   ;bit 1 TMR3CS: Timer3 Clock Source Select bit                                                            584   ;       0 = Disables the INT2 external interrupt
  505   ; 1 = External clock input from Timer1 oscillator or T1CKI                                               585   ;bit 3 INT1IE: INT1 External Interrupt Enable bit
  506   ; (on the rising edge after the first falling edge)                                                      586   ;       1 = Enables the INT1 external interrupt
  507   ; 0 = Internal clock (FOSC/4)                                                                            587   ;       0 = Disables the INT1 external interrupt
  508   ;bit 0 TMR3ON: Timer3 On bit                                                                             588   ;bit 2 Unimplemented: Read as ’0’
  509   ; 1 = Enables Timer3                                                                                     589   ;bit 1 INT2IF: INT2 External Interrupt Flag bit
  510   ; 0 = Stops Timer3                                                                                       590   ;       1 = The INT2 external interrupt occurred (must be cleared in software)
  511   ;******************************************************************************                          591   ;       0 = The INT2 external interrupt did not occur
  512                                                                                                            592   ;bit 0 INT1IF: INT1 External Interrupt Flag bit
  513   d_intcon        equ     B’11110000’                                                                      593   ;       1 = The INT1 external interrupt occurred (must be cleared in software)
  514                                                                                                            594   ;       0 = The INT1 external interrupt did not occur
  515   ;bit 7 GIE/GIEH: Global Interrupt Enable bit                                                             595   ;******************************************************************************
  516   ;       When IPEN = 0:                                                                                   596
  517   ;       1 = Enables all unmasked interrupts                                                              597   d_rcon:        equ     B’00000000’
  518   ;       0 = Disables all interrupts                                                                      598
  519   ;       When IPEN = 1:                                                                                   599   ;bit 7 IPEN: Interrupt Priority Enable bit
  520   ;       1 = Enables all high priority interrupts                                                         600   ;       1 = Enable priority levels on interrupts
  521   ;       0 = Disables all interrupts                                                                      601   ;       0 = Disable priority levels on interrupts (16CXXX Compatibility mode)
  522   ;bit 6 PEIE/GIEL: Peripheral Interrupt Enable bit                                                        602   ;bit 6−5 Unimplemented: Read as ’0’
  523   ;       When IPEN = 0:                                                                                   603   ;bit 4 RI: RESET Instruction Flag bit For details of bit operation, see Register 4−3
  524   ;       1 = Enables all unmasked peripheral interrupts                                                   604   ;bit 3 TO: Watchdog Time−out Flag bit For details of bit operation, see Register 4−3
  525   ;       0 = Disables all peripheral interrupts                                                           605   ;bit 2 PD: Power−down Detection Flag bit For details of bit operation, see Register 4−3
  526   ;       When IPEN = 1:                                                                                   606   ;bit 1 POR: Power−on Reset Status bit For details of bit operation, see Register 4−3
  527   ;       1 = Enables all low priority peripheral interrupts                                               607   ;bit 0 BOR: Brown−out Reset Status bit For details of bit operation, see Register 4−3
  528   ;       0 = Disables all low priority peripheral interrupts                                              608   ;******************************************************************************
  529   ;bit 5 TMR0IE: TMR0 Overflow Interrupt Enable bit                                                        609   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  530   ;       1 = Enables the TMR0 overflow interrupt                                                          610           if      bytevariante < .21      ;alle Varianten mit PIC18F452
  531   ;       0 = Disables the TMR0 overflow interrupt                                                         611   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  532   ;bit 4 INT0IE: INT0 External Interrupt Enable bit                                                        612   d_adcon1:               equ     b’10000000’      ;
  533   ;       1 = Enables the INT0 external interrupt                                                          613   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  534   ;       0 = Disables the INT0 external interrupt                                                         614           endif
  535   ;bit 3 RBIE: RB Port Change Interrupt Enable bit                                                         615   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  536   ;       1 = Enables the RB port change interrupt                                                         616   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  537   ;       0 = Disables the RB port change interrupt                                                        617           if      bytevariante >= .21     ;alle Varianten mit PIC18F4520
  538   ;bit 2 TMR0IF: TMR0 Overflow Interrupt Flag bit                                                          618   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  539   ;       1 = TMR0 register has overflowed (must be cleared in software)                                   619   d_adcon1:               equ     b’00000111’      ;
  540   ;       0 = TMR0 register did not overflow                                                               620   d_adcon2:               equ     b’10000110’      ;
  541   ;bit 1 INT0IF: INT0 External Interrupt Flag bit                                                          621   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  542   ;       1 = The INT0 external interrupt occurred (must be cleared in software)                           622           endif
  543   ;       0 = The INT0 external interrupt did not occur                                                    623   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  544   ;bit 0 RBIF: RB Port Change Interrupt Flag bit                                                           624
  545   ;       1 = At least one of the RB7:RB4 pins changed state (must be cleared in software)                 625   ;bit 7 ADFM: A/D Result Format Select bit
  546   ;       0 = None of the RB7:RB4 pins have changed state                                                  626   ;       1 = Right justified. 6 Most Significant bits of ADRESH are read as 0.
  547   ;******************************************************************************                          627   ;       0 = Left justified. 6 Least Significant bits of ADRESL are read as 0.
  548                                                                                                            628   ;bit 6−4 Unimplemented: Read as ’0’
  549   d_intcon2       equ     B’00000000’                                                                      629   ;bit 3−0 PCFG3:PCFG0: A/D Port Configuration Control bits:
  550                                                                                                            630   ;******************************************************************************
  551   ;bit 7 RBPU: PORTB Pull−up Enable bit                                                                    631
  552   ;       1 = All PORTB pull−ups are disabled                                                              632   d_pie1:                equ     b’00100011’
  553   ;       0 = PORTB pull−ups are enabled by individual port latch values                                   633
  554   ;bit 6 INTEDG0:External Interrupt0 Edge Select bit                                                       634   ;bit 7 PSPIE(1): Parallel Slave Port Read/Write Interrupt Enable bit
  555   ;       1 = Interrupt on rising edge                                                                     635   ;       1 = Enables the PSP read/write interrupt

Dienstag November 10, 2009                                                                              mc.pic                                                                                                    4/40
                                                                                                                                                                                                  Printed by Andreas
 Nov 10, 09 8:32                                      mc.pic                              Page 9/79            Nov 10, 09 8:32                                  mc.pic                                 Page 10/79
  636   ;       0 = Disables the PSP read/write interrupt                                                      716   ;        0 = Low priority
  637   ;bit 6 ADIE: A/D Converter Interrupt Enable bit                                                        717   ;bit 1 TMR3IP: TMR3 Overflow Interrupt Priority bit
  638   ;       1 = Enables the A/D interrupt                                                                  718   ;        1 = High priority
  639   ;       0 = Disables the A/D interrupt                                                                 719   ;        0 = Low priority
  640   ;bit 5 RCIE: USART Receive Interrupt Enable bit                                                        720   ;bit 0 CCP2IP: CCP2 Interrupt Priority bit
  641   ;       1 = Enables the USART receive interrupt                                                        721   ;        1 = High priority
  642   ;       0 = Disables the USART receive interrupt                                                       722   ;        0 = Low priority
  643   ;bit 4 TXIE: USART Transmit Interrupt Enable bit                                                       723   ;##############################################################################
  644   ;       1 = Enables the USART transmit interrupt                                                       724   ;CONSTANDEN
  645   ;       0 = Disables the USART transmit interrupt                                                      725   ;##############################################################################
  646   ;bit 3 SSPIE: Master Synchronous Serial Port Interrupt Enable bit                                      726   ;Daten fuer Timer1 = verschiedene Zeittimer
  647   ;       1 = Enables the MSSP interrupt                                                                 727   ;Eine Zeiteinheit betraegt 10 mSek
  648   ;       0 = Disables the MSSP interrupt                                                                728   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  649   ;bit 2 CCP1IE: CCP1 Interrupt Enable bit                                                               729   pictakt                  equ    .18432          ;in kHz
  650   ;       1 = Enables the CCP1 interrupt                                                                 730   tmr1word                 equ    (pictakt * .5) / .4
  651   ;       0 = Disables the CCP1 interrupt                                                                731   tmr1lconst               equ    LOW (0−tmr1word)
  652   ;bit 1 TMR2IE: TMR2 to PR2 Match Interrupt Enable bit                                                  732   tmr1hconst               equ    HIGH (0−tmr1word)
  653   ;       1 = Enables the TMR2 to PR2 match interrupt                                                    733   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  654   ;       0 = Disables the TMR2 to PR2 match interrupt                                                   734   ;Daten fuer Timer0 = Mithoerton
  655   ;bit 0 TMR1IE: TMR1 Overflow Interrupt Enable bit                                                      735   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  656   ;       1 = Enables the TMR1 overflow interrupt                                                        736   tonhoehe                 equ    .68
  657   ;       0 = Disables the TMR1 overflow interrupt                                                       737   tmr0wert                 equ    pictakt * .100 / (.8 * .32)
  658   ;******************************************************************************                        738   d_tmr0lconst             equ    LOW (0−tmr0wert)
  659   d_pie2                  equ     b’00000010’                                                            739   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  660                                                                                                          740   d_trisa:                  equ   b’00101111’      ;RA0,1,2,3,5 analoge Eingaenge
  661   ;bit 7−5 Unimplemented: Read as ’0’                                                                    741   d_trisb:                  equ   b’11111111’      ;Grundeinstellung PORTB
  662   ;bit 4 EEIE: Data EEPROM/FLASH Write Operation Interrupt Enable bit                                    742   d_trisc:                  equ   b’10000000’      ;
  663   ;       1 = Enabled                                                                                    743   d_trisd:                  equ   b’00000000’      ;
  664   ;       0 = Disabled                                                                                   744   d_trise:                  equ   b’00000111’      ;Port E analoge Eingaenge
  665   ;bit 3 BCLIE: Bus Collision Interrupt Enable bit                                                       745   d_porta                  equ    b’00101111’     ;
  666   ;       1 = Enabled                                                                                    746   d_portb                  equ    b’11111111’     ;
  667   ;       0 = Disabled                                                                                   747   d_portc                  equ    b’00100111’     ;
  668   ;bit 2 LVDIE: Low Voltage Detect Interrupt Enable bit                                                  748   d_portd                  equ    b’00000000’     ;
  669   ;       1 = Enabled                                                                                    749   d_porte                  equ    b’00000111’     ;
  670   ;       0 = Disabled                                                                                   750
  671   ;bit 1 TMR3IE: TMR3 Overflow Interrupt Enable bit                                                      751   modecw                  equ     1               ;
  672   ;       1 = Enables the TMR3 overflow interrupt                                                        752   modecwr                 equ     2               ;
  673   ;       0 = Disables the TMR3 overflow interrupt                                                       753   modelsb                 equ     3               ;
  674   ;bit 0 CCP2IE: CCP2 Interrupt Enable bit                                                               754   modeusb                 equ     4               ;
  675   ;       1 = Enables the CCP2 interrupt                                                                 755   modedig                 equ     5               ;
  676   ;       0 = Disables the CCP2 interrupt                                                                756   modedigr                equ     6               ;
  677   ;******************************************************************************                        757   ;##############################################################################
  678   d_ipr1                  equ     b’00000000’                                                            758   ;##############################################################################
  679                                                                                                          759   ;;;;;;; Vectors ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  680   ;bit 7 PSPIP(1): Parallel Slave Port Read/Write Interrupt Priority bit                                 760
  681   ;       1 = High priority                                                                              761           org     0x0000                  ;Reset vector
  682   ;       0 = Low priority                                                                               762           bra     main
  683   ;bit 6 ADIP: A/D Converter Interrupt Priority bit                                                      763           org     0x0008                  ;High priority interrupt vector
  684   ;       1 = High priority                                                                              764           goto    interrupt1              ;Trap
  685   ;       0 = Low priority                                                                               765           org     0x0018                  ;Low priority interrupt vector
  686   ;bit 5 RCIP: USART Receive Interrupt Priority bit                                                      766           goto    interrupt2              ;Trap
  687   ;       1 = High priority                                                                              767   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  688   ;       0 = Low priority                                                                               768   ;Funktion:      Wandlung BCDZahl unteres Nibbel in ASCIIzeichen
  689   ;bit 4 TXIP: USART Transmit Interrupt Priority bit                                                     769   ;Eingang:       BCD in W unteres Nibbel
  690   ;       1 = High priority                                                                              770   ;Ausgang:       entsprechendes Ascii−Zeichen in W
  691   ;       0 = Low priority                                                                               771   ;==============================================================================
  692   ;bit 3 SSPIP: Master Synchronous Serial Port Interrupt Priority bit                                    772   bcd2ascii_1b:
  693   ;       1 = High priority                                                                              773           andlw   B’00001111’
  694   ;       0 = Low priority                                                                               774           movwf   tempindex
  695   ;bit 2 CCP1IP: CCP1 Interrupt Priority bit                                                             775           movlw   high(dbcd2hex)
  696   ;       1 = High priority                                                                              776           movwf   TBLPTRH
  697   ;       0 = Low priority                                                                               777           movlw   low(dbcd2hex)
  698   ;bit 1 TMR2IP: TMR2 to PR2 Match Interrupt Priority bit                                                778   indexlesen:
  699   ;       1 = High priority                                                                              779           movwf   TBLPTRL
  700   ;       0 = Low priority                                                                               780           movf    tempindex,W
  701   ;bit 0 TMR1IP: TMR1 Overflow Interrupt Priority bit                                                    781           addwf   TBLPTRL,F
  702   ;       1 = High priority                                                                              782           btfsc   STATUS,C
  703   ;       0 = Low priority                                                                               783           incf    TBLPTRH,F
  704   ;******************************************************************************                        784           tblrd*
  705   d_ipr2                   equ    b’00000000’                                                            785           movf    TABLAT,W
  706                                                                                                          786           return
  707   ;bit   7−5 Unimplemented: Read as ’0’                                                                  787   dbcd2hex:
  708   ;bit   4 EEIP: Data EEPROM/FLASH Write Operation Interrupt Priority bit                                788           db      "0123456789ABCDEF"
  709   ;         1 = High priority                                                                            789   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  710   ;         0 = Low priority                                                                             790   getBandadr:
  711   ;bit   3 BCLIP: Bus Collision Interrupt Priority bit                                                   791           movf    band,W
  712   ;         1 = High priority                                                                            792           andlw   B’00011111’
  713   ;         0 = Low priority                                                                             793           movwf   tempindex
  714   ;bit   2 LVDIP: Low Voltage Detect Interrupt Priority bit                                              794           movlw   high(dbandadr)
  715   ;         1 = High priority                                                                            795           movwf   TBLPTRH

Dienstag November 10, 2009                                                                            mc.pic                                                                                                   5/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                     mc.pic                                Page 11/79            Nov 10, 09 8:32                                  mc.pic                                     Page 12/79
  796           movlw   low(dbandadr)                                                                            876           MOVLF   .255,data_ee_addr;
  797           bra     indexlesen                                                                               877           call    eread           ;
  798   dbandadr:                                                                                                878   ;........................................
  799           db      addrmess, addr160m, addr80m, addr60m                                                     879   ;        movlw  0
  800           db      addr40m, addr30m, addr20m, addr17m                                                       880   ;        call   LCDPos
  801           db      addr15m, addr12m, addr10m, addr6m                                                        881   ;        movf   data_ee_data,W          ;
  802           db      addr2m, addrtrvband1, addrtrvband2, addrtrvband3                                         882   ;        call   LCDHEX                  ;
  803           db      addrtrvband4, addrtrvband5                                                               883   ;        call   t1Sek                   ;
  804   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          884   ;        goto   $
  805   getZFadr:                                                                                                885   ;........................................
  806           andlw   B’00000111’                                                                              886           movf    data_ee_data,W ;
  807           movwf   tempindex                                                                                887           sublw   version         ;? richtige Version
  808           movlw   high(dzfadr)                                                                             888           bnz     main002         ;0 −−> Break Urladen
  809           movwf   TBLPTRH                                                                                  889           rcall   Tastegedrueckt ;? Taste gedrueckt
  810           movlw   low(dzfadr)                                                                              890           bnc     main00          ;
  811           bra     indexlesen                                                                               891   ;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  812   dzfadr:                                                                                                  892   ;Laderoutine Konfiguration. Der Eeprom wird mit den Banddaten programmiert
  813           db      addrzfcw, addrzfcwr, addrzflsb, addrzfusb, addrzfdig, addrzfdigr                         893   ;Power ON + Taste 1 ganz links
  814                                                                                                            894   ;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  815   ukey2msek:                                                                                               895           rcall   Tastaturstatus ;1 ? Tasttaturabfrage Taste 1
  816           movf    keyergeschw+1,W                                                                          896           movlw   1               ;
  817           movwf    tempindex                                                                               897           subwf   tastennummer,W ;
  818           clrc                                                                                             898           bnz     main003
  819           rrcf    tempindex,F                                                                              899           call    readsicherung   ; letzte Sicherung einlesen
  820           rrcf    tempindex,F                                                                              900           rcall   mtausrechnen    ; Mithoerton ausrechnen
  821           rrcf    tempindex,W                                                                              901           rcall   zs1laden        ; Timer 1Sek laden
  822           andlw   B’00011111’                                                                              902           goto    flash2ee        ;
  823           movwf   tempindex                                                                                903   main003:
  824           movlw   high(keyertab)                                                                           904   ;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  825           movwf   TBLPTRH                                                                                  905   ;Urladeroutine. Der Eeprom wird mit den Banddaten programmiert
  826           movlw   low(keyertab)                                                                            906   ;Power ON + Taste 4 ganz rechts
  827           bra     indexlesen                                                                               907   ;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  828                                                                                                            908           rcall   Tastaturstatus ;1 ? Tasttaturabfrage Taste 4
  829   keyertab:       db      .133,   .120, .109, .100, .92, .86, .80, .75, .71, .67                           909           movlw   4               ;
  830                   db      .63,    .60, .57, .55, .52, .50, .48, .46, .44, .43                              910           subwf   tastennummer,W ;
  831                   db      .41,    .40, .39, .38, .36, .35, .34, .33, .32, .32                              911           bnz     main001         ;
  832                   db      .31,    .30                                                                      912   main002:
  833                                                                                                            913           rcall   LCDDisplayClear ; 1 Taste 4 Power ON behandeln
  834   ;==============================================================================                          914           LCDStrp text1po         ;    Text Ladebeginn
  835   ;;;;;;; Mainline program ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                          915           call    urladung        ;    Urladung Eeprom beschreiben
  836   ;Konstanden                                                                                              916           rcall   LCDDisplayClear ;    Text Laden beendet
  837   maxmenu:        equ     .4      ;4 Menuepunkte                                                           917           LCDStrp text2po         ;
  838   maxmenumitband: equ     .12     ;12 Menuepunkte                                                          918           rcall   t1Sek           ;    1 Sekunde warten
  839   version:        equ     .100    ;Version 1.00                                                            919           rcall   quittungsdton   ;    Quittungston doppelt
  840   kxsm:           equ     200h    ;auch mess S0                                                            920   main001:                        ;SCHLEIFE(1)
  841   kysm:           equ     100h    ;auch mess S9                                                            921           rcall   Tastegedrueckt ; ? Taste gedrueckt
  842                                                                                                            922           bc      main001         ;ENDE(1) Taste nicht gedrueck
  843                                                                                                            923           goto    main            ;Neustart
  844   main:                                                                                                    924   ;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  845           rcall   init            ;Initialize everything                                                   925   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
  846           bsf     a_reset         ;                                                                        926   main00:                         ;
  847           call    rs232init       ;                                                                        927           LCDStrp qtext28         ;Text "Eeprom refresh "
  848   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          928           clrf    schleife        ;256 Byte
  849   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          929           clrf    data_ee_addr    ;Adresse 0 im Eeprom
  850   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          930   main000:                        ;SCHLEIFE(1)
  851   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          931           call    eread           ; Byte lesen
  852           ifdef   mathetest                                                                                932           call    ewrite          ; wieder schreiben
  853           MOVLF   1,band                                                                                   933           incf    data_ee_addr,F ; Adresse+1
  854           MOVLF   .4,step                                                                                  934           decfsz schleife,F       ;
  855           call    umschalten_step                                                                          935           bra     main000         ;ENDE(1) 256 Byte aufgefrischt
  856           endif                                                                                            936           call    t500mSek        ;ein bischen warten
  857   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          937           call    readsicherung   ;letzte Sicherung einlesen
  858   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          938           rcall   mtausrechnen    ;Mithoerton ausrechnen
  859   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          939           rcall   quittungston    ;Quittungston ausgeben
  860           rcall   LCDInit         ;Initialisierung LCD                                                     940           movff   band,bandneu    ;Bandumschaltung gueltig machen
  861   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          941           call    ebandread       ;und Werte lesen sonst stehen im Ram falsche Werte
  862   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          942           btfsc   bbandmode       ;? aktive Umschaltung mit Tasten fuer Mode und Band
  863   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          943           bra     main00a         ;
  864   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          944           call    ubandmessen     ;0 Messen welches Band eingestellt ist
  865           ifdef   mathetest                                                                                945           call    umodemessen     ; Messen welcher Mode eingestellt ist
  866           rcall   mtausrechnen    ;Mithoerton ausrechnen                                                   946   main00a:                        ;
  867           endif                                                                                            947           call    bandrs232       ;
  868   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          948           call    moders232       ;
  869   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          949           call    bandrs232       ;
  870   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          950           call    moders232       ;
  871   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          951           call    ddsinit         ;DDS init
  872           bsf     blcdneu         ;LCD neu anzeigen                                                        952           btfsc   blauto          ;? Lichautomatik
  873           bsf     bddsneu         ;DDS einstellen                                                          953           bsf     a_licht         ;1 Hintergrundbeleuchtung ein
  874           MOVLF   .1,ebene        ;Menugrundstellung                                                       954           btfsc   bbeleuchtung    ;? Dauerlicht
  875           MOVLF   .16,zeitschlitz ;Zeitschlitz einstellen                                                  955           bsf     a_licht         ;1 Hintergrundbeleuchtung ein

Dienstag November 10, 2009                                                                              mc.pic                                                                                                       6/40
                                                                                                                                                                                                     Printed by Andreas
 Nov 10, 09 8:32                                     mc.pic                                Page 13/79            Nov 10, 09 8:32                                   mc.pic                                  Page 14/79
  956             MOVLF   1,step          ;10Hz Anzeige einstellen                                               1036           call    LCDAnzeigeZ1    ;    LCD neu anzeigen Zeile1
  957             btfsc   b1hzanz         ;? 1Hz Anzeige                                                         1037           call    LCDAnzeigeZ2    ;    LCD neu anzeigen Zeile2
  958             clrf    step            ;1 1Hz Anzeige einstellen                                              1038           bcf     blcdneu         ;    BIT loeschen LCD neuanzeige
  959             rcall   zs1laden        ;Timer 1Sek laden                                                      1039   ;..............................................................................
  960   main01:                           ;SCHLEIFE(1)                                                           1040   main03:
  961           btfsc     a_tastungein    ; ? Sendertastung AUS                                                  1041   ;..............................................................................
  962           bra       main0011        ;                                                                      1042   main04:
  963           btfsc     a_senderein     ; 1 ? Sender noch EIN                                                  1043           btfss   bddsneu         ; ? DDS neu berechnen
  964           rcall     test_s_timerende;    1 test ob die Zeit abgelaufen ist                                 1044           bra     main05          ;
  965   main0011:                         ;                                                                      1045           bcf     bnofunktion     ; 1 BIT loeschen keine Funktion durchgefuehrt
  966           bsf       bnofunktion     ; BIT setzen keine Funktion durchgefuehrt                              1046           rcall   ddsbinausrechnen;    BINs neu ausrechnen tx + rx
  967           movf      impulse,F       ; ? Impulse angefallen                                                 1047           rcall   bin2ddsrx       ;    RX−Frequenz laden
  968           bz        main02          ;                                                                      1048           bcf     bddsneu         ;    bit loeschen
  969           btfsc     blauto          ; 1 ? Lichautomatik                                                    1049   ;..............................................................................
  970           bsf       a_licht         ;    1 Hintergrundbeleuchtung ein                                      1050   main05:
  971           bcf       bnofunktion     ;    BIT loeschen keine Funktion durchgefuehrt                         1051           rcall   Tastegedrueckt ; ? Taste gedrueckt
  972           rcall     zs1laden        ;    Timer 1Sek laden                                                  1052           btfss   btaste          ;
  973           movf      impulse,W       ;    Impulse holen                                                     1053           bra     main06          ;
  974           btfss     bmenu           ;    ? Menue aktiv                                                     1054           btfsc   blauto          ; 1 ? Lichautomatik
  975           bra       main014         ;                                                                      1055           bsf     a_licht         ;    1 Licht ein
  976           btfsc     impulse,7       ;    1 ? positive Drehrichtung                                         1056           bcf     bnofunktion     ;    1 BIT loeschen keine Funktion durchgefuehrt
  977           bra       main015         ;                                                                      1057           rcall   zs1laden        ;      Timer 1Sek laden
  978           andlw     B’01111100’     ;      1 ? Steps reduzieren/Steps angefallen                           1058           btfss   tonenable       ;    ? MT aktiv
  979           bz        main02          ;                                                                      1059           bra     main0502        ;
  980           incf      ebene,F         ;        1 Ebene +1                                                    1060           bcf     tonenable       ;    1 MT aus
  981           movlw     maxmenu + 1     ;          ? maximale Ebene erreicht                                   1061   main0501:                       ;
  982           btfsc     bbandmode       ;                                                                      1062           call    Tastegedrueckt ;       SCHLEIFE(2)
  983           movlw     maxmenumitband + 1;        ? maximale Ebene erreicht                                   1063           bc      main0501        ;      ENDE(2) keine Taste gedrueckt
  984           subwf     ebene,W         ;                                                                      1064           bra     main06          ;      −−> break
  985           bnz       main016         ;                                                                      1065   main0502:                       ;
  986           MOVLF     .1,ebene        ;          1 Ebene = 1                                                 1066           rcall   Tastaturstatus ;     0 ? Tasttaturabfrage
  987   main016:                          ;                                                                      1067           movlw   1               ;
  988           bra       main017         ;                                                                      1068           subwf   tastennummer,W ;
  989   main015:                          ;                                                                      1069           bnz     main051         ;
  990           movff     impulse,schleife+3;    0 negative Drehrichtung                                         1070           call    taste1behandlung;      1 Taste 1 behandeln
  991           negf      schleife+3      ;        Impulse merken da nicht reduziert                             1071   main051:                        ;
  992           movf      schleife+3,W    ;        und negieren                                                  1072           movlw   2               ;
  993           andlw     B’11111100’     ;        ? Steps reduzieren/Steps angefallen                           1073           subwf   tastennummer,W ;
  994           bz        main02          ;                                                                      1074           bnz     main052         ;
  995           decf      ebene,F         ;        1 Ebene −1                                                    1075           call    taste2behandlung;      2 Taste 2 behandeln
  996           incf      ebene,W         ;          ? Ebene < 0                                                 1076   main052:                        ;
  997           bnz       main017         ;                                                                      1077           movlw   3               ;
  998           movlw     maxmenu         ;                                                                      1078           subwf   tastennummer,W ;
  999           btfsc     bbandmode       ;                                                                      1079           bnz     main053         ;
 1000           movlw     maxmenumitband ;                                                                       1080           call    taste3behandlung;      3 Taste 3 behandeln
 1001           movwf     ebene           ;          1 Ebene == maxmenu                                          1081   main053:                        ;
 1002   main017:                          ;                                                                      1082           movlw   4               ;
 1003           bsf       blcdneu         ;                                                                      1083           subwf   tastennummer,W ;
 1004           clrf      impulse         ;      Impulse loeschen                                                1084           bnz     main054         ;
 1005           bra       main02          ;                                                                      1085           call    taste4behandlung;      4 Taste 4 behandeln
 1006   main014:                          ;                                                                      1086   main054:                        ;
 1007           btfsc     impulse,7       ;    0 ? positive Impulse                                              1087   ;..............................................................................
 1008           bra       main010         ;                                                                      1088   main06:                         ;
 1009           clrf      impulse         ;      1 wieder Vorbereiten fuer Interrupt                             1089           btfss   bkeyeranz       ; ? Keyergeschw neu anzeigen
 1010           andlw     B’01111111’     ;        reduzieren < 127                                              1090           bra     main07          ;
 1011           movwf     schleife+3      ;                                                                      1091           bcf     bnofunktion     ; 1 Idle−Funktion loeschen
 1012   main011:                          ;        SCHLEIFE(1)                                                   1092           bsf     blcdneu         ;
 1013           btfss     block           ;          ? kein LOCK                                                 1093   ;..............................................................................
 1014           rcall     stepadd         ;          1 step addieren                                             1094   main07:                         ;
 1015           decfsz    schleife+3,F    ;                                                                      1095           bcf     bkein_mt        ; Mithoerton erlauben
 1016           bra       main011         ;        ENDE(1) Impulse==0 LOCK                                       1096           movlw   modecw          ; ? CW oder CWr und Keyer ein
 1017           bra       main013         ;                                                                      1097           subwf   mode,W          ;
 1018   main010:                          ;                                                                      1098           bz      main074         ;
 1019           negf      impulse         ;        komplementaer bilden                                          1099           movlw   modecwr         ;
 1020           movf      impulse,W       ;        in WREG laden                                                 1100           subwf   mode,W          ;
 1021           clrf      impulse         ;        wieder fuer Interrupt vorbereiten                             1101           bz      main074         ;
 1022           movwf     schleife+3      ;        Schleifenzaehler laden                                        1102           bsf     bkein_mt        ;    kein CW oder CWr Mithoerton nicht erlauben
 1023   main012:                          ;        SCHLEIFE(1)                                                   1103           bra     main071         ;
 1024           btfss     block           ;          ? kein LOCK                                                 1104   main074:                        ;
 1025           rcall     stepsub         ;          1 step subtrahieren                                         1105           btfss   bkeyerein       ; 1 ? Keyer aktiv
 1026           decfsz    schleife+3,F    ;                                                                      1106           bra     main071         ;
 1027           bra       main012         ;        ENDE(1) Impulse=0                                             1107           btfsc   e_punktpin      ;    1 ? keyer gedrueckt punkt
 1028   main013:                                                                                                 1108           bra     main0741        ;
 1029           bsf     blcdneu         ;                                                                        1109           btfss   bmenu           ;      1 ? Menu ein
 1030           bsf     bddsneu         ;      Frequenz neu berechnen                                            1110           bra     main0742        ;
 1031   ;..............................................................................                          1111           bsf     tonenable       ;        1 Mithoerton ein
 1032   main02:                                                                                                  1112           call    swrmessen       ;          SWR messen
 1033           btfss   blcdneu         ; ? LCD neu anzeigen beide Zeilen                                        1113           bcf     tonenable       ;          Mithoerton aus
 1034           goto    main03          ;                                                                        1114           bra     main0741        ;
 1035           bcf     bnofunktion     ; 1 BIT loeschen keine Funktion durchgefuehrt                            1115   main0742:                       ;

Dienstag November 10, 2009                                                                              mc.pic                                                                                                     7/40
                                                                                                                                                                                                     Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                  Page 15/79            Nov 10, 09 8:32                                   mc.pic                                  Page 16/79
 1116           bsf     bpunkt          ;        0 punkt merken                                                  1196           bra     main11          ;
 1117   main0741:                       ;                                                                        1197           btfsc   blauto          ;    1 ? Autolicht
 1118           btfss   e_strichpin     ;      ? keyer gedrueckt strich                                          1198           bcf     a_licht         ;      1 Licht aus
 1119           bsf     bstrich         ;      1 strich merken                                                   1199           btfsc   bbeleuchtung    ;      ? Dauerlicht
 1120           btfss   bpunkt          ;      ? wurde ein Punkt gespeichert                                     1200           bsf     a_licht         ;      1 Licht ein
 1121           bra     main08          ;                                                                        1201           bcf     bkeyeranz       ;      Keyeranzeige in LCD nicht anzeigen
 1122           bcf     bnofunktion     ;      1 Idle−Funktion loeschen                                          1202           bcf     bzs1einaus      ;      Funktion ein −> aus deaktivieren
 1123           rcall   bin2ddstx       ;        Sendefrequenz einstellen                                        1203           bsf     blcdneu         ;      LCD neu Anzeigen
 1124           bsf     a_senderein     ;        Sender einschalten                                              1204   ;..............................................................................
 1125           bsf     tonenable       ;        Mithoerton ein                                                  1205   main10:
 1126           bsf     a_tastungein    ;        Sender Tastung ein                                              1206           bcf     bnofunktion     ; wichtige Funktion ausgefuehrt
 1127           call    punkt           ;        Punktdauer warten                                               1207   main11:
 1128           bcf     a_tastungein    ;        Sender Tastung aus                                              1208   ;..............................................................................
 1129           rcall   sendertimerein ;         SenderAusVerzoegerung                                           1209   main80:                         ;
 1130           bcf     tonenable       ;        Mithoerton aus                                                  1210           btfss   bnofunktion     ; ? keine wichtigen Funktionen angefallen
 1131           call    punkt           ;        Punktdauer warten                                               1211           bra     main99          ; 0 −−−> sofort wieder von Vorn alle wichtigen
 1132           bcf     bpunkt          ;        gemerkten Punkt loeschen                                        1212                                   ;    Funktionen abklappern
 1133           bra     main99          ;        −−> break zum Schleifenende                                     1213   ;..............................................................................
 1134   main071:                        ;                                                                        1214           movlw   .1              ;
 1135           btfsc   e_punktpin      ;    0 ? Handtaste Taste gedrueckt                                       1215           subwf   zeitschlitz,W   ; 1 ? Zeitschlitz
 1136           bra     main072         ;                                                                        1216           bnz     main801         ;      1.Zeitschlitz Bandumschaltung
 1137           btfsc   a_tastungein    ;      1 ? Sendertastung noch aus                                        1217           btfss   bbandmode       ;    1 ? Bandumschaltung ueber A/D Eingang
 1138           bra     main0711        ;                                                                        1218           call    ubandmessen     ;      1 feststellen ob Band umgeschalten wurde am A/D eingang
 1139           bcf     bnofunktion     ;        1 Bit fuer keine Funktion loeschen                              1219           movf    band,W          ;      ? neues Band
 1140           rcall   bin2ddstx       ;          Sendefrequenz einstellen                                      1220           subwf   bandneu,W       ;
 1141           bsf     a_senderein     ;          Sender einschalten                                            1221           bz      main801         ;
 1142           bsf     a_tastungein    ;          Sender Tastung EIN                                            1222           btfss   bbandmode       ;      1 ? Bandumschaltung ueber A/D Eingang
 1143           btfss   bkein_mt        ;          ? ist Mithoerton erlaubt                                      1223           rcall   quittungston    ;        1 Quittungston
 1144           bsf     tonenable       ;          1 Mithoerton ein                                              1224           rcall   LCDDisplayClear ;        Display loeschen
 1145   main0711:                                                                                                1225           movf    bandneu,W       ;        an Zeilenanfang
 1146           rcall   sendertimerein ;         SenderAusVerzoegerung                                           1226           rcall   LCDHEX          ;        Bandnummer in Hex
 1147           bra     main99          ;                                                                        1227           LCDStrp text3           ;        Text Bandwechsel zeigen
 1148   main072:                        ;                                                                        1228           call    ebandwrite      ;        altes Band speichern
 1149           bcf     a_tastungein    ;        0 Sender Tastung aus                                            1229           movff   bandneu,band    ;        neues Band aktivieren
 1150           bcf     tonenable       ;          Mithoerton aus                                                1230           call    ebandread       ;        Banddaten lesen
 1151   main073:                        ;                                                                        1231           rcall   t1Sek           ;        Zeit verstreichen lassen
 1152   ;..............................................................................                          1232           bsf     blcdneu         ;        LCD muesste mal neu angezeigt werden
 1153   main08:                         ;                                                                        1233           bsf     bddsneu         ;        DDS neu ausrechnen
 1154           movlw   modecw          ; ? CW oder CWr und Keyer ein                                            1234           rcall   zs1laden        ;        Timer 1Sek laden
 1155           subwf   mode,W          ;                                                                        1235           btfsc   blauto          ;        ? Lichautomatik
 1156           bz      main082         ;                                                                        1236            bsf    a_licht         ;        1 Licht ein
 1157           movlw   modecwr         ;                                                                        1237           MOVLF   1,step          ;        10Hz Schrittweite
 1158           subwf   mode,W          ;                                                                        1238           btfsc   bbandmode       ;        ? Bandumschaltung aktiv umschalten
 1159           bnz     main081         ;                                                                        1239           call    bandrs232       ;        1 Band auf RS232 ausgeben
 1160   main082:                                                                                                 1240   ;..............................................................................
 1161           btfss   bkeyerein       ;                                                                        1241   main801:                        ;
 1162           bra     main081         ;                                                                        1242           movlw   .2              ;    2 2.Zeitschlitz Mode−Aenderung
 1163           btfss   bstrich         ; 1 ? wurde ein Strich gespeichert                                       1243           subwf   zeitschlitz,W   ;
 1164           bra     main09          ;                                                                        1244           bnz     main802         ;
 1165           bcf     bnofunktion     ;    1 Idle−Funktion loeschen                                            1245           btfss   bbandmode       ;      ? Modeumschaltung ueber A/D Eingang
 1166   testaaa:                                                                                                 1246           call    umodemessen     ;      1 Feststellen des Modes
 1167           rcall   bin2ddstx       ;      Sendefrequenz einschalten                                         1247           movf    band,F          ;      ? Band == 0 (Messgenerator)
 1168           bsf     a_senderein     ;      Sender einschalten                                                1248           bnz     main8022        ;
 1169           bsf     tonenable       ;      Mithoerton ein                                                    1249           clrf    modeneu         ;      1 unbedingt auf MHz schalten
 1170           bsf     a_tastungein    ;      Sender Tastung EIN                                                1250   main8022:                       ;
 1171           call    punkt           ;      Punktdauer warten                                                 1251           movf    modeneu,W       ;
 1172           call    punkt           ;      Punktdauer warten                                                 1252           subwf   mode,W          ;      ? ZF−Aenderung
 1173           call    punkt           ;      Punktdauer warten                                                 1253           bz      main8021        ;
 1174           bcf     a_tastungein    ;      Sender Tastung AUS                                                1254           movff   modeneu,mode    ;      1 neu ZF aktivieren
 1175           rcall   sendertimerein ;       SenderAusVerzoegerung                                             1255           call    ezfread         ;        neue Mode−ZF einlesen
 1176           rcall   test_s_timerende;                                                                        1256           rcall   zs1laden        ;        Timer 1Sek laden
 1177           bcf     tonenable       ;      Mithoerton aus                                                    1257           btfsc   blauto          ;        ? Lichautomatik
 1178           call    punkt           ;      Punktdauer warten                                                 1258           bsf     a_licht         ;        1 Hintergrundbeleuchtung ein
 1179           bcf     bstrich         ;      gemerkten Punkt loeschen                                          1259           bsf     bddsneu         ;        DDS neu ausrechnen
 1180           bra     main99          ;      −−> break zum Schleifenende                                       1260           btfsc   bbandmode       ;        ? BandModeumschaltung aktiv
 1181   main081:                        ; 0 kein Break bei Handtastung                                           1261           call    moders232       ;        1 Mode auf RS232 ausgeben
 1182   ;..............................................................................                          1262   main8021:                       ;
 1183   main09:                                                                                                  1263   ;..............................................................................
 1184           movf    zs1,F           ; ? Timer 2 Sekunden aktiv                                               1264   main802:                        ;
 1185           bz      main09_1                                                                                 1265           movlw   .3              ;    3 3.Zeitschlitz S−Meteranzeige
 1186           btfss   bzs1ausein      ; 1 ? Funktion aus −> ein noch nicht ausgefuehrt                         1266           subwf   zeitschlitz,W   ;
 1187           bra     main11          ;                                                                        1267           bnz     main803         ;
 1188           btfsc   bbeleuchtung    ;    1 ? Dauerlicht                                                      1268           btfss   blcdsmeter      ;      ? BIT S−Meter auf LCD anzeigen
 1189           bsf     a_licht         ;      1 Licht ein                                                       1269           bra     main803         ;
 1190           bcf     bzs1ausein      ;      Funktion aus −> ein deaktivieren                                  1270           call    smeterausw      ;      1 S−Meter ablesen
 1191           bsf     bzs1einaus      ;      Funktion ein −> aus aktivieren                                    1271           CMP1    usmeter+1,usmeter;       ? neue Messung != alte Messung
 1192           bsf     blcdneu         ;      LCD neu Anzeigen                                                  1272           bz      main803         ;
 1193           bra     main10                                                                                   1273           movff   usmeter,usmeter+1;       1 Messung speichern
 1194   main09_1:                                                                                                1274           bsf     blcdneu         ;          und LCD neu anzeigen
 1195           btfss   bzs1einaus      ; 0 ? Funktion ein −> aus noch nicht ausgefuehrt                         1275   ;..............................................................................

Dienstag November 10, 2009                                                                              mc.pic                                                                                                       8/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 17/79            Nov 10, 09 8:32                                   mc.pic                                 Page 18/79
 1276   main803:                         ;                                                                      1356            bcf      a_senderein   ; 1 Sender ausschalten
 1277           movlw   .4               ;    4 4.Zeitschlitz Keyer−Geschwindigkeit                             1357            rcall    bin2ddsrx     ;    Empfangsfrequenz einstellen
 1278           subwf   zeitschlitz,W    ;                                                                      1358   ts01:                           ;
 1279           bnz     main804          ;                                                                      1359           return                  ;
 1280           btfss   bkeyerein        ;      ? Keyer aktiv                                                   1360   ;=========================================================================
 1281           bra     main804          ;                                                                      1361   ;serieller Empfang von 8 Bit an RC7
 1282           RL2     ukeyer+2         ;      1 Summe von UKeyer x 16                                         1362   ;=========================================================================
 1283           RL2     ukeyer+2         ;        weil nur 16 Idledurchlaeufe                                   1363   rs232rx:
 1284           RL2     ukeyer+2         ;        wir brauchen 256 zum auswerten                                1364           ifdef debug
 1285           RL2     ukeyer+2         ;        (Durchschnittserrechnung)                                     1365           return
 1286           movff   ukeyer+3,ukeyer ;          Summe von UKeyer holen                                       1366           endif
 1287           movf    keyergeschw,W    ;        gemerkte Ukeyer holen                                         1367   rs232rx01:
 1288           subwf   ukeyer+3,F       ;        und vergleichen                                               1368           btfss   PIR1,RCIF       ;test ob Daten
 1289           bz      main804_1        ;        ? aenderung                                                   1369           bra     rs232rx01       ;..wenn nein, dann warten
 1290            movff  ukeyer,ukeyer+3 ;                                                                       1370           movf    RCREG,W         ;Daten ins W−Register
 1291            incf   keyergeschw,W    ;           oder keyergeschw +1                                        1371           return
 1292           subwf   ukeyer+3,F       ;                                                                      1372   ;=========================================================================
 1293            bz     main804_1        ;                                                                      1373   ;Senden von 8 Bit an RC6
 1294            movff  ukeyer,ukeyer+3 ;                                                                       1374   ;=========================================================================
 1295            decf   keyergeschw,W    ;           oder keyergeschw −1                                        1375   rs232tx:
 1296            subwf  ukeyer+3,F       ;                                                                      1376           ifdef debug
 1297            bz     main804_1        ;                                                                      1377           return
 1298           btfsc   blauto           ;        1 ? Lichautomatik                                             1378           endif
 1299           bsf     a_licht          ;           1 Hintergrundbeleuchtung ein                               1379   rs232tx01:
 1300           bsf     bkeyeranz        ;           Keyergeschw neu anzeigen                                   1380           btfss   PIR1,TXIF       ;..und ob der Sendepuffer leer ist
 1301           rcall   zs1laden         ;           Timer 1Sek laden                                           1381           bra     rs232tx01       ;
 1302           movff   ukeyer,keyergeschw;          und neuen Wert merken                                      1382           movwf   TXREG           ;Sende Byte
 1303   main804_1:                       ;                                                                      1383           return
 1304           CLR4    ukeyer           ;        Summenwert loeschen                                           1384   ;==============================================================================
 1305   ;..............................................................................                         1385   ;Funktion       Dauer eines Punktes warten. Wartezeit wird 1mSek−Einheiten
 1306   main804:                                                                                                1386   ;               und dem Timer2 gebildet. Waehrend der Wartezeit wird beim
 1307           movlw   .5               ;    5 5.Zeitschlitz                                                   1387   ;               Senden die Ausgangsleistung geregelt. Weiter Funktion ist
 1308           subwf   zeitschlitz,W    ;                                                                      1388   ;               das abfragen der Paddel fuer Punkt oder Strichspeicher
 1309           bnz     main805          ;                                                                      1389   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1310           call    rxbuffer         ;      lesen aus dem RS232−Buffer                                      1390   d_pr2h          equ     .242    ;Timer2 Period Register
 1311   ;        bnc    main805          ;                                                                      1391   d_pr2l          equ     .242    ;Timer2 Period Register
 1312   ;        movwf  catbefehl        ;                                                                      1392
 1313   ;        call   LCDDisplayClear ;                                                                       1393   punkt:
 1314   ;        movf   CAT_in_byte,W    ;                                                                      1394            ifdef    debug
 1315   ;        call   LCDHEX           ;                                                                      1395            return
 1316   main8041:                                                                                               1396            endif
 1317   ;        call   rxbuffer         ;      lesen aus dem RS232−Buffer                                      1397
 1318   ;        bnc    main8042         ;                                                                      1398            call     UmessKeyerPoti;Keyergeschw vom Poti lesen
 1319   ;        call   LCDHEX           ;                                                                      1399            rcall    ukey2msek     ;aus Potiwert umrechnen in mSek
 1320   ;        bra    main8041         ;                                                                      1400            movwf    zs3           ;Timer setzen
 1321   main8042:                        ;                                                                      1401            MOVLF    d_pr2h,PR2    ;Timer 2 laden
 1322   ;        bra    main8042         ;                                                                      1402            bsf      T2CON,TMR2ON  ;Timer 2 starten
 1323   ;..............................................................................                         1403   punkt3:                         ;SCHLEIFE
 1324   main805:                                                                                                1404           btfss   e_punktpin      ; Keyer Punkt aktiv
 1325           movlw   .6               ;    6 6.Zeitschlitz                                                   1405           bsf     bpunkt          ; Punkt merken
 1326           subwf   zeitschlitz,W    ;                                                                      1406           btfss   e_strichpin     ; Keyer Strich aktiv
 1327           bnz     main806          ;                                                                      1407           bsf     bstrich         ; Strich merken
 1328   ;..............................................................................                         1408           btfss   a_tastungein    ;
 1329   main806:                                                                                                1409           rcall   test_s_timerende;
 1330   main98:                          ;    ### Funktionen ohne Zeitschlitz ###                               1410           movf    zs3,F           ; ? Timer abgelaufen
 1331                                    ;    Neue Summe fuer Keyerpoti bilden                                  1411           bnz     punkt3          ;ENDE Timer abgelaufen
 1332                                    ;    jeder Zeitschlitz wird eine Messung add.                          1412   punkt5:                         ;
 1333           btfss   bkeyerein        ;    ? Keyer aktiv                                                     1413           bcf     T2CON,TMR2ON    ;Timer 2 aus
 1334           bra     main982          ;                                                                      1414           return                  ;
 1335           call    UmessKeyerPoti ;      1 Keyerpoti messen                                                1415   ;==============================================================================
 1336           movff   messh,ukeyer     ;      als byte speichern                                              1416   ;Abfrage ob Taste 1−4 gedrueckt ist
 1337           clrf    ukeyer+1         ;      hoeherwertiges byte loeschen                                    1417   ;Ausgang        Taste gedrueckt: Bit btaste=1; Carry=1
 1338           ADD2    ukeyer+2, ukeyer;       und als word addieren                                           1418   ;               Taste nicht gedrueckt: Bit btaste=0; Carry=0
 1339   main982:                         ;                                                                      1419   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1340           decfsz zeitschlitz,F     ;    zeitschlitz−1                                                     1420   Tastegedrueckt:
 1341           bra     main981          ;    ? zeitschlitz == 0                                                1421           bcf     btaste
 1342           MOVLF   .16,zeitschlitz ;     1 zeitschlitz wieder max                                          1422           movf    PORTB,W         ;Tastenzustand einlesen
 1343   main981:                         ;                                                                      1423           andlw   B’11110000’     ;filtern
 1344   main99:                          ;                                                                      1424           xorlw   B’11110000’     ;? ist eine Taste gedrueckt
 1345           bra     main01           ;ENDE(1) endlos                                                        1425           bz      tasteged01
 1346   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                              1426           bsf     btaste          ;1 BIT setzen
 1347   sendertimerein:                          ;                                                              1427           bsf     STATUS,C        ; und C setzen
 1348           MOVLF   tmr1lconst,TMR1L         ;timer1 neu laden                                              1428           bra     tasteged02
 1349           MOVLF   tmr1hconst,TMR1H         ;                                                              1429   tasteged01:
 1350           movff   stimer,zs2               ;Sendertimer laden                                             1430           bcf     STATUS,C
 1351           return                           ;                                                              1431   tasteged02:
 1352   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                              1432           return
 1353   test_s_timerende:                ;                                                                      1433   ;==============================================================================
 1354           movf    zs2,F            ; ? Timer Sender AUS != 0                                              1434   ;Zeitschleife
 1355           bnz     ts01             ;                                                                      1435   ;1 Einheit= 1 mSek

Dienstag November 10, 2009                                                                             mc.pic                                                                                                    9/40
                                                                                                                                                                                                     Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                  Page 19/79            Nov 10, 09 8:32                                   mc.pic                                 Page 20/79
 1436   ;Einsprung bei DELAY wird mit Wert in W gerechnet                                                        1516   ;Display on/off control: display on, cursor off , cursor not blink
 1437   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                               1517   ; d7 d6 d5 d4 d3 d2 d1 d0
 1438   t5Sek:                          ;5 Sekunden                                                              1518   ; 0 0 0 0 1 D C B
 1439           rcall   t2Sek           ;3 + 2Sek.                                                               1519   ; D      1= display on           0= display off
 1440           rcall   t1Sek           ;                                                                        1520   ; C      1= cursor on            0= cursor off
 1441   t2Sek:                          ;2 Sekunden                                                              1521   ; B      1= cursor blink         0= cursor not blink
 1442           rcall   t1Sek           ;1 + 1Sek                                                                1522   ib4      equ     B’00001100’     ;Bit2=D, Bit1=C, Bit0=B
 1443   t1Sek:                          ;1 Sekunde                                                               1523   ;==============================================================================
 1444           rcall   t250mSek        ;4 x 250mSek                                                             1524   ;Cursor Display shift: display shift, right shift
 1445           rcall   t250mSek        ;                                                                        1525   ; d7 d6 d5 d4 d3 d2 d1 d0
 1446   t500mSek:                       ;500 mSekunde                                                            1526   ; 0 0 0 1 S/C F/L * *
 1447           rcall   t250mSek        ;2 x 250mSek                                                             1527   ; S/C    1= display shift        0= cursor move
 1448   t250mSek:                       ;250 mSekunden                                                           1528   ; F/L    1= right shift          0= left shift
 1449           movlw   .250            ;                                                                        1529   ib5      equ     B’00010100’     ;Bit3=S/C, Bit2=R/L
 1450           bra     DELAY           ;                                                                        1530   ;==============================================================================
 1451   t200mSek:                       ;200 mSekunden                                                           1531   LCDInit:
 1452           movlw   .200            ;                                                                        1532           bcf      a_LCD_E         ;Enable auf LOW setzen
 1453           bra     DELAY           ;                                                                        1533           bcf      a_LCD_RS        ;RS ausschalten
 1454   t100mSek:                       ;100 mSekunden                                                           1534           bcf      a_LCD_RW        ;RW ausschalten
 1455           movlw   .100            ;                                                                        1535           rcall    t50mSek         ;min 15 mSek warten bevor 1. Byte geladen wird
 1456           bra     DELAY           ;                                                                        1536           movlw    ib1             ;Funktion setzen
 1457   t50mSek:                        ;50 mSekunden                                                            1537           rcall    LCDAusgabe
 1458           movlw   .50             ;                                                                        1538           movlw    ib2
 1459           bra     DELAY           ;                                                                        1539           rcall    LCDAusgabe
 1460   t10mSek:                        ;10 mSekunden                                                            1540           rcall    t10mSek         ;min 5 mSek warten
 1461           movlw   .10             ;10 mSek                                                                 1541           movlw    ib1             ;Funktion setzen
 1462           bra     DELAY           ;                                                                        1542           rcall    LCDAusgabe
 1463   t1mSek:                         ;1 mSekunde                                                              1543           movlw    ib2
 1464           movlw   1               ;1 mSek                                                                  1544           rcall    LCDAusgabe
 1465   DELAY:                          ;                                                                        1545           rcall    t1mSek          ;1 mSek warten
 1466   ; Delay code generated by PiKloops (Mi 2008−Jul−09 08:37:15)                                             1546           movlw    ib3             ;LCD entsprechend einstellen
 1467   ; Time Delay = 0.00100000s with Osc = 20.00000000MHz                                                     1547           rcall    LCDCom
 1468                                                                                                            1548           movlw    ib4
 1469          ifdef    debug          ;Zeitschleife verkuerzen                                                  1549           rcall    LCDCom
 1470          return                  ;beim Simulieren                                                          1550           movlw    ib5
 1471          endif                                                                                             1551           rcall    LCDCom
 1472                                                                                                            1552           rcall    LCDDefSonderzeichen;Sonderzeichen in die LCD laden
 1473           movwf   CounterC        ;dazu von DL4JAL Sp. fuer mSek                                           1553           rcall    LCDDisplayClear ;LCD loeschen + Cursor auf null
 1474   delay_0.001_sec                 ;                                                                        1554           LCDStrp text1            ;(c) ausgeben
 1475           movlw   D’7’            ;                                                                        1555           LCDStrp text2
 1476           movwf   CounterB        ;                                                                        1556           rcall    t2Sek
 1477           movlw   D’125’          ;                                                                        1557           rcall    LCDDisplayClear ;LCD loeschen + Cursor auf null
 1478           movwf   CounterA        ;                                                                        1558           bsf      a_licht         ;
 1479   delay_0.001_sec_loop            ;                                                                        1559           return
 1480           decfsz CounterA,1       ;                                                                        1560   ;==============================================================================
 1481           bra     delay_0.001_sec_loop                                                                     1561   ;Ausgabe eines Char auf dem Display
 1482           decfsz CounterB,1       ;                                                                        1562   ;RS = 1
 1483           bra     delay_0.001_sec_loop                                                                     1563   ;R/W = 0
 1484           decfsz CounterC,F       ;                                                                        1564   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1485           bra     delay_0.001_sec ;                                                                        1565   LCDChar:
 1486           return                  ;                                                                        1566           movwf    LCDByte         ;Byte merken
 1487   ;===============================================================================                         1567           rcall    LCDRdy          ;ob LCD bereit
 1488   quittungsdton:                                                                                           1568           movf     LCDByte,w       ;
 1489           bsf     tonenable                                                                                1569           bsf      a_LCD_RS        ;RS einschalten
 1490           rcall   t50mSek                                                                                  1570           bcf      a_LCD_RW        ;RW ausschalten
 1491           bcf     tonenable                                                                                1571           bcf      a_LCD_E         ;Enable ausschalten
 1492           rcall   t50mSek                                                                                  1572           andlw    B’11110000’     ;oberes Nibbel verwenden
 1493   quittungston:                                                                                            1573           rcall    LCDAusgabe      ;zur LCD schicken
 1494           bsf     tonenable                                                                                1574           swapf    LCDByte,w       ;unteres Nibbel laden vom gemerkten Byte
 1495           rcall   t50mSek                                                                                  1575           andlw    B’11110000’     ;und zur LCD−Ausgabe vorbereiten
 1496           bcf     tonenable                                                                                1576           bra      LCDAusgabe      ;call einsparen und an LCD ausgeben
 1497           bcf     a_senderein     ;sender aus                                                              1577   ;##############################################################################
 1498           bcf     a_tastungein    ;tastung des Traegers aus                                                1578   ;Funktion        LCD−Commandos zum definieren eines Sonderzeichens
 1499           return                                                                                           1579   ;Eingang         Adresse 0 bis 7 im W Register
 1500                                                                                                            1580   ;                Bytes des Sonderzeichen im Programmspeicher TABLAT
 1501   ;===============================================================================                         1581   ;Ausgang         Zeichen sind in LCD gespeichert
 1502   ;Initialisierung der LCD Anzeige                                                                         1582   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1503   ;                                                                                                        1583   LCDDefine:
 1504   ;==============================================================================                          1584           movwf    LCDByte         ;Byte merken
 1505   ;Function Set: 4 bit Datenbreite; 2 Zeilen                                                               1585           rlncf    LCDByte,F       ;x 8 multiplizieren
 1506   ib1     equ     B’00100000’      ;Function set 1. nibel 4.Bitmodus                                       1586           rlncf    LCDByte,F       ;
 1507   ib2     equ     B’10000000’      ;Function set 2. nibel                                                  1587           rlncf    LCDByte,F       ;
 1508   ;==============================================================================                          1588           rcall    LCDRdy          ;ist LCD bereit
 1509   ;Entry Mode Set: increment, display shift                                                                1589           movf     LCDByte,w       ;zuerst oberes Nibbel
 1510   ; d7 d6 d5 d4 d3 d2 d1 d0                                                                                1590           iorlw    0x40            ;Zeichenspeicher schreiben
 1511   ; 0 0 0 0 0 1 I/D S                                                                                      1591           rcall    LCDCom          ;LCD Zeichenadresse festlegen
 1512   ; I/D 1= increment      0= decrement                                                                     1592           MOVLF    8,schleife      ;8 Byte in LCD speichern
 1513   ; S   1= display shift 0= display freeze                                                                 1593   LCDDef01:                        ;SCHLEIFE(1)
 1514   ib3     equ     B’00000110’      ;Bit1=I/D, Bit0=S                                                       1594           tblrd    *+              ; Programmspeicher lesen und INC
 1515   ;==============================================================================                          1595           movf     TABLAT,W        ; Lesergebnis in W

Dienstag November 10, 2009                                                                              mc.pic                                                                                                   10/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 21/79            Nov 10, 09 8:32                                   mc.pic                                 Page 22/79
 1596           rcall   LCDChar         ; und in LCD Speichern                                                  1676           bcf     a_LCD_RS        ;Status lesen aktivieren
 1597           decfsz schleife,F       ;                                                                       1677           bsf     a_LCD_RW
 1598           bra     LCDDef01        ;END(1) 8 Byte geschrieben                                              1678   LCDRdy1:
 1599           return                  ;                                                                       1679           bcf     LCDr
 1600   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         1680           bsf     a_LCD_E
 1601   LCDDefSonderzeichen:                                                                                    1681           nop
 1602           POINT   TabelleSonderzeichen; Sonderzeichentabelle in TABPOINTER                                1682           btfss   LCDPort,7
 1603           MOVLF   8,schleife+1    ;8 Sonderzeichen in LCD erzeugen                                        1683           bsf     LCDr
 1604           clrf    schleife+2      ;Beginn bei Adresse 0                                                   1684           bcf     a_LCD_E
 1605   LCDDefS01:                      ;SCHLEIFE(1)                                                            1685           nop
 1606           movf    schleife+2,W    ; Adresse ins W                                                         1686           bsf     a_LCD_E
 1607           rcall   LCDDefine       ; und Darstellung in LCD schreiben 8 Byte                               1687           nop
 1608           incf    schleife+2,F    ; Adresse + 1                                                           1688           bcf     a_LCD_E
 1609           decfsz schleife+1,F     ;                                                                       1689           btfss   LCDr
 1610           bra     LCDDefS01       ;ENDE(1) 8 komplette Chardarstellungen                                  1690           bra     LCDRdy1
 1611           return                  ;                                                                       1691           bcf     LCDTris,7       ;Port wieder zurueck
 1612   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         1692           bcf     a_LCD_RW
 1613   ;Sonderzeichentabelle                                                                                   1693           return
 1614   TabelleSonderzeichen:                                                                                   1694   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1615   Sonderzeichen1:                                                                                         1695   LCDDisplayClear:
 1616           DB      0,0,0,0x10,0x10,0,0,0                    ;|                                             1696           movlw   B’00000001’
 1617   Sonderzeichen2:                                                                                         1697           bra     LCDCom
 1618           DB      0,0,0,0x14,0x14,0,0,0                    ;||                                            1698   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1619   Sonderzeichen3:                                                                                         1699   LCDCursorHome:
 1620           DB      0,0,0,0x15,0x15,0,0,0                    ;|||                                           1700           movlw   B’00000010’
 1621   Sonderzeichen4:                                                                                         1701           bra     LCDCom
 1622           DB      0,0x01,0x01,0x15,0x15,0x01,0x01,0                                                       1702   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1623   Sonderzeichen5:                                                                                         1703   LCDCursorZeile1:
 1624           DB      0,0x10,0x10,0x10,0x10,0x10,0x10,0                        ;|                             1704           movlw   B’10000000’
 1625   Sonderzeichen6:                                                                                         1705           bra     LCDCom
 1626           DB      0,0x14,0x14,0x14,0x14,0x14,0x14,0                        ;||                            1706   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1627   Sonderzeichen7:                                                                                         1707   LCDCursorZeile2:
 1628           DB      0,0x15,0x15,0x15,0x15,0x15,0x15,0                        ;|||                           1708           movlw   B’11000000’
 1629   Sonderzeichen8:                                                                                         1709           bra     LCDCom
 1630           DB      0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff                                                 1710   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1631   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         1711   LCDPos:
 1632   ;Ausgabe eines LCD−Commandos zur Steuerung der LCD                                                      1712           iorlw   B’10000000’
 1633   ;RS = 0                                                                                                 1713           bra     LCDCom
 1634   ;R/W = 0                                                                                                1714   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1635   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         1715   LCDSpace:
 1636   LCDCom:                                                                                                 1716           movlw   ’ ’
 1637           movwf   LCDByte         ;Byte merken                                                            1717           bra     LCDChar
 1638           rcall   LCDRdy          ;ist LCD bereit                                                         1718   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1639           movf    LCDByte,W       ;zuerst oberes Nibbel                                                   1719   LCDSpacel:
 1640           andlw   B’11110000’                                                                             1720           movwf   schleife
 1641           bcf     a_LCD_RS        ;RS ausschalten                                                         1721   LCDSpacel01:
 1642           bcf     a_LCD_RW        ;RW ausschalten                                                         1722           rcall   LCDSpace
 1643           bcf     a_LCD_E         ;Enable ausschalten                                                     1723           decfsz schleife,F
 1644           rcall   LCDAusgabe      ;ausgeben                                                               1724           bra     LCDSpacel01
 1645           swapf   LCDByte,W       ;und dann unteres Nibbel                                                1725           return
 1646           andlw   B’11110000’     ;ausgeben                                                               1726   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1647   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         1727   LCDHEX:
 1648   LCDAusgabe:                                                                                             1728           movwf   LCDByte2
 1649           btfsc   LCDPort,0       ;? test ob Bit gesetzt                                                  1729           swapf   LCDByte2,W
 1650           iorlw   B’00000001’     ;1 Bit nicht veraendern                                                 1730           rcall   bcd2ascii_1b
 1651           btfsc   LCDPort,1       ;? test ob Bit gesetzt                                                  1731           rcall   LCDChar
 1652           iorlw   B’00000010’     ;1 Bit nicht veraendern                                                 1732           movf    LCDByte2,W
 1653           btfsc   LCDPort,2       ;? test ob Bit gesetzt                                                  1733           rcall   bcd2ascii_1b
 1654           iorlw   B’00000100’     ;1 Bit nicht veraendern                                                 1734           bra     LCDChar
 1655           btfsc   LCDPort,3       ;? test ob Bit gesetzt                                                  1735   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1656           iorlw   B’00001000’     ;1 Bit nicht veraendern                                                 1736   LCDStringp:                     ;Zuerst Position festlegen
 1657           movwf   LCDPort         ;an PORT anlegen                                                        1737           tblrd   *+              ;als erstes LCD−Position laden
 1658   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         1738           movf    TABLAT,W        ;und an LCD die Cursorposition
 1659   Enable:                                                                                                 1739           rcall   LCDPos          ;geben
 1660           bsf     a_LCD_E         ;LH Flanke uebernimmt LCD die 4 Bit                                     1740   LCDString:                      ;Dann String ausgeben
 1661           bcf     a_LCD_E                                                                                 1741   LCDStr02:                       ;SCHLEIFE(1)
 1662           return                                                                                          1742           tblrd   *+              ; Zeichen aus Code holen
 1663   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         1743           movf    TABLAT,W        ; Zeichen
 1664   ;lesen des Statusbits der LCD−anzeige                                                                   1744           bz      LCDStr01
 1665   ;BS = 0                                                                                                 1745           rcall   LCDChar         ; an LCD ausgeben
 1666   ;R/W = 1                                                                                                1746           bra     LCDStr02        ;ENDE(1) wenn Zeichen = 0
 1667   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         1747   LCDStr01:
 1668   LCDRdy:                                                                                                 1748           return
 1669           ifdef   debug           ;Zeitschleife verkuerzen                                                1749   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1670           return                  ;beim Simulieren                                                        1750   rs232String:                    ;Dann String ausgeben
 1671           endif                                                                                           1751   rs232Str02:                     ;SCHLEIFE(1)
 1672                                                                                                           1752           tblrd   *+              ; Zeichen aus Code holen
 1673          bsf     LCDPort,7                                                                                1753           movf    TABLAT,W        ; Zeichen
 1674          bsf     LCDTris,7       ;Port vorbereiten zum Lesen                                              1754           bz      rs232Str01
 1675                                                                                                           1755           rcall   rs232tx         ; an LCD ausgeben

Dienstag November 10, 2009                                                                             mc.pic                                                                                                   11/40
                                                                                                                                                                                                         Printed by Andreas
 Nov 10, 09 8:32                                     mc.pic                                  Page 23/79            Nov 10, 09 8:32                                      mc.pic                                Page 24/79
 1756           bra     rs232Str02      ;ENDE(1) wenn Zeichen = 0                                                  1836           andlw   B’11110000’     ;filtern
 1757   rs232Str01:                                                                                                1837           subwf   schleife+1,W    ;? war die Eingabe gleich
 1758           return                                                                                             1838           bnz     Tastaturstatus ;0 nein wieder von ganz vorn
 1759   ;;;;;;; Initial subroutine ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                            1839           decfsz schleife,F       ;1 gueltig Zaehler dec
 1760   ;                                                                                                          1840           bra     Tastaturst1     ;? gueltige Eingabenanzahl erreicht
 1761   ; This subroutine performs all initializations of variables and registers.                                 1841           movlw   0               ;keine gueltige Tastennummer
 1762                                                                                                              1842           btfss   schleife+1,7    ;? taste 1
 1763   init:                                                                                                      1843           movlw   1               ;1 Nr 1
 1764            MOVLF  d_adcon1,ADCON1         ;Enable PORTA & PORTE digital I/O pins                             1844           btfss   schleife+1,6    ;? taste 2
 1765   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                            1845           movlw   2               ;1 Nr 2
 1766           if      bytevariante >= .21     ;alle Varianten mit PIC18F4520                                     1846           btfss   schleife+1,5    ;? taste 3
 1767   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                            1847           movlw   3               ;1 Nr 3
 1768            MOVLF  d_adcon2,ADCON2         ;                                                                  1848           btfss   schleife+1,4    ;? taste 4
 1769   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                            1849           movlw   4               ;1 Nr 4
 1770           endif                                                                                              1850           movwf   tastennummer    ;Tastennummer abspeichern
 1771   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                            1851           return
 1772            MOVLF  d_trisa,TRISA           ;Set I/O for PORTA                                                 1852   ;==============================================================================
 1773            MOVLF  d_trisb,TRISB           ;Set I/O for PORTB                                                 1853   ;Ausrechnen der RX und TX DDS−Werte
 1774            MOVLF  d_trisc,TRISC           ;Set I/0 for PORTC                                                 1854   ;..............................................................................
 1775            MOVLF  d_trisd,TRISD           ;Set I/O for PORTD                                                 1855   ddsbinausrechnen:
 1776            MOVLF  d_trise,TRISE           ;Set I/O for PORTE                                                 1856                                            ;RX Frequenz ausrechnen
 1777           MOVLF   d_rcon,RCON                                                                                1857           rcall   math_ramclr             ;Ram loeschen
 1778           MOVLF   d_intcon,INTCON                                                                            1858           rcall   fpointerladendds         ;entsprechenden VFO laden
 1779           MOVLF   d_intcon2,INTCON2                                                                          1859           lfsr    1,faktor1               ;Frequenz 5 Byte
 1780           MOVLF   d_intcon3,INTCON3                                                                          1860           MOVLF   5,schleife              ;
 1781           MOVLF   d_pie1,PIE1                                                                                1861   ddsaus01:                               ;SCHLEIFE(1)
 1782           MOVLF   d_pie2,PIE2                                                                                1862           movf    POSTINC0,W              ; nach Faktor1 laden
 1783           MOVLF   d_t1con,T1CON                                                                              1863           movwf   POSTINC1                ;
 1784           MOVLF   d_t2con,T2CON                                                                              1864           decfsz schleife,F               ;
 1785           MOVLF   d_t3con,T3CON                                                                              1865           bra     ddsaus01                ;ENDE(1) nach 5 byte
 1786           MOVLF   d_porta,PORTA                                                                              1866
 1787           MOVLF   d_portb,PORTB                                                                              1867           movf     band,F                  ;?   Messmodus
 1788           MOVLF   d_portc,PORTC                                                                              1868           bz       ddsaus00                ;1   −−−> ZF nicht beruecksichtigen
 1789           MOVLF   d_portd,PORTD                                                                              1869           btfss    bohnezf                 ;0   ? ohne ZF
 1790           MOVLF   d_porte,PORTE                                                                              1870           rcall    zfbehandlung            ;    0 Zf binaer addieren
 1791           MOVLF   0xff,schleife                                                                              1871           btfsc    bvfox4                  ;    ? VFO x 4
 1792           lfsr    0,0                                                                                        1872           rcall    vfox4                   ;    1 mit 4 multiplizieren
 1793   init1:                                                                                                     1873   ddsaus00:
 1794           clrf    POSTINC0                ;RAM komplett loeschen                                             1874           movff    ddskonst,faktor2        ;Konstande 5Byte in Faktor2 laden
 1795           decfsz schleife,F               ;                                                                  1875           movff    ddskonst+1,faktor2+1
 1796           bra     init1                   ;                                                                  1876           movff    ddskonst+2,faktor2+2
 1797           btfsc   blauto                  ;                                                                  1877           movff    ddskonst+3,faktor2+3
 1798           bsf     a_licht                 ;                                                                  1878           movff    ddskonst+4,faktor2+4
 1799           btfsc   bbeleuchtung            ;                                                                  1879
 1800           bsf     a_licht                 ;                                                                  1880           rcall    mul5b                   ;Multiplikation mit 1Hz Konstande
 1801           MOVLF   tmr1lconst,TMR1L        ;timer1 neu laden                                                  1881           movff    ergebnis+4,ddsbinrx     ;Ergebnis / 2 hoch 32 teilen
 1802           MOVLF   tmr1hconst,TMR1H        ;                                                                  1882           movff    ergebnis+5,ddsbinrx+1   ;das bedeutet das die ersten 4 Byte
 1803           goto    zs1laden                ;                                                                  1883           movff    ergebnis+6,ddsbinrx+2   ;hinter dem Komma sind
 1804   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                            1884           movff    ergebnis+7,ddsbinrx+3   ;
 1805   mtausrechnen:                                                                                              1885                                            ;TX Frequenz ausrechnen
 1806           rcall   math_ramclr             ;Tonhoehe ausrechnen                                               1886           rcall    math_ramclr             ;Ram loeschen
 1807           LDK2    faktor1, HIGH tmr0wert, LOW tmr0wert                                                       1887           rcall    fpointerladenddstx      ;entsprechenden VFO laden
 1808           movff   mithoerton, faktor2     ;                                                                  1888           lfsr     1,faktor1               ;
 1809           rcall   div5b                   ;                                                                  1889           MOVLF    5,schleife              ;
 1810           rcall   neg5ergebnis            ;                                                                  1890   ddsaus02:                                ;SCHLEIFE(1)
 1811           movff   ergebnis,tmr0const      ;                                                                  1891           movf     POSTINC0,W              ; nach Faktor1 laden
 1812           MOVLF   tmr0const,TMR0L         ;                                                                  1892           movwf    POSTINC1                ;
 1813           MOVLF   d_t0con,T0CON           ;                                                                  1893           decfsz   schleife,F              ;
 1814           return                                                                                             1894           bra      ddsaus02                ;ENDE(1) nach 5 byte
 1815   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                            1895
 1816   zs1laden:                                                                                                  1896           movf     band,F                  ;? kein Messmodus
 1817           MOVLF   .200,zs1                ;genau 2 Sekunden Einheit = 10 mSek                                1897           bz       ddsaus03                ;
 1818           bsf     bzs1ausein              ;                                                                  1898           btfsc    bohnezf                 ;1 ? alles mit ZF
 1819           return                                                                                             1899           bra      ddsaus04                ;
 1820   ;==============================================================================                            1900           movlw    modecw                  ;
 1821   ;Abfragen Tastenstatus mit Entprellung                                                                     1901           subwf    mode,W                  ; 1 ? kein CW oder CWr
 1822   ;Ausgang        Nummer der Taste in tastennummer                                                           1902           bz       ddsaus021               ;
 1823   ;               1−4 sind gueltige Tasten 0= ungueltig                                                      1903           movlw    modecwr                 ;
 1824                                                                                                              1904           subwf    mode,W                  ; 1 ? kein CW oder CWr
 1825   tastcounter       equ     .40     ;Anzahl der Eingabesequenzen die geprueft werden                         1905           bz       ddsaus021               ;
 1826                                     ;auf Gleichheit                                                          1906           rcall    zfbehandlung            ;      1 ZF add. oder sub.
 1827                                                                                                              1907           bra      ddsaus04                ;
 1828   Tastaturstatus:                                                                                            1908   ddsaus021:                               ;
 1829           MOVLF     tastcounter,schleife    ;zwischenspeichern                                               1909           btfsc    btxpermzf               ;    1 ? ZF permanent
 1830   Tastaturst1:                                                                                               1910           rcall    zfbehandlung            ;      1 ZF add. oder sub.
 1831           movf      PORTB,W         ;Tastenzustand einlesen                                                  1911   ddsaus04:                                ;
 1832           andlw     B’11110000’     ;filtern                                                                 1912           btfsc    bvfox4                  ; ? VFO x 4
 1833           movwf     schleife+1      ;merken                                                                  1913           rcall    vfox4                   ; 1 mit 4 multiplizieren
 1834           rcall     t1mSek          ;1 mSek warten                                                           1914   ddsaus03:                                ;
 1835           movf      PORTB,W         ;erneut einlesen                                                         1915           movff    ddskonst,faktor2        ;Konstande 5Byte in Faktor2 laden

Dienstag November 10, 2009                                                                                mc.pic                                                                                                     12/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                    mc.pic                                Page 25/79            Nov 10, 09 8:32                                         mc.pic                           Page 26/79
 1916           movff   ddskonst+1,faktor2+1    ;                                                               1996           subwf   INDF0,F
 1917           movff   ddskonst+2,faktor2+2    ;                                                               1997   bcdtobin4:
 1918           movff   ddskonst+3,faktor2+3    ;                                                               1998           btfss   INDF0,3
 1919           movff   ddskonst+4,faktor2+4    ;                                                               1999           bra     bcdtobin5
 1920                                                                                                           2000           movlw   3
 1921            rcall  mul5b                   ;Multiplikation mit 1Hz Konstande                               2001           subwf   INDF0,F
 1922            movff  ergebnis+4,ddsbintx     ;Ergebnis / 2 hoch 32 teilen                                    2002   bcdtobin5:
 1923            movff  ergebnis+5,ddsbintx+1   ;das bedeutet das die ersten 4 Byte                             2003           movf    POSTINC0,F
 1924            movff  ergebnis+6,ddsbintx+2   ;hinter dem komma sind                                          2004           decfsz schleife,F
 1925            movff  ergebnis+7,ddsbintx+3   ;                                                               2005           bra     bcdtobin3
 1926            return                         ;                                                               2006           decfsz schleife+1,F
 1927   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2007           bra     bcdtobin1
 1928   vfox4:                                  ;                                                               2008           return
 1929            clrc                           ;                                                               2009   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1930           RL5     faktor1                 ;                                                               2010   ;Funktion       ZF zur Frequenz addieren oder subtrahieren
 1931           RL5     faktor1                 ;                                                               2011   zfbehandlung:
 1932           return                          ;                                                               2012           btfsc   bminuszf                        ;? ZF addieren
 1933   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2013           bra     zfb01                           ;
 1934   bin2ddsrx:                                                                                              2014           ADD4    faktor1, zwischenfrequenz       ;1 FREQ = FREQ + ZF
 1935           goto    rx2dds                                                                                  2015           bra     zfb99                           ;
 1936   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2016   zfb01:                                          ;
 1937   bin2ddstx:                                                                                              2017           SUB4    faktor1, zwischenfrequenz       ;0 FREQ = FREQ − ZF
 1938           goto    tx2dds                                                                                  2018   zfb99:
 1939   ;==============================================================================                         2019           btfss   faktor1+3,7                     ;negative Zahl
 1940   ;Funktion       Ram fuer Multiplikation loeschen                                                        2020           return
 1941   ;Ausgang        ergebniss, faktor1, faktor2 geloescht                                                   2021
 1942   ;Register       LFSR0, schleife                                                                         2022           NEG4    faktor1                         ;
 1943   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2023           return                                  ;
 1944                                                                                                           2024   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 1945   math_ramclr:                                                                                            2025   ;Funktion       Multiplikation der Frequenz mit der 1Hz DDS−Konst
 1946           MOVLF   .10+.8+.8,schleife      ;laenge aller beteiligten variablen                             2026   ;Ausgang        binwert steht in tempkonst2+4
 1947           lfsr    0,ergebnis              ;ergebnis ist die erste Variable                                2027
 1948   math_ramclr01:                          ;SCHLEIF(1)                                                     2028   muldds:
 1949           clrf    POSTINC0                ; byte loeschen                                                 2029           movff    ddskonst,tempkonst1     ;Konstande 5Byte in temp laden
 1950           decfsz schleife,F               ;                                                               2030           movff    ddskonst+1,tempkonst1+1
 1951           bra     math_ramclr01           ;ENDE(1) alle Math−Variablen loeschen                           2031           movff    ddskonst+2,tempkonst1+2
 1952           return                                                                                          2032           movff    ddskonst+3,tempkonst1+3
 1953   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2033           movff    ddskonst+4,tempkonst1+4
 1954   ;Funktion       laden der entsprechenden Ramadr in den Pointerram                                       2034           MOVLF    D’32’,schleife+1
 1955                                                                                                           2035   muldds1:
 1956   fpointerladen:                                                                                          2036           lfsr     0,tempkonst1     ;schleife (1)
 1957           lfsr    1,temp                                                                                  2037           lfsr     1,tempkonst2
 1958   fpointerladendds:                                                                                       2038           clrf     temp+1           ;   Ueberlauf loeschen
 1959           lfsr    0,frequenza                                                                             2039           bcf      STATUS,C         ;   Carry loeschen
 1960           btfsc   bvfo                                                                                    2040           rrcf     temp+7,F         ;   Faktor1 nach rechts schieben
 1961           lfsr    0,frequenzb                                                                             2041           rrcf     temp+6,F
 1962           return                                                                                          2042           rrcf     temp+5,F
 1963                                                                                                           2043           rrcf     temp+4,F
 1964   fpointerladenddstx:                                                                                     2044           btfss    STATUS,C         ;   ? Carry = 1 nach RR
 1965           btfss   brit             ;? Rit aktiv                                                           2045           bra      muldds2          ;
 1966           bra     fpointerladendds;0 normalen Pointer laden                                               2046           MOVLF    8,schleife       ;   1 Schleife laden mit 8
 1967           lfsr    0,frequenza      ;1 bei Rit deaktivierten VFO laden beim Senden                         2047           lfsr     0,tempkonst1
 1968           btfss   bvfo                                                                                    2048           lfsr     1,tempkonst2
 1969           lfsr    0,frequenzb                                                                             2049   muldds5:                          ;   schleife (2)
 1970           return                                                                                          2050           movff    POSTINC0,temp    ;     wert1 holen zwischenspeichern
 1971   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2051           movf     temp+1,W         ;     gemerketen Ueberlauf holen
 1972   bcdtobin:                                                                                               2052           clrf     temp+1           ;     und loeschen
 1973           rcall   cleartemp                ;temp loeschen                                                 2053           addwf    INDF1,F          ;     zum Ergebnis addieren
 1974           movff   POSTINC0,temp                                                                           2054           bnc      muldds4          ;     ? Ueberlauf
 1975           movff   POSTINC0,temp+1                                                                         2055           movlw    1                ;     1 neuen Ueberlauf
 1976           movff   POSTINC0,temp+2                                                                         2056           movwf    temp+1           ;       merken
 1977           movff   POSTINC0,temp+3                                                                         2057   muldds4:
 1978           MOVLF   D’32’,schleife+1         ;32 bit bcd in bin umwandeln                                   2058           movf     temp,W           ;     Wert2 = Wert2 + Wert1
 1979                                                                                                           2059           addwf    POSTINC1,F
 1980   bcdtobin1:                                                                                              2060           bnc      muldds3          ;    ? Ueberlauf
 1981           bcf     STATUS,C                                                                                2061           movlw    1                ;    1 neuen Ueberlauf
 1982           rrcf    temp+3,F                                                                                2062           movwf    temp+1           ;      merken
 1983           rrcf    temp+2,F                                                                                2063   muldds3:
 1984           rrcf    temp+1,F                                                                                2064           decfsz   schleife,F       ;   ende (2)
 1985           rrcf    temp,F                                                                                  2065           bra      muldds5
 1986           rrcf    temp+7,F                                                                                2066   muldds2:
 1987           rrcf    temp+6,F                                                                                2067           bcf      STATUS,C         ;   Carry loeschen
 1988           rrcf    temp+5,F                                                                                2068           rlcf     tempkonst1,F     ;   Wert1 nach links schieben
 1989           rrcf    temp+4,F                                                                                2069           rlcf     tempkonst1+1,F   ;   Wert1 = 2 * Wert1
 1990           lfsr    0,temp                                                                                  2070           rlcf     tempkonst1+2,F
 1991           MOVLF   4,schleife                                                                              2071           rlcf     tempkonst1+3,F
 1992   bcdtobin3:                                                                                              2072           rlcf     tempkonst1+4,F
 1993           btfss   INDF0,7                                                                                 2073           rlcf     tempkonst1+5,F
 1994           bra     bcdtobin4                                                                               2074           rlcf     tempkonst1+6,F
 1995           movlw   30H                                                                                     2075           rlcf     tempkonst1+7,F

Dienstag November 10, 2009                                                                             mc.pic                                                                                                   13/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 27/79            Nov 10, 09 8:32                                      mc.pic                              Page 28/79
 2076                                                                                                           2156           movlw   4
 2077           decfsz schleife+1,F     ;ende (1) 32 mal durchlaufen                                            2157           subwf   step,W
 2078           bra     muldds1                                                                                 2158           bz      sub100kHz
 2079           return                                                                                          2159           return
 2080   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2160   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2081   ;Funktion       loeschen des Tempram alle 10 Byte oder 4 untersten Byte                                 2161   sub100kHz:
 2082   cleartemp:                                                                                              2162           MOVLF   0xa0,temp
 2083           clrf    temp+9                                                                                  2163           MOVLF   0x86,temp+1
 2084           clrf    temp+8                                                                                  2164           MOVLF   0x01,temp+2
 2085           clrf    temp+7                                                                                  2165           bra     sub5b
 2086           clrf    temp+6                                                                                  2166   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2087           clrf    temp+5                                                                                  2167   sub1000:
 2088   cleartemp5:                                                                                             2168           LDK2    temp,0x03,0xe8
 2089           clrf    temp+4                                                                                  2169           bra     sub5b
 2090   cleartemp4:                                                                                             2170   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2091           clrf    temp+3                                                                                  2171   sub50:
 2092           clrf    temp+2                                                                                  2172           LDK1    temp,.50
 2093           clrf    temp+1                                                                                  2173           bra     sub5b
 2094           clrf    temp                                                                                    2174   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2095           return                                                                                          2175   sub10:
 2096   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2176           LDK1    temp,.10
 2097   ;Funktion       add des eingestellten Schritt zur Frequenz                                              2177           bra     sub5b
 2098   ;               100kHz, 1kHz, 100Hz, 10Hz oder 1Hz                                                      2178   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2099   stepadd:                                                                                                2179   sub1:
 2100           rcall   cleartemp5                                                                              2180           incf    temp,F
 2101           rcall   fpointerladen                                                                           2181           bra     sub5b
 2102           movf    step,W                                                                                  2182   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2103           bz      add1                                                                                    2183   ;==============================================================================
 2104           movlw   1                                                                                       2184   ;Funktion       Subtraktion von 5 Byte; Differenz = Minuend − Subtrahend
 2105           subwf   step,W                                                                                  2185   ;Eingang        LFSR0 = Minuend; LFSR1 = Subtrahend
 2106           bz      add10                                                                                   2186   ;Ausgang        Differenz in LFSR0
 2107           movlw   2                                                                                       2187   ;Register       schleife; LFSR0,1
 2108           subwf   step,w                                                                                  2188   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2109           bz      add50                                                                                   2189   sub5b:
 2110           movlw   3                                                                                       2190           MOVLF   .5,schleife     ;5 Byte
 2111           subwf   step,w                                                                                  2191           clrf    STATUS,C        ;Carry loeschen
 2112           bz      add1000                                                                                 2192   sub5b1:                         ;SCHLEIFE(1)
 2113           movlw   4                                                                                       2193           movf    INDF1,W         ; Byte aus temp holen
 2114           subwf   step,w                                                                                  2194           btfss   STATUS,C        ; ? Ueberlauf
 2115           bz      add100kHz                                                                               2195           incfsz INDF1,W          ; 1 ? Byte 0 (Byte eins hoeher)
 2116           return                                                                                          2196           subwf   INDF0,F         ;    0 subtrahieren
 2117                                                                                                           2197           movf    POSTINC0,F      ; pointer+1
 2118   add100kHz:                                                                                              2198           movf    POSTINC1,F      ; pointer+1
 2119           MOVLF   0xa0,temp                                                                               2199           decfsz schleife,F       ;
 2120           MOVLF   0x86,temp+1                                                                             2200           bra     sub5b1          ;ENDE(1) schleife == 0
 2121           MOVLF   0x01,temp+2                                                                             2201           return
 2122           bra     add5b                                                                                   2202   ;==============================================================================
 2123   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2203   ;Funktion       Addition von 5 Byte; Summe = Summand1 − Summand2
 2124   add1000:                                                                                                2204   ;Eingang        LFSR0 = Summand1; LFSR1 = Summand2
 2125           LDK2    temp,0x03,0xe8 ;Step 1000Hz                                                             2205   ;Ausgang        Summe in LFSR0
 2126           bra     add5b                                                                                   2206   ;Register       schleife; LFSR0,1
 2127   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2207   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2128   add50:                                                                                                  2208   add5b:
 2129           LDK1    temp,.50        ;Step 50Hz                                                              2209           movf    POSTINC1,W      ;addieren
 2130           bra     add5b                                                                                   2210           addwf   POSTINC0,F      ;ohne Carry
 2131   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2211           MOVLF   4,schleife      ;weitere 4 Byte
 2132   add10:                                                                                                  2212   add5b1:                         ;SCHLEIFE(1)
 2133           LDK1    temp,.10        ;Step 10Hz                                                              2213           movf    POSTINC1,W      ; addieren
 2134           bra     add5b                                                                                   2214           addwfc POSTINC0,F       ; mit Carry
 2135   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2215           decfsz schleife,F       ;
 2136   add1:                                                                                                   2216           bra     add5b1          ;ENDE(1) 5 Byte addiert
 2137           incf    temp,F          ;Step 1Hz                                                               2217           return
 2138           bra     add5b                                                                                   2218   ;==============================================================================
 2139   ;==============================================================================                         2219   ;Funktion       Multiplikation mit 18Fxxx XByte
 2140   ;Funktion       sub des eingestellten Schritt zur Frequenz                                              2220   ;Eingang        faktor1, faktor2 je XByte, laenge in mlaenge
 2141   ;               100kHz, 1kHz, 50Hz, 10Hz oder 1Hz                                                       2221   ;Ausgang        ergebnis 2 x XByte
 2142   stepsub:                                                                                                2222   ;Register       lfsr0, lfsr1, lfsr2 schleife, schleife+1
 2143           rcall   cleartemp5                                                                              2223   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2144           rcall   fpointerladen                                                                           2224   mlaenge equ     .5
 2145           movf    step,W                                                                                  2225
 2146           bz      sub1                                                                                    2226   mul5b:
 2147           movlw   1                                                                                       2227   mulxb:
 2148           subwf   step,W                                                                                  2228             MOVLF    mlaenge * .2,schleife   ;ergebnis loeschen
 2149           bz      sub10                                                                                   2229             lfsr     0,ergebnis              ;
 2150           movlw   2                                                                                       2230   mulx07:                                    ;SCHLEIFE(1)
 2151           subwf   step,W                                                                                  2231             clrf     POSTINC0                ; loeschen
 2152           bz      sub50                                                                                   2232             decfsz   schleife,F              ;
 2153           movlw   3                                                                                       2233             bra      mulx07                  ;ENDE(1)ergebnis geloescht
 2154           subwf   step,W                                                                                  2234             bcf      bergebisminus           ;Ergebnis ist positiv
 2155           bz      sub1000                                                                                 2235             btfsc    faktor1+mlaenge−1,7     ;? ist faktor1 minus

Dienstag November 10, 2009                                                                             mc.pic                                                                                                   14/40
                                                                                                                                                                                                       Printed by Andreas
 Nov 10, 09 8:32                                     mc.pic                                  Page 29/79            Nov 10, 09 8:32                                   mc.pic                                 Page 30/79
 2236             rcall    neg5op1               ;Ergebnisvorzeichen+op1 umkehren                                  2316           btfsc   divisor+4,7               ;
 2237             btfsc    faktor2+mlaenge−1,7   ;? ist faktor2 minus                                              2317           bra     divb53                    ;
 2238             rcall    neg5op2               ;Ergebnisvorzeichen+op2 umkehren                                  2318           RL5     divisor                   ;
 2239             MOVLF    mlaenge,schleife      ;8 Byte schleife                                                  2319           CMP5    divident,divisor          ;
 2240             lfsr     0,faktor2             ;lfsr0 = faktor2                                                  2320           bc      divb51                    ;
 2241             lfsr     2,ergebnis            ;lfsr2 = ergebnis                                                 2321           CLR5    ergebnis                  ;
 2242   mulx01:                                  ;SCHLEIFE(1)                                                      2322   divb52:                                   ;SCHLEIFE(1)
 2243             MOVLF    mlaenge,schleife+1    ; 8 Byte schleife                                                 2323            clrc                             ;
 2244             movf     schleife,W                                                                              2324            RR5    divisor                   ;
 2245             subwf    schleife+1,F          ;                                                                 2325   divb53:                                   ;
 2246             lfsr     1,faktor1             ;   lfsr1= faktor1                                                2326            CMP5   divident,divisor          ;
 2247             lfsr     2,ergebnis            ;   lfsr2 = ergebnis                                              2327            bnc    divb54                    ;
 2248             movf     schleife+1,F          ;   ? Test ob schleife+1 == 0                                     2328            SUB5   divident,divisor          ;
 2249             bz       mulx04                ;                                                                 2329   divb54:                                   ;
 2250   mulx03:                                  ;   0 SCHLEIFE(5)                                                 2330           RL5     ergebnis                  ;
 2251             movf     POSTINC2,F            ;       LFSR2 + 1                                                 2331           decfsz schleife,F                 ;
 2252             decfsz   schleife+1,F          ;     ENDE(5) bis LFSR2 wieder an richtiger Stelle                2332           bra     divb52                    ;ENDE(1)
 2253             bra      mulx03                ;                                                                 2333           btfsc   bergebisminus             ;? ist das ergebnis minus
 2254   mulx04:                                                                                                    2334           rcall   neg5ergebnis              ;1 minus setzen
 2255             MOVLF    mlaenge,schleife+1   ; 8 Byte schleife                                                  2335           return                            ;
 2256   mulx02:                                 ; SCHLEIFE(2)                                                      2336   ;==============================================================================
 2257            MOVLF  mlaenge−2,schleife+2    ;    6 Byte schleife                                               2337   ;Funktion       ergebnis nach faktor1 copieren
 2258            movf   INDF0,W                 ;    faktor2 holen                                                 2338   ;Eingang        ergebnis 5 Byte
 2259            mulwf  POSTINC1                ;    mit faktor1 multiplizieren                                    2339   ;Ausgang        ergebnis in faktor1
 2260            movf   PRODL,W                 ;    produkt LOW holen und                                         2340   ;Register       faktor1, ergebnis
 2261            addwf  POSTINC2,F              ;    zum ergebniss addieren                                        2341   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2262            movf   PRODH,W                 ;    produkt HIGH holen und                                        2342   ergebnis2faktor1_5b:
 2263            addwfc POSTINC2,F              ;    zum ergebnis mit Carry addieren                               2343           movff   ergebnis+4,faktor1+4
 2264   mulx05:                                 ;    SCHLEIFE(3)                                                   2344           movff   ergebnis+3,faktor1+3
 2265            clrf   WREG                    ;      nur Carry                                                   2345           movff   ergebnis+2,faktor1+2
 2266            addwfc POSTINC2,F              ;      addieren                                                    2346           movff   ergebnis+1,faktor1+1
 2267            decfsz schleife+2,F            ;    ENDE(3) wenn alle ergebnisbytes behandelt                     2347           movff   ergebnis,faktor1
 2268            bra    mulx05                  ;                                                                  2348           return
 2269            MOVLF  mlaenge−1,schleife+2    ;    7 Byte schleife fuer Korrektur LFSR2                          2349   ;==============================================================================
 2270   mulx06:                                 ;    SCHLEIFE(4)                                                   2350   ;Funktion       ergebnis nach faktor2 copieren
 2271            movf   POSTDEC2,F              ;      Pointer LFSR 2 − 1                                          2351   ;Eingang        ergebnis 5 Byte
 2272            decfsz schleife+2,F            ;      wieder zurueck korrigieren                                  2352   ;Ausgang        ergebnis in faktor2
 2273            bra    mulx06                  ;    ENDE(4)                                                       2353   ;Register       faktor2, ergebnis
 2274            decfsz schleife+1,F            ; ENDE(2) 8 Byte faktor2 bearbeitet                                2354   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2275            bra    mulx02                  ;                                                                  2355   ergebnis2faktor2_5b:
 2276            movf   POSTINC0,F              ; pointer faktor2 + 1                                              2356           movff   ergebnis+4,faktor2+4
 2277            decfsz schleife,F              ;ENDE(1)                                                           2357           movff   ergebnis+3,faktor2+3
 2278            bra    mulx01                  ;                                                                  2358           movff   ergebnis+2,faktor2+2
 2279            btfsc  bergebisminus           ;? ist das ergebnis minus                                          2359           movff   ergebnis+1,faktor2+1
 2280            rcall  neg5ergebnis            ;1 minus setzen                                                    2360           movff   ergebnis,faktor2
 2281            return                         ;                                                                  2361           return
 2282   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                            2362   ;==============================================================================
 2283   neg5ergebnis:                                                                                              2363   ;Funktion       HEX zu BCD wandeln
 2284            NEG5   ergebnis                ;                                                                  2364   ;Eingang        faktor1 5 Byte
 2285            bcf    bergebisminus           ;Ergebnisvorzeichen loeschen                                       2365   ;Ausgang        ergebnis max 6 Byte
 2286            return                                                                                            2366   ;Register       faktor1, ergebnis, zw, schleife, schleife+1
 2287   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                            2367   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2288   neg5op1:                                ;                                                                  2368   hex2bcd5b:
 2289            NEG5   op1                     ;                                                                  2369           CLR4    ergebnis        ;ergebnis loeschen
 2290            bra    neg5op2_1               ;                                                                  2370           CLR2    ergebnis+4      ;
 2291   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                            2371           MOVLF   .40, schleife   ;40 Durchlaeufe fuers Bit
 2292   neg5op2:                                ;                                                                  2372   htb1:                            ;SCHLEIFE(1)
 2293            NEG5   op2                     ;                                                                  2373           MOVLF   .6, schleife+1 ; 6 Byte Ergebnis
 2294   neg5op2_1:                              ;                                                                  2374           lfsr    0,ergebnis      ; LFSR0 = ergebnis
 2295           btg     bergebisminus           ;Ergebnisvorzeichen umkehren                                       2375   htb11:                           ; SCHLEIFE(2)
 2296           return                          ;                                                                  2376           movf    INDF0,W         ;     Ergebnis Byte holen
 2297   ;==============================================================================                            2377           andlw   B’00001111’     ;     untersten Bit
 2298   ;Funktion       dividieren von 2 x 5 Byte−Werten divident / divisor                                        2378           movwf   zw              ;     zwischenspeichern
 2299   ;Eingang        divisor, divident                                                                          2379           movlw   .5              ;     5
 2300   ;Ausgang        ergebnis, rest im divident                                                                 2380           subwf   zw,W            ;     subtrahieren
 2301   ;Register       schleife, divisor, divident                                                                2381           btfss   STATUS,C        ;     ? Ueberlauf
 2302   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                            2382           bra     htb2            ;
 2303   div5b:                                                                                                     2383           movlw   .3              ;     1 3
 2304           bcf     bergebisminus           ;Ergebnis ist positiv                                              2384           addwf   INDF0,F         ;        addiern
 2305           btfsc   divident+mlaenge−1,7    ;? ist divisor minus                                               2385   htb2:
 2306           rcall   neg5op1                 ;Ergebnisvorzeichen+op1 umkehren                                   2386           movf    INDF0,W         ;     Ergebnis Byte holen
 2307           btfsc   divisor+mlaenge−1,7     ;? ist divident minus                                              2387           andlw   B’11110000’     ;     obersten Bit
 2308           rcall   neg5op2                 ;Ergebnisvorzeichen+op2 umkehren                                   2388           movwf   zw              ;     zwischenspeichern
 2309           bcf     divisor+mlaenge−1,7     ;Operator Vorzeichen loeschen                                      2389           movlw   50h             ;     50
 2310           bcf     divident+mlaenge−1,7    ;Operator Vorzeichen loeschen                                      2390           subwf   zw,W            ;     subtrahieren
 2311           clrf    schleife                ;schleife = 0                                                      2391           btfss   STATUS,C        ;     ? Ueberlauf
 2312           CLR5    ergebnis                ;ergebnis loeschen                                                 2392           bra     htb3            ;
 2313   divb51:                                 ;                                                                  2393           movlw   30h             ;     1 0x30
 2314           incf    schleife,F              ;schleife + 1                                                      2394           addwf   INDF0,F         ;        addieren
 2315           clrc                            ;Carry loeschen                                                    2395   htb3:

Dienstag November 10, 2009                                                                                mc.pic                                                                                                   15/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 31/79            Nov 10, 09 8:32                                       mc.pic                             Page 32/79
 2396           movf    PREINC0,F       ;    Byte eins weiter                                                   2476             lfsr     0,string
 2397           decfsz schleife+1,F     ; ENDE(2) 6 Byte bearbeitet                                             2477             lfsr     1,ergebnis+5
 2398           bra     htb11           ;                                                                       2478             MOVLF    6,schleife
 2399           clrc                    ; carry loeschen                                                        2479   b2c401:
 2400           RL5     faktor1         ; faktor1 −> ergebnis schieben                                          2480             swapf    INDF1,W
 2401           RL6     ergebnis        ;                                                                       2481             andlw    b’00001111’
 2402           decfsz schleife,F       ;                                                                       2482             rcall    charwrite
 2403           bra     htb1            ;ENDE(1) nach 40 Bit                                                    2483             movf     POSTDEC1,W
 2404           return                  ;fertig                                                                 2484             rcall    charwrite
 2405   ;==============================================================================                         2485             decfsz   schleife,F
 2406   ;Funktion       Ausgabe des Strings                                                                     2486             bra      b2c401
 2407   ;Eingang        String in string;                                                                       2487             return
 2408   ;               Laenge (2..12) = Anzahl der Ziffern                                                     2488
 2409   ;               Komma (0..12) = Stelle des Kommas von rechts 0 = kein Komma                             2489   charwrite:
 2410   ;               Kuerzen (0..) = Anzahl der zu kuerzenden Ziffern von rechts                             2490           andlw   b’00001111’
 2411   ;Ausgang        Alle Ziffern mit Komma ohne fueherende 0 sind auf LCD                                   2491           iorlw   30h
 2412   ;Register       string, schleife, komma, laenge                                                         2492           movwf   POSTINC0
 2413   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2493           return
 2414   printf:                                                                                                 2494   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2415           lfsr    0,string        ;hier beginnt der String                                                2495   ;Funktion       eine Zahl auf LCD ausgeben Fuehrende 0 als Leerzeichen
 2416           MOVLF   .12,schleife    ;bestehend aus 12 Char                                                  2496   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2417           movf    laenge,W        ;laengezahl errechnen                                                   2497   LCDfrqbyte:
 2418           subwf   schleife,W      ;                                                                       2498           andlw   B’00001111’     ;unteres Nibbel filetern
 2419           movwf   laenge          ;                                                                       2499           bnz     LCDfrq3         ;? Zahl NULL
 2420           movf    komma,W         ;Kommazahl errechnen                                                    2500           btfss   bnull           ;1 ? fuehrende Null
 2421           subwf   schleife,W      ;                                                                       2501           bra     LCDfrq1
 2422           movwf   komma           ;                                                                       2502           movlw   ’ ’             ; 1 Leerzeichen ausgeben
 2423           bcf     bnull           ;beginnen mit keiner Nullausgabe                                        2503           bra     LCDfrq4
 2424           movf    kuerzen,W       ;letzten Stellen nicht                                                  2504   LCDfrq1:
 2425           subwf   schleife,F      ;ausgeben                                                               2505   LCDfrq3:
 2426   printf2:                        ;SCHLEIFE(1)                                                            2506           iorlw   0x30            ;
 2427           decf    komma,F         ; ? Komma == 1 Stelle davor                                             2507           bcf     bnull
 2428           btfsc   STATUS,Z        ;                                                                       2508   LCDfrq4
 2429           bsf     bnull           ; 1 richtige NULL ausgeben                                              2509           bra     LCDChar
 2430           incf    komma,F         ; Komma wieder korrigieren                                              2510   ;==============================================================================
 2431           movf    komma,F         ; ? Kommaausgabe                                                        2511   ;Funktion       Anzeige der Frequenz auf LCD Zeile
 2432           bnz     printf3         ;                                                                       2512   ;Eingang        Frequenz im Speicher
 2433           movlw   ’,’             ; 1 Komma schreiben                                                     2513   ;Ausgang        LCD
 2434           rcall   LCDChar         ;    in LCD                                                             2514   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2435   printf3:                                                                                                2515   FunktionPos:    equ      .11
 2436           movf    POSTINC0,W      ; Char holen                                                            2516
 2437           movwf   schleife+1      ; und zwischenspeichern                                                 2517   LCDAnzeigeZ2:
 2438           movf    laenge,F        ;                                                                       2518           btfsc      bmenu            ;? Menu aktiv
 2439           bnz     printf4         ;                                                                       2519           bra        menuanzeige      ;1 zur Menuanzeige
 2440           btfsc   bnull           ; ? Space statt NULL ausgeben                                           2520           btfsc      bkeyeranz        ;? Keyergeschw. anzeigen
 2441           bra     printf6         ;                                                                       2521           bra        LCDAnzKeyer      ;1 zur Anzeige
 2442           movlw   ’0’             ; 0 0 ausgeben                                                          2522           movf       band,F           ;? Messmodus
 2443           subwf   schleife+1,W    ;                                                                       2523           bz         LCDAnZ200        ;1 −−−> Zur Frequenzanzeige
 2444           bnz     printf6         ;                                                                       2524           btfsc      blcdsmeter       ;0 ? S−Meter aktiv
 2445           MOVLF   ’ ’,schleife+1 ;                                                                        2525           bra        smanzeige        ; 1 S−Meter auf Zeile 2
 2446           bra     printf7         ;                                                                       2526   LCDAnZ200:                          ;
 2447   printf6:                        ;                                                                       2527           movlw       40H             ;Anfang Zeile 2
 2448           bsf     bnull           ;                                                                       2528           rcall       LCDPos          ;Cursor bewegen
 2449   printf7:                        ;                                                                       2529           movlw       ’A’             ;
 2450           movf    schleife+1,W    ;                                                                       2530           btfss       bvfo            ;? VFO B aktiv
 2451           rcall   LCDChar         ;                                                                       2531           movlw       ’B’             ;1 B anzeigen
 2452   printf4:                        ;                                                                       2532           btfss       brit            ;? Rit aktiv
 2453           movf    laenge,F        ;                                                                       2533           bra        LCDAnZ201        ;
 2454           bz      printf5         ;                                                                       2534           movlw       ’a’             ;1 ? VFO B aktiv
 2455           decf    laenge,F        ;                                                                       2535           btfss       bvfo            ;
 2456   printf5:                        ;                                                                       2536           movlw       ’b’             ; 1 B anzeigen
 2457           decf    komma,F         ;                                                                       2537   LCDAnZ201:                          ;
 2458           decfsz schleife,F       ;ENDE(1)                                                                2538           rcall       LCDChar         ;anzeigen
 2459           bra     printf2         ;                                                                       2539           btfsc       bvfo            ;
 2460           movf    kuerzen,F       ;                                                                       2540           bra         LCDAnZ203       ;
 2461           bz      printf8         ;                                                                       2541   LCDAnZ202:                          ;
 2462           movf    kuerzen,W       ;                                                                       2542           LD5         faktor1,frequenzb;
 2463           rcall   LCDSpacel       ;Leerzeichen ausgeben                                                   2543           bra         LCDAnZ204       ;
 2464   printf8                                                                                                 2544   LCDAnZ203:                          ;
 2465           return                                                                                          2545           LD5         faktor1,frequenza;
 2466   ;==============================================================================                         2546   LCDAnZ204:                          ;
 2467   ;Funktion       Wandeln BCD−Format in String                                                            2547           rcall       LCDAnz          ;
 2468   ;Eingang:       gepacktes BCD−Format in ergebnis(6 Byte)                                                2548           movlw       .3              ;
 2469   ;Ausgang:       String in string(12)                                                                    2549           bra         LCDSpacel       ;noch 3 Leerzeichen
 2470   ;Register:      schleife, string, ergebnis                                                              2550
 2471   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2551   LCDAnzeigeZ1:
 2472   bcd2char6b:                                                                                             2552           clrf       WREG            ;1. Position Zeile 1
 2473           CLR4    string                                                                                  2553           call       LCDPos          ;Cursor bewegen
 2474           CLR4    string+4                                                                                2554           movlw      ’A’             ;
 2475           CLR4    string+8                                                                                2555           btfsc      bvfo            ;? VFO B aktiv

Dienstag November 10, 2009                                                                             mc.pic                                                                                                   16/40
                                                                                                                                                                                                   Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 33/79            Nov 10, 09 8:32                                   mc.pic                                    Page 34/79
 2556           movlw   ’B’             ;1 B anzeigen                                                           2636           return
 2557           btfss   brit            ;                                                                       2637   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2558           bra     LCDAnZ101       ;                                                                       2638   LCDAnzKeyer:                            ;
 2559           movlw   ’a’             ;                                                                       2639           movf    band,F                  ;? Messender
 2560           btfsc   bvfo            ;? VFO B aktiv                                                          2640           btfsc   STATUS,Z                ;
 2561           movlw   ’b’             ;1 B anzeigen                                                           2641           return                          ;1 keine Anzeige
 2562   LCDAnZ101:                      ;                                                                       2642           LCDStrp text5                   ;0 "WpM: "
 2563           call    LCDChar         ;anzeigen                                                               2643           call    UmessKeyerPoti          ; Spannung messen
 2564           btfsc   bvfo            ;                                                                       2644           movwf   schleife+3              ; U / 8
 2565           bra     LCDAnZ102       ;                                                                       2645           rrcf    schleife+3,F            ;
 2566   LCDAnZ103:                                                                                              2646           rrcf    schleife+3,F            ;
 2567           LD5     faktor1,frequenza                                                                       2647           rrcf    schleife+3,W            ;
 2568           bra     LCDAnZ104                                                                               2648           andlw   B’00011111’             ;
 2569   LCDAnZ102:                                                                                              2649           addlw   .9                      ; geringste Geschwindigkeit addieren 0Volt
 2570           LD5     faktor1,frequenzb                                                                       2650           movwf   schleife+3              ;
 2571   LCDAnZ104:                                                                                              2651           rcall   math_ramclr             ;
 2572           rcall   LCDAnz                                                                                  2652           movff   schleife+3,faktor1      ; berechen
 2573           goto    LCDAnzMode                                                                              2653           rcall   hex2bcd5b               ; hex2bcd
 2574   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2654           movf    ergebnis,W              ;
 2575   LCDAnz:                                                                                                 2655           call    LCDHEX                  ; und anzeigen
 2576           lfsr    0,faktor1       ;                                                                       2656           movlw   .9                      ;
 2577           lfsr    1,lcdoffset     ;                                                                       2657           goto    LCDSpacel               ; 9 Leerzeichen folgen
 2578           rcall   add5b           ;                                                                       2658   ;==============================================================================
 2579           rcall   hex2bcd5b       ;                                                                       2659   xsmladen:                               ;
 2580           rcall   bcd2char6b      ;                                                                       2660           movff   xsm,faktor2             ;laden des X−Wertes in Faktor 2
 2581           MOVLF   .11,laenge      ;                                                                       2661           movff   xsm+1,faktor2+1         ;
 2582           MOVLF   .6,komma        ;                                                                       2662           btfss   xsm+1,7                 ;? test ob negativ
 2583           movff   step,kuerzen    ;                                                                       2663           bra     xsmladen01              ;
 2584           movlw   4               ;                                                                       2664           comf    faktor2+2,F             ;1 X−Werte negativ
 2585           subwf   step,W          ;                                                                       2665           comf    faktor2+3,F             ; darstellen
 2586           bnz     LCDAnz01        ;                                                                       2666           comf    faktor2+4,F             ;
 2587           MOVLF   .5,kuerzen      ;                                                                       2667   xsmladen01:                             ;
 2588   LCDAnz01:                                                                                               2668           return                          ;
 2589           goto    printf          ;                                                                       2669   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2590   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2670   ysmladen:                               ;
 2591   LCDAnzMode:                     ;                                                                       2671           CLR5    summand1                ;
 2592           btfsc   bvfox4          ;                                                                       2672           movff   ysm,summand1+2          ;
 2593           bra     LCDAnzM01       ;                                                                       2673           movff   ysm+1,summand1+3        ;
 2594           movf    mode,F          ;                                                                       2674           btfsc   ysm+1,7                 ;
 2595           bnz     LCDAnzM104      ;                                                                       2675           comf    summand1+4,F            ;
 2596   LCDAnzM01:                      ;                                                                       2676           return                          ;
 2597           LCDStrp tmode0          ;                                                                       2677   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2598           return                  ;                                                                       2678   smeterausw:                             ;
 2599   LCDAnzM104:                     ;                                                                       2679           rcall   umesssmeter             ;Spannung messen
 2600           movlw   1               ;                                                                       2680   smeterausw01:                           ;
 2601           subwf   mode,W          ;                                                                       2681           rcall   math_ramclr             ;Ram loeschen math operationen
 2602           bnz     LCDAnzM105      ;                                                                       2682           LD2     faktor1,mess            ;faktor1 = Messergebnis
 2603           LCDStrp tmode1          ;                                                                       2683           rcall   xsmladen                ;XSM Laden mit Vorzeichen
 2604           return                  ;                                                                       2684           rcall   mul5b                   ;Ergebnis = Messung * X−Wert
 2605   LCDAnzM105:                     ;                                                                       2685           rcall   ysmladen                ;YSM Laden mit Vorzeichen
 2606           movlw   2               ;                                                                       2686           ADD5    ergebnis,summand1       ;Ergebnis = Ergebnis + Y−Wert
 2607           subwf   mode,W          ;                                                                       2687   ;       LCDHEX4Z2        ergebnis       ;
 2608           bnz     LCDAnzM106      ;                                                                       2688   ;       call    t1Sek                   ;
 2609           LCDStrp tmode2          ;                                                                       2689           movlw   d’60’                   ;
 2610           return                  ;                                                                       2690           subwf   ergebnis+2,W            ;
 2611   LCDAnzM106:                     ;                                                                       2691           bnc     smeterausw02            ;
 2612           movlw   3                                                                                       2692           clrf    ergebnis+2              ;
 2613           subwf   mode,W                                                                                  2693           bra     smeterausw03            ;
 2614           bnz     LCDAnzM107                                                                              2694   smeterausw02:                           ;
 2615           LCDStrp tmode3                                                                                  2695           movlw   d’31’                   ;
 2616           return                                                                                          2696           subwf   ergebnis+2,W            ;
 2617   LCDAnzM107:                                                                                             2697           bnc     smeterausw03            ;
 2618           movlw   4                                                                                       2698           MOVLF   d’30’,ergebnis+2        ;
 2619           subwf   mode,W                                                                                  2699   smeterausw03:                           ;
 2620           bnz     LCDAnzM108                                                                              2700           movff   ergebnis+2,usmeter      ;ergebnis speichern fuer Bargraph
 2621           LCDStrp tmode4                                                                                  2701           movff   ergebnis+2,usmeter+2    ;ergebnis speichern fuer S−Wert
 2622           return                                                                                          2702           return                          ;
 2623   LCDAnzM108:                                                                                             2703   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2624           movlw   5                                                                                       2704   smanzeige:                              ;
 2625           subwf   mode,W                                                                                  2705           rcall   smeterausw              ;
 2626           bnz     LCDAnzM109                                                                              2706           CMP2    usmeter+1,usmeter       ;? neue Messung != alte Messung
 2627           LCDStrp tmode5                                                                                  2707           bz      smanzeige01             ;
 2628           return                                                                                          2708           movff   usmeter,usmeter+1       ;1 Messung speichern
 2629   LCDAnzM109:                                                                                             2709   smanzeige01:                            ;
 2630           movlw   6                                                                                       2710           rcall   math_ramclr             ;alle Operanten loeschen
 2631           subwf   mode,W                                                                                  2711           movff   usmeter+1,divident      ;alte Messung in Divident laden
 2632           bnz     LCDAnzM110                                                                              2712           MOVLF   .3,divisor              ;Ergebnis = Bargrah / 3
 2633           LCDStrp tmode6                                                                                  2713           rcall   div5b                   ;
 2634           return                                                                                          2714           MOVLF   .8,schleife+3           ;Schleife3 = 8
 2635   LCDAnzM110:                                                                                             2715           movf    ergebnis,W              ;

Dienstag November 10, 2009                                                                             mc.pic                                                                                                      17/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 35/79            Nov 10, 09 8:32                                   mc.pic                                  Page 36/79
 2716            subwf  schleife+3,F            ;Schleife3 = Schleife3 − Ergebnis                               2796           rcall   printf                  ;Formatiert ausgeben
 2717            movlw  0x40                    ;Zeilenanfang 2. Zeile                                          2797           LCDStrp text4                   ;und "Volt" dahinter schreiben
 2718            call   LCDPos                  ;                                                               2798           goto    t2Sek                   ;2 Sekunden anzeigen
 2719            MOVLF  .6,ergebnis+1           ;Grafische markierung fuer S9                                   2799   ;==============================================================================
 2720   smanz03:                                ;SCHLEIFE(1)                                                    2800   ;Konstande fuer die Berechnung, welches Band eingestellt wurde
 2721            movf   ergebnis,F              ; ? ergebnis == 0                                               2801   anzband         equ     .13     ;mess,160,80,60,40,30,20,17,15,12,10,6,2m
 2722            bz     smanz05                 ;                                                               2802   anztransv       equ     .5      ;5 Transverterbaender
 2723            decfsz ergebnis+1,F            ; 0 grafische Markierung S9 − 1                                 2803
 2724            bra    smanz032                ;                                                               2804   bdiv    equ     (0x3ff * .100) / (anzband + anztransv − 1)
 2725            movlw  .3                      ;    ? grafische Markierung erreicht                            2805   bshift equ      0x3ff / ((anzband + anztransv − 1) * 2)
 2726            bra    smanz031                ;    1 langes Zeichen laden                                     2806   ubandmessen:
 2727   smanz032:                               ;                                                               2807           call    math_ramclr             ;mathe−speicher loeschen
 2728            movlw  .2                      ;    0 kleines Zeichen laden                                    2808           rcall   umessband               ;Spannung messen
 2729   smanz031:                               ;                                                               2809           movff   ADRESL,faktor1          ;umspeichern Ergebnis
 2730            call   LCDChar                 ;    und anzeigen                                               2810           movff   ADRESH,faktor1+1        ;
 2731            decfsz ergebnis,F              ;                                                               2811           MOVLF   LOW(bshift),faktor2     ;
 2732            bra    smanz03                 ;ENDE(1)                                                        2812           MOVLF   HIGH(bshift),faktor2+1 ;
 2733   smanz05:                                ;                                                               2813           ADD2    faktor1,faktor2         ;
 2734            movf   divident,F              ;? Divident == 0                                                2814           CLR5    faktor2                 ;
 2735            bnz    smanz02                 ;                                                               2815           MOVLF   .100,faktor2            ;Multiplizieren mit 100
 2736            incf   schleife+3,F            ;1 Schleife3 = Schleife3 + 1                                    2816           rcall   mul5b                   ;
 2737            bra    smanz06                 ;                                                               2817           rcall   ergebnis2faktor1_5b     ;Ergebnis weiter verwenden
 2738   smanz02:                                ;                                                               2818           LDK2    faktor2,HIGH(bdiv),LOW(bdiv);Dividieren durch konst
 2739            decf   divident,W              ;0 Divident = Divident −1                                       2819           rcall   div5b                   ;
 2740            call   LCDChar                 ; als Zeichen darstellen                                        2820           movff   ergebnis,bandneu        ;Ergebnis ist eine Bandnummer je nach angelegter
 2741   smanz06:                                ;                                                               2821           return                          ;Spannung
 2742            incf   schleife+3,F            ;Schleife3 = Schleife3 + 1                                      2822   ;==============================================================================
 2743            movf   schleife+3,W            ;? Schleife3 != 0                                               2823   ;Konstande fuer die Berechnung, welcher Mode eingestellt wurde
 2744            bz     smanz07                 ;                                                               2824   anzmode         equ     .6              ;cw,lsb,usb,cwr,dig,digr
 2745            call   LCDSpacel               ;1 als Leezeichen darstellen                                    2825
 2746   smanz07:                                ;                                                               2826   bmdiv   equ     (0x3ff * .100) / (anzmode − 1)
 2747            movlw  ’S’                     ;"S" Darstellen                                                 2827   bmshift equ     0x3ff / ((anzmode − 1) * 2)
 2748            call   LCDChar                 ;                                                               2828
 2749            rcall  math_ramclr             ;operanten loeschen                                             2829   umodemessen:
 2750            clrc                           ;                                                               2830           call    math_ramclr             ;mathe−speicher loeschen
 2751            rrcf   usmeter+2,F             ;usmeter2 = usmeter2 / 2                                        2831           rcall   umessmode               ;Spannung messen
 2752            movff  usmeter+2,faktor1       ;faktor1 = usmeter                                              2832           movff   ADRESL,faktor1          ;umspeichern Ergebnis
 2753            movlw  .10                     ;                                                               2833           movff   ADRESH,faktor1+1        ;
 2754            subwf  usmeter+2,W             ;usmeter2 = usmeter2 − 10                                       2834           MOVLF   LOW(bmshift),faktor2    ;
 2755            bc     smanz08                 ;? S−Wert < 10                                                  2835           MOVLF   HIGH(bmshift),faktor2+1 ;
 2756            rcall  hex2bcd5b               ;1 faktor1 in BCD wandeln                                       2836           ADD2    faktor1,faktor2         ;
 2757            rcall  bcd2char6b              ; in Char wandeln                                               2837           CLR5    faktor2                 ;
 2758            MOVLF  .1,laenge               ; 1 stellige Anzeige                                            2838           MOVLF   .100,faktor2            ;Multiplizieren mit 100
 2759            MOVLF  .0,komma                ; 0 Stelle hintern Komma                                        2839           rcall   mul5b                   ;
 2760            clrf   kuerzen                 ; 0 Stellen kuerzen                                             2840           rcall   ergebnis2faktor1_5b     ;Ergebnis weiter verwenden
 2761            rcall  printf                  ; und anzeigen                                                  2841           LDK2    faktor2,HIGH(bmdiv),LOW(bmdiv)
 2762            bra    smanz09                 ;                                                               2842                                           ;Dividieren durch konst
 2763   smanz08:                                ;                                                               2843           rcall   div5b                   ;
 2764           movlw   ’+’                     ;0 ein + darstellen                                             2844           incf    ergebnis,W              ;Ergebnis ist eine Modenummer je nach angelegter
 2765           call    LCDChar                 ;                                                               2845           movwf   modeneu                 ;Spannung ausser Nummer 0
 2766   smanz09:                                ;                                                               2846           return                          ;
 2767           movlw   4                       ;eventuelle Zeichen rechts                                      2847   ;==============================================================================
 2768           goto    LCDSpacel               ;ueberschreiben mit Leerzeichen                                 2848   UmessKeyerPoti:
 2769   ;==============================================================================                         2849   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2770   ubattanzeige:                                                                                           2850           if      bytevariante >= .21     ;alle Varianten mit PIC18F4520
 2771           call    math_ramclr             ;                                                               2851   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2772           call    LCDDisplayClear         ;Display loeschen                                               2852           bcf     ADCON2,ADFM
 2773           rcall   umessbatt               ;Spannung messen                                                2853   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2774           movff   ADRESL,faktor2          ;ermittelte Spannung laden                                      2854           endif
 2775           movff   ADRESH,faktor2+1        ;                                                               2855   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2776   ;       LCDHEX2Z1       faktor2 ;                                                                       2856   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2777   ;       call    t5Sek                                                                                   2857           if      bytevariante < .21      ;alle Varianten mit PIC18F452
 2778                                                                                                           2858   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2779          MOVLF   HIGH(.9805),faktor1+1   ;mit Faktor multiplizieren                                       2859           bcf     ADCON1,ADFM
 2780          MOVLF   LOW(.9805),faktor1      ;                                                                2860   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2781          call    mul5b                   ;                                                                2861           endif
 2782   ;      LCDHEX4Z1       ergebnis        ;                                                                2862   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2783   ;      call    t5Sek                                                                                    2863           rcall   umesskeyer
 2784                                                                                                           2864           movf    messh,W
 2785          CLR5    faktor1                 ;                                                                2865           movwf   keyergeschw+1
 2786          movff   ergebnis+2,faktor1      ;                                                                2866   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2787          btfsc   ergebnis+1,7            ;? niederwertige Stelle > 7fh                                    2867           if      bytevariante >= .21     ;alle Varianten mit PIC18F4520
 2788          incf    faktor1,F                       ;1 aufrunden                                             2868   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2789          rcall   hex2bcd5b               ;HEX in BCD wandeln                                              2869           bsf     ADCON2,ADFM
 2790          rcall   bcd2char6b              ;BCD in Char wandeln                                             2870   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2791          MOVLF   .3,laenge               ;3 stellige Anzeige                                              2871           endif
 2792          MOVLF   .1,komma                ;1 Stelle hintern Komma                                          2872   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2793          clrf    kuerzen                 ;von rechts nichts kuerzen                                       2873   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2794          movlw   .3                      ;Position Zeile 1 4.Zeichen                                      2874           if      bytevariante < .21      ;alle Varianten mit PIC18F452
 2795          call    LCDPos                  ;setzen                                                          2875   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−

Dienstag November 10, 2009                                                                             mc.pic                                                                                                     18/40
                                                                                                                                                                                                      Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 37/79            Nov 10, 09 8:32                                   mc.pic                                   Page 38/79
 2876           bsf     ADCON1,ADFM                                                                             2956            movwf    ADCON0               ; ... als Messeingang setzen
 2877   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2957            MOVLF    .100,schleife        ;
 2878           endif                                                                                           2958   ubme2:
 2879   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2959            decfsz   schleife,F           ;
 2880           return                                                                                          2960            bra      ubme2                ;
 2881   ;==============================================================================                         2961            bsf      adfrei               ;Start Messung
 2882   ;Batteriespannung ermitteln Spannungsteiler = 6,8k / 3,3K                                               2962   ubme1:
 2883                                                                                                           2963           btfsc   adfrei                  ;warten bis Messung beendet
 2884   ubatterielesen:                                                                                         2964           bra     ubme1                   ;Ergebnis in adresh und adresl
 2885           rcall   umessbatt                ;                                                              2965           movff   ADRESH,messh            ;
 2886           movff   ADRESL,ubatt     ;                                                                      2966           movff   ADRESL,messl            ;
 2887           movff   ADRESH,ubatt+1 ;                                                                        2967           return
 2888           bsf     ubattneu         ;Spannung neu anzeigen einleiten                                       2968   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 2889           return                                                                                          2969   ;Funktion zum umrechnen des ermittelten Spannungswertes in passenden Hexwert
 2890   ;==============================================================================                         2970   ;z.B. 10,2 Volt = 102 = 66h
 2891   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2971   ;Trick: es wird mit mulkonst multipliziert und der Ueberlauf ins naechste
 2892           if      bytevariante >= .21      ;alle Varianten mit PIC18F4520                                 2972   ;Byte ist das Divisionsergebnis
 2893   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2973   ;eingang        Wert in W
 2894   adst            equ      0x01                                                                           2974   ;ausgang        Wert in W
 2895   kanalRA0        equ      adst | b’00000000’                                                             2975   ;register       temp, temp+1,
 2896   kanalRA1        equ      adst | b’00000100’                                                             2976
 2897   kanalRA2        equ      adst | b’00001000’                                                             2977   mulkonst:         equ     .110
 2898   kanalRA3        equ      adst | b’00001100’                                                             2978
 2899   kanalRA5        equ      adst | b’00010000’                                                             2979   umrechnen1:
 2900   kanalRE0        equ      adst | b’00010100’                                                             2980           movwf   temp            ;
 2901   kanalRE1        equ      adst | b’00011000’                                                             2981           movlw   mulkonst        ;
 2902   kanalRE2        equ      adst | b’00011100’                                                             2982           mulwf   temp            ;
 2903   #define         adfrei ADCON0,1                                                                         2983           movff   PRODL,temp      ;
 2904   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2984           movff   PRODH,temp+1    ;
 2905           endif                                                                                           2985           btfsc   temp,7          ;? test ob aufrunden niederwertiges Byte>7f
 2906   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2986           incf    temp+1,F        ;1 hoeherwertiges Byte + 1
 2907   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2987           movf    temp+1,W        ;Ergebnis in W
 2908           if      bytevariante < .21       ;alle Varianten mit PIC18F452                                  2988           return                  ;
 2909   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         2989   ;==============================================================================
 2910   adst            equ      0xc1                                                                           2990   menuanzeige:                    ;
 2911   kanalRA0        equ      adst | b’00000000’                                                             2991           movlw   .1              ;
 2912   kanalRA1        equ      adst | b’00001000’                                                             2992           subwf   ebene,W         ;
 2913   kanalRA2        equ      adst | b’00010000’                                                             2993           bnz     manz01          ;
 2914   kanalRA3        equ      adst | b’00011000’                                                             2994           LCDStrp menu1           ;
 2915   kanalRA5        equ      adst | b’00100000’                                                             2995   manz01:                         ;
 2916   kanalRE0        equ      adst | b’00101000’                                                             2996           movlw   .2              ;
 2917   kanalRE1        equ      adst | b’00110000’                                                             2997           subwf   ebene,W         ;
 2918   kanalRE2        equ      adst | b’00111000’                                                             2998           bnz     manz02          ;
 2919   #define         adfrei ADCON0,2                                                                         2999           LCDStrp menu2           ;
 2920   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         3000   manz02:                         ;
 2921           endif                                                                                           3001           movlw   .3              ;
 2922   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         3002           subwf   ebene,W         ;
 2923                                                                                                           3003           bnz     manz03          ;
 2924   umessmode:                                                                                              3004           LCDStrp menu3           ;
 2925   umess8:                                                                                                 3005   manz03:                         ;
 2926           movlw   kanalRE2                ;anal. kanal RE2                                                3006           movlw   .4              ;
 2927           bra     umess                                                                                   3007           subwf   ebene,W         ;
 2928   umesssmeter:                                                                                            3008           bnz     manz04          ;
 2929   umess7:                                                                                                 3009           LCDStrp menu4           ;
 2930           movlw   kanalRE1                ;anal. kanal RE1                                                3010   manz04:                         ;
 2931           bra     umess                                                                                   3011           movlw   .5              ;
 2932   umessband:                                                                                              3012           subwf   ebene,W         ;
 2933   umess6:                                                                                                 3013           bnz     manz05          ;
 2934           movlw   kanalRE0                ;anal. kanal RE0                                                3014           LCDStrp menu5           ;
 2935           bra     umess                                                                                   3015   manz05:                         ;
 2936   umessrit:                                                                                               3016           movlw   .6              ;
 2937   umess5:                                                                                                 3017           subwf   ebene,W         ;
 2938           movlw   kanalRA5                ;anal. kanal RA5                                                3018           bnz     manz06          ;
 2939           bra     umess                                                                                   3019           LCDStrp menu6           ;
 2940   umessrueck:                                                                                             3020   manz06:                         ;
 2941   umess3:                                                                                                 3021           movlw   .7              ;
 2942           movlw   kanalRA3                ;anal. kanal RA3                                                3022           subwf   ebene,W         ;
 2943           bra     umess                                                                                   3023           bnz     manz07          ;
 2944   umessvor:                                                                                               3024           LCDStrp menu7           ;
 2945   umess2:                                                                                                 3025   manz07:                         ;
 2946           movlw   kanalRA2                ;anal. kanal RA2                                                3026           movlw   .8              ;
 2947           bra     umess                                                                                   3027           subwf   ebene,W         ;
 2948   umesskeyer:                                                                                             3028           bnz     manz08          ;
 2949   umess1:                                                                                                 3029           LCDStrp menu8           ;
 2950           movlw   kanalRA1               ;anal. kanal RA1                                                 3030   manz08:                         ;
 2951           bra     umess                  ;Keyerpoti                                                       3031           movlw   .9              ;
 2952   umessbatt:                                                                                              3032           subwf   ebene,W         ;
 2953   umess0:                                                                                                 3033           bnz     manz09          ;
 2954           movlw   kanalRA0                ; anal. kanal RA0                                               3034           LCDStrp menu9           ;
 2955   umess:                                                                                                  3035   manz09:                         ;

Dienstag November 10, 2009                                                                             mc.pic                                                                                                     19/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 39/79            Nov 10, 09 8:32                                   mc.pic                                 Page 40/79
 3036          movlw     .10            ;                                                                       3116          bnz     t2b_11           ;
 3037          subwf     ebene,W        ;                                                                       3117          MOVLF   .12,bandneu      ;2m
 3038          bnz       manz10         ;                                                                       3118   t2b_11:                         ;
 3039          LCDStrp   menu10         ;                                                                       3119           movlw   .12             ;
 3040   manz10:                         ;                                                                       3120           subwf   ebene,W         ;
 3041           movlw   .11             ;                                                                       3121           bnz     t2b_12          ;
 3042           subwf   ebene,W         ;                                                                       3122           MOVLF   .15,bandneu     ;tr3
 3043           bnz     manz11          ;                                                                       3123   t2b_12:                         ;
 3044           LCDStrp menu11          ;                                                                       3124           bra     t4b_98          ;
 3045   manz11:                         ;                                                                       3125   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3046           movlw   .12             ;                                                                       3126   taste3behandlung:               ;
 3047           subwf   ebene,W         ;                                                                       3127           rcall   MenuStart       ;
 3048           bnz     manz12          ;                                                                       3128           movlw   .1              ;
 3049           LCDStrp menu12          ;                                                                       3129           subwf   ebene,W         ;
 3050   manz12:                         ;                                                                       3130           bnz     t3b_1           ;
 3051           return                  ;                                                                       3131           rcall   umschalten_step ;Step aendern
 3052   ;==============================================================================                         3132   t3b_1:                          ;
 3053   taste1behandlung:               ;                                                                       3133           movlw   .2              ;
 3054           bcf     block           ;eventuell Entriegeln                                                   3134           subwf   ebene,W         ;
 3055           clrf    impulse         ;Impulse loeschen                                                       3135           bnz     t3b_2           ;
 3056           call    quittungston    ;Tastaturquittung                                                       3136           rcall   mithoerton_ein_aus;Spot Mithoerton ein/aus
 3057           btg     bmenu           ;Menu ein oder aus                                                      3137   t3b_2:                          ;
 3058           bsf     blcdneu         ;                                                                       3138           movlw   .3              ;
 3059           call    LCDDisplayClear ;                                                                       3139           subwf   ebene,W         ;
 3060           bra     t4b_99          ;ende                                                                   3140           bnz     t3b_3           ;
 3061   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         3141           rcall   ebandwrite      ;Bandeinstellung sichern
 3062   taste2behandlung:               ;                                                                       3142           rcall   writesicherung ;Einstellung sichern
 3063           rcall   MenuStart       ;                                                                       3143   t3b_3:                          ;
 3064           movlw   .1              ;                                                                       3144           movlw   .4              ;
 3065           subwf   ebene,W         ;                                                                       3145           subwf   ebene,W         ;
 3066           bnz     t2b_1           ;                                                                       3146           bnz     t3b_4           ;
 3067           rcall   umschalten_vfo ;VFOa/VFOb                                                               3147           rcall   SETUP           ;SETUP
 3068   t2b_1:                          ;                                                                       3148   t3b_4:                          ;
 3069           movlw   .2              ;                                                                       3149           movlw   .5              ;
 3070           subwf   ebene,W         ;                                                                       3150           subwf   ebene,W         ;
 3071           bnz     t2b_2           ;                                                                       3151           bnz     t3b_5           ;
 3072           rcall   BgleichA        ;VFOa=VFOb                                                              3152           MOVLF   modelsb,modeneu ;LSB
 3073   t2b_2:                          ;                                                                       3153   t3b_5:
 3074           movlw   .3              ;                                                                       3154           movlw   .6              ;
 3075           subwf   ebene,W         ;                                                                       3155           subwf   ebene,W         ;
 3076           bnz     t2b_3           ;                                                                       3156           bnz     t3b_6           ;
 3077           rcall   AgleichB        ;VFOb=VFOa                                                              3157           MOVLF   modedig,modeneu ;DIG
 3078   t2b_3:                          ;                                                                       3158   t3b_6:                          ;
 3079           movlw   .4              ;                                                                       3159           movlw   .7              ;
 3080           subwf   ebene,W         ;                                                                       3160           subwf   ebene,W         ;
 3081           bnz     t2b_4           ;                                                                       3161           bnz     t3b_7           ;
 3082           call    swrmessen       ;SWR messen und darstellen                                              3162           MOVLF   1,bandneu       ;160m
 3083   t2b_4:                          ;                                                                       3163   t3b_7:                          ;
 3084           movlw   .5              ;                                                                       3164           movlw   .8              ;
 3085           subwf   ebene,W         ;                                                                       3165           subwf   ebene,W         ;
 3086           bnz     t2b_5           ;                                                                       3166           bnz     t3b_8           ;
 3087           MOVLF   modecw,modeneu ;CW                                                                      3167           MOVLF   4,bandneu       ;40m
 3088   t2b_5:                          ;                                                                       3168   t3b_8:                          ;
 3089           movlw   .6              ;                                                                       3169           movlw   .9              ;
 3090           subwf   ebene,W         ;                                                                       3170           subwf   ebene,W         ;
 3091           bnz     t2b_6           ;                                                                       3171           bnz     t3b_9           ;
 3092           MOVLF   modecwr,modeneu ;CWr                                                                    3172           MOVLF   7,bandneu       ;17m
 3093   t2b_6:                          ;                                                                       3173   t3b_9:                          ;
 3094           movlw   .7              ;                                                                       3174           movlw   .10             ;
 3095           subwf   ebene,W         ;                                                                       3175           subwf   ebene,W         ;
 3096           bnz     t2b_7           ;                                                                       3176           bnz     t3b_10          ;
 3097           MOVLF   0,bandneu       ;mess                                                                   3177           MOVLF   .10,bandneu     ;10m
 3098   t2b_7:                          ;                                                                       3178   t3b_10:                         ;
 3099           movlw   .8              ;                                                                       3179           movlw   .11             ;
 3100           subwf   ebene,W         ;                                                                       3180           subwf   ebene,W         ;
 3101           bnz     t2b_8           ;                                                                       3181           bnz     t3b_11          ;
 3102           MOVLF   .3,bandneu      ;60m                                                                    3182           MOVLF   .13,bandneu     ;tr1
 3103   t2b_8:                          ;                                                                       3183   t3b_11:                         ;
 3104           movlw   .9              ;                                                                       3184           movlw   .12             ;
 3105           subwf   ebene,W         ;                                                                       3185           subwf   ebene,W         ;
 3106           bnz     t2b_9           ;                                                                       3186           bnz     t3b_12          ;
 3107           MOVLF   .6,bandneu      ;20m                                                                    3187           MOVLF   .16,bandneu     ;tr4
 3108   t2b_9:                          ;                                                                       3188   t3b_12:                         ;
 3109           movlw   .10             ;                                                                       3189           bra     t4b_98          ;
 3110           subwf   ebene,W         ;                                                                       3190   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3111           bnz     t2b_10          ;                                                                       3191   taste4behandlung:               ;
 3112           MOVLF   .9,bandneu      ;12m                                                                    3192           rcall   MenuStart       ;
 3113   t2b_10:                         ;                                                                       3193           movlw   .1              ;
 3114           movlw   .11             ;                                                                       3194           subwf   ebene,W         ;
 3115           subwf   ebene,W         ;                                                                       3195           bnz     t4b_1           ;

Dienstag November 10, 2009                                                                             mc.pic                                                                                                   20/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 41/79            Nov 10, 09 8:32                                   mc.pic                                 Page 42/79
 3196            rcall   funktionrit   ;                                                                        3276          bra     frit02           ;
 3197   t4b_1:                         ;                                                                        3277          rcall   AgleichB         ; 1 VFOa nach VFOb kopieren
 3198           movlw   .2             ;                                                                        3278          bra     frit01           ;
 3199           subwf   ebene,W        ;                                                                        3279   frit02:                         ;
 3200           bnz     t4b_2          ;                                                                        3280           rcall   BgleichA        ; 0 VFOb nach VFOa kopieren
 3201           movlw   .4             ;                                                                        3281   frit01:                         ;
 3202           subwf   step,W         ;                                                                        3282           rcall   kopie_rit_aus   ;
 3203           bz      t4b_101        ;                                                                        3283           btg     brit            ;RIT umschalten
 3204           MOVLF   4,step         ;                                                                        3284           bsf     blcdneu         ;Anzeige neu
 3205           bsf     blcdneu        ;                                                                        3285           bsf     bddsneu         ;DDS neu berechnen
 3206           bra     t4b_2          ;                                                                        3286           return                  ;
 3207   t4b_101:                                                                                                3287   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3208           rcall   umschalten_step ;Step aendern                                                           3288   kopie_rit_aus:                  ;
 3209   t4b_2:                          ;                                                                       3289           lfsr    1,frequenza     ;
 3210           movlw   .3              ;                                                                       3290           lfsr    2,frqmerk       ;
 3211           subwf   ebene,W         ;                                                                       3291           bra     kr02            ;
 3212           bnz     t4b_3           ;                                                                       3292   kopie_rit_ein:                  ;
 3213           btg     block           ;Lock ein                                                               3293           lfsr    2,frequenza     ;
 3214   t4b_3:                          ;                                                                       3294           lfsr    1,frqmerk       ;
 3215           movlw   .4              ;                                                                       3295   kr02:                           ;
 3216           subwf   ebene,W         ;                                                                       3296           MOVLF   .12,schleife    ;
 3217           bnz     t4b_4           ;                                                                       3297   kr01:                           ;
 3218           rcall   ubattanzeige    ;Anzeige Batteriespannung 2 Sekunden                                    3298           movff   POSTINC2,POSTINC1;
 3219           bra     menureset       ;                                                                       3299           decfsz schleife,F       ;
 3220   t4b_4:                          ;                                                                       3300           bra     kr01            ;
 3221           movlw   .5              ;                                                                       3301           return                  ;
 3222           subwf   ebene,W         ;                                                                       3302   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3223           bnz     t4b_5           ;                                                                       3303   AgleichB:
 3224           MOVLF   modeusb,modeneu ;USB                                                                    3304           movff   frequenza,frequenzb
 3225   t4b_5:                          ;                                                                       3305           movff   frequenza+1,frequenzb+1
 3226           movlw   .6              ;                                                                       3306           movff   frequenza+2,frequenzb+2
 3227           subwf   ebene,W         ;                                                                       3307           movff   frequenza+3,frequenzb+3
 3228           bnz     t4b_6           ;                                                                       3308           movff   frequenza+4,frequenzb+4
 3229           MOVLF   modedigr,modeneu;DIGr                                                                   3309           bra     menureset
 3230   t4b_6:                          ;                                                                       3310   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3231           movlw   .7              ;                                                                       3311   BgleichA:
 3232           subwf   ebene,W         ;                                                                       3312           movff   frequenzb,frequenza
 3233           bnz     t4b_7           ;                                                                       3313           movff   frequenzb+1,frequenza+1
 3234           MOVLF   2,bandneu       ;80m                                                                    3314           movff   frequenzb+2,frequenza+2
 3235   t4b_7:                          ;                                                                       3315           movff   frequenzb+3,frequenza+3
 3236           movlw   .8              ;                                                                       3316           movff   frequenzb+4,frequenza+4
 3237           subwf   ebene,W         ;                                                                       3317           bra     menureset
 3238           bnz     t4b_8           ;                                                                       3318   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3239           MOVLF   5,bandneu       ;30m                                                                    3319   mithoerton_ein_aus:             ;
 3240   t4b_8:                          ;                                                                       3320           btg     tonenable       ;
 3241           movlw   .9              ;                                                                       3321           btfss   tonenable       ;
 3242           subwf   ebene,W         ;                                                                       3322           return                  ;
 3243           bnz     t4b_9           ;                                                                       3323           MOVLF   1,step          ;10Hz Schrittweite
 3244           MOVLF   8,bandneu       ;15m                                                                    3324           bsf     blcdneu         ;
 3245   t4b_9:                          ;                                                                       3325           return                  ;
 3246           movlw   .10             ;                                                                       3326   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3247           subwf   ebene,W         ;                                                                       3327   umschalten_step:                ;
 3248           bnz     t4b_10          ;                                                                       3328           clrf    impulse         ;
 3249           MOVLF   .11,bandneu     ;6m                                                                     3329           movf    band,F          ;? Messmodus
 3250   t4b_10:                         ;                                                                       3330           bnz     umstep01        ;
 3251           movlw   .11             ;                                                                       3331           incf    step,F          ;1 step + 1
 3252           subwf   ebene,W         ;                                                                       3332           movlw   5               ; ? oberer Bereich ueberschritten
 3253           bnz     t4b_11          ;                                                                       3333           subwf   step,W          ;
 3254           MOVLF   .14,bandneu     ;tr2                                                                    3334           bnc     umstep_1        ;
 3255   t4b_11:                         ;                                                                       3335           clrf    step            ; 1 wieder von vorn
 3256           movlw   .12             ;                                                                       3336           bra     umstep_1        ;
 3257           subwf   ebene,W         ;                                                                       3337   umstep01:
 3258           bnz     t4b_12          ;                                                                       3338           incf    step,F          ;0 step + 1
 3259           MOVLF   .17,bandneu     ;tr5                                                                    3339           movlw   4               ; ? step > 4
 3260   t4b_12:                         ;                                                                       3340           subwf   step,W          ;
 3261   t4b_98:                         ;                                                                       3341           bnc     umstep_1        ;
 3262   menuende:                       ;                                                                       3342           clrf    step            ; 1 wieder mit 0 beginnen
 3263           clrf    tastennummer    ;keine Taste war aktiv deshalb loeschen                                 3343           btfss   b1hzanz         ;    ? keine 1Hz Anzeige
 3264           MOVLF   1,ebene         ;wieder auf Menue 1                                                     3344           incf    step,F          ;    1 mit 1 beginnen
 3265           bcf     bmenu           ;Menu ausschalten                                                       3345   umstep_1:                       ;
 3266   t4b_99:                         ;SCHLEIFE(1)                                                            3346           bsf     blcdneu         ;LCD neu anzeigen
 3267           call    Tastegedrueckt ;                                                                        3347           return                  ;
 3268           bc      t4b_99          ;ENDE(1) keine Taste gedrueckt                                          3348   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3269           return                  ;                                                                       3349   umschalten_vfo:                 ;
 3270   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         3350           rcall   setmode         ;
 3271   funktionrit:                    ;                                                                       3351           btg     bvfo            ;
 3272           btfsc   brit            ;? RIT aus                                                              3352           rcall   getmode         ;
 3273           bra     frit01          ;                                                                       3353           bsf     bddsneu         ;
 3274           rcall   kopie_rit_ein   ;                                                                       3354           bsf     blcdneu         ;
 3275           btfsc   bvfo            ;1 ? VFOa                                                               3355           return                  ;

Dienstag November 10, 2009                                                                             mc.pic                                                                                                   21/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 43/79            Nov 10, 09 8:32                                   mc.pic                                 Page 44/79
 3356   ;==============================================================================                         3436           bcf     modeA,7         ;unbedingt BIT loeschen
 3357   MenuStart:                       ;                                                                      3437           rcall   getmode         ;mode auswerten
 3358            clrf   impulse          ;Impulse loeschen                                                      3438           return                  ;
 3359            call   quittungston     ;Tastaturquittung                                                      3439   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3360            movlw  .1               ;                                                                      3440   ebandwrite:                     ;
 3361            subwf  ebene,W          ;? Ebene 1                                                             3441           rcall   setmode         ;Mode in entsprechenden VFO abspeichern
 3362            bnz    MenuStart2       ;                                                                      3442           btfsc   bminuszf        ;? RX = RX −ZF
 3363            movlw  .5               ;1 Zeitschleife aufbauen                                               3443           bsf     modeA,7         ;1 minus ZF merken
 3364            movwf  schleife         ;                                                                      3444           rcall   bandaddrset     ;Adressen und Zaehler laden
 3365   MenuStart1:                      ;                                                                      3445           rcall   lewrite         ;FrequenzA schreiben
 3366            call   Tastegedrueckt ; SCHLEIFE(1)                                                            3446           movf    POSTINC0,F      ;Ram + 1
 3367            bnc    MenuStart2       ;    break −−> Taste nicht gedrueckt                                   3447           rcall   bandaddrset1    ;Zaehler laden
 3368            call   t50mSek          ;                                                                      3448           rcall   lewrite         ;Frequenz B schreiben
 3369            decfsz schleife,F       ; ENDE(1) nach 250 msek Taste gedrueckt                                3449           movf    POSTINC0,F      ;Ram + 1
 3370            bra    MenuStart1       ;                                                                      3450           MOVLF   2,schleife      ;Zaehler laden
 3371            call   quittungsdton    ; 250 msek gedrueckt                                                   3451           rcall   lewrite         ;mode AB schreiben
 3372            call   t50mSek          ; doppelter Quittungston                                               3452           movlw   .13             ;ab 13 ist das Band ein Transverter
 3373            MOVLF  2,ebene          ;                                                                      3453           subwf   band,W          ;? Transverter
 3374   ;        incf   ebene,F          ; auf Ebene 2 schalten                                                 3454           bnc     ebw01           ;
 3375   MenuStart3:                      ;                                                                      3455           MOVLF   5,schleife      ;1 noch 5 Byte Displayshift
 3376            call   Tastegedrueckt ; SCHLEIFE(2)                                                            3456           rcall   lewrite         ; Displayshift schreiben
 3377            bc     MenuStart3       ; ENDE(2) keine Taste gedrueckt                                        3457   ebw01:                          ;
 3378   MenuStart2:                      ;                                                                      3458           return                  ;
 3379            movf   ebene,W          ;Ebene laden                                                           3459   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3380            return                  ;                                                                      3460   lewrite:                        ;
 3381   ;=========================================================================                              3461   lew01:                          ;SCHLEIFE
 3382   ;ZF in Eeprom schreiben                                                                                 3462           movf    POSTINC0,W      ; Byte aus Indexregister
 3383   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         3463           movwf   data_ee_data    ; in Eepromdaten laden
 3384   ezfwrite:                                ;                                                              3464           rcall   ewrite          ; und abspeichern
 3385           decf    mode,W                   ;                                                              3465           incf    data_ee_addr,F ; eepromadr+1
 3386           call    getZFadr                 ;ZF Adresse im Eeprom bestimmen                                3466           decfsz schleife,F       ;ENDE schleife=0
 3387           movwf   data_ee_addr             ;Ziel im Eeprom                                                3467           bra     lew01           ;
 3388           lfsr    0,zwischenfrequenz       ;Quelle im Ram                                                 3468           return                  ;
 3389           MOVLF   4,schleife               ;                                                              3469   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3390           goto    lewrite                  ;0 ZF in Eeprom schreiben                                      3470   leread:                         ;
 3391   ;=========================================================================                              3471   ler01:                          ;SCHLEIFE
 3392   ;ZF aus Eeprom lesen                                                                                    3472           rcall   eread           ; Byte aus Eeprom lesen
 3393   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         3473           movwf   POSTINC0        ; indirekt abspeichern
 3394   ezfread:                                 ;                                                              3474           incf    data_ee_addr,F ; eepromadr+1
 3395           decf    mode,W                   ;                                                              3475           decfsz schleife,F       ;ENDE schleife=0
 3396           call    getZFadr                 ;                                                              3476           bra     ler01           ;
 3397           movwf   data_ee_addr             ;                                                              3477           return                  ;
 3398           lfsr    0,zwischenfrequenz       ;Eintrittspunkt im Ram                                         3478   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3399           MOVLF   4,schleife               ;                                                              3479   menureset:                      ;
 3400           movf    mode,F                   ;? mode == 0                                                   3480           movlw   1               ;
 3401           bnz     ezfread01                ;                                                              3481           movwf   ebene           ;
 3402           CLR4    zwischenfrequenz         ;1 keine ZF                                                    3482           bcf     bmenu           ;
 3403           return                           ;                                                              3483           bsf     blcdneu         ;
 3404   ezfread01:                               ;                                                              3484           goto    LCDDisplayClear ;
 3405           goto    leread                   ;0 ZF aus Eeprom lesen                                         3485   ;=========================================================================
 3406   ;=========================================================================                              3486   ;Funktion       lesen der DDSKONST,STEP−Einstellung,Band und versch. Flags
 3407   ;Bandumschaltungen                                                                                      3487   ;Register       lfsr0, schleife
 3408   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         3488   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3409   bandaddrset:                    ;                                                                       3489   readsicherung:                           ;
 3410           call    getBandadr      ;lesen der adr im Eeprom Bandbezogen                                    3490           clrf    data_ee_addr            ;Beginn mit 0 im Eeprom
 3411           movwf   data_ee_addr    ;Vorbereiten zum Eepromlesen adr festlegen                              3491           MOVLF   .10,schleife            ;10 Byte aus Eeprom lesen
 3412           lfsr    0,frequenza     ;Eintrittspunkt im Ram                                                  3492           lfsr    0,ddskonst              ;Im Ram ab ddskonst
 3413   bandaddrset1:                   ;                                                                       3493           rcall   reads01                 ;Lesen
 3414           MOVLF   4,schleife      ;10 Byte Frequenz AB mode AB                                            3494
 3415           return                  ;                                                                       3495           MOVLF   addrxsm,data_ee_addr    ;ab Adresse addrsxm sxm,sym,mithoerton
 3416   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         3496           MOVLF   .5,schleife             ;noch 5 Byte
 3417   ebandread:                      ;                                                                       3497           lfsr    0,xsm                   ;Im Ram ab sxm
 3418           CLR5    lcdoffset       ;Vorsichthalber Offset loeschen                                         3498   reads01:                                ;SCHLEIFE(1)
 3419           rcall   bandaddrset     ;Adressen und Zaehler laden                                             3499           rcall   eread                   ; Lesen
 3420           rcall   leread          ;Frequenz A lesen                                                       3500           movwf   POSTINC0                ;
 3421           movf    POSTINC0,F      ;Ram + 1                                                                3501           incf    data_ee_addr,F          ; eeadr++
 3422           rcall   bandaddrset1    ;Zaehler laden                                                          3502           decfsz schleife,F               ;
 3423           rcall   leread          ;Frequenz B lesen                                                       3503           bra     reads01                 ;ENDE(1)
 3424           movf    POSTINC0,F      ;Ram + 1                                                                3504           return                          ;
 3425           MOVLF   2,schleife      ;Zaehler laden                                                          3505   ;==============================================================================
 3426           rcall   leread          ;mode AB lesen                                                          3506   ;Funktion       schreiben der DDSKONST,STEP−Einstellung,Band und versch. Flags
 3427           movlw   .13             ;ab 13 ist das Band ein Transverter                                     3507   ;Register       lfsr0, schleife
 3428           subwf   band,W          ;? Transverter                                                          3508   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3429           bnc     ebandread1      ;                                                                       3509   writesicherung:                         ;
 3430           MOVLF   5,schleife      ;1 noch 5 Byte Displayshift                                             3510           clrf    data_ee_addr            ;Ab Adr 0 im Eeprom
 3431           rcall   leread          ;Displayshift lesen                                                     3511           MOVLF   .10,schleife            ;10 Byte
 3432   ebandread1:                                                                                             3512           lfsr    0,ddskonst              ;im Ram ab ddskonst
 3433           bcf     bminuszf        ;RX = RX + ZF                                                           3513           rcall   writes01                ;Schreiben
 3434           btfsc   modeA,7         ;? Bit gesetzt                                                          3514
 3435           bsf     bminuszf        ;1 RX = RX − ZF                                                         3515          MOVLF   addrxsm,data_ee_addr     ;Ab Adr addrsmx im Eeprom

Dienstag November 10, 2009                                                                             mc.pic                                                                                                   22/40
                                                                                                                                                                                                        Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                     Page 45/79            Nov 10, 09 8:32                                   mc.pic                                     Page 46/79
 3516           MOVLF   .5,schleife             ;5 Byte                                                             3596            movwf  data_ee_data            ;und speichern
 3517           lfsr    0,xsm                   ;im Ram ab sxm                                                      3597            return                         ;
 3518   writes01:                               ;                                                                   3598   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3519           movf    POSTINC0,W              ;Schreiben                                                          3599   ;Lesen/Schreiben des Modes je nach Band und umspeichern in eine gemeinsame Variable
 3520           movwf   data_ee_data            ;                                                                   3600   getmode:                                ;
 3521           rcall   ewrite                  ;                                                                   3601            movf   modeA,W                 ;
 3522           incf    data_ee_addr,F          ;                                                                   3602            btfsc  bvfo                    ;
 3523           decfsz schleife,F               ;                                                                   3603            movf   modeB,W                 ;
 3524           bra     writes01                ;                                                                   3604            movwf  modeneu                 ;Modeumschaltung vormerken
 3525           return                          ;                                                                   3605            return                         ;
 3526   ;##############################################################################                             3606   setmode:                                ;
 3527   ;##############################################################################                             3607           btfsc   bvfo                    ;
 3528   ;##############################################################################                             3608           movff   mode,modeB              ;
 3529   urladung:                               ;                                                                   3609           btfss   bvfo                    ;
 3530           POINT   mgrunddatenanf          ;                                                                   3610           movff   mode,modeA              ;
 3531   urladungerweitert:                                                                                          3611           return                          ;
 3532           bcf     INTCON,GIE              ;                                                                   3612   ;##############################################################################
 3533           bsf     bintsperren             ;                                                                   3613   ddsinit:
 3534           clrf    schleife                ;                                                                   3614           movf    ddstype,F
 3535           clrf    data_ee_addr            ;                                                                   3615           bz      ad9833_ad9834_init      ;DDSTYPE == 0
 3536   urladung01:                             ;                                                                   3616           movlw   1
 3537           tblrd   *+                      ;                                                                   3617           subwf   ddstype,W
 3538           movf    TABLAT,W                ;                                                                   3618           bz      ad9850_init             ;DDSTYPE == 1
 3539           movwf   data_ee_data            ;                                                                   3619           movlw   2
 3540   ;........................................                                                                   3620           subwf   ddstype,W
 3541   ;       movlw   0                                                                                           3621           bz      ad9851_init             ;DDSTYPE == 2
 3542   ;       call    LCDPos                                                                                      3622           movlw   3
 3543   ;       movf    data_ee_data,W          ;                                                                   3623           subwf   ddstype,W
 3544   ;       call    LCDHEX                  ;                                                                   3624           bz      ad9951_1_init           ;DDSTYPE == 3
 3545   ;       goto    $                                                                                           3625           movlw   4
 3546   ;........................................                                                                   3626           subwf   ddstype,W
 3547           rcall   ewrite                  ;                                                                   3627           bz      ad9951_2_init           ;DDSTYPE == 4
 3548           incf    data_ee_addr,F          ;                                                                   3628           movlw   5
 3549           decfsz schleife,F               ;                                                                   3629           subwf   ddstype,W
 3550           bra     urladung01              ;                                                                   3630           bz      ad9951_3_init           ;DDSTYPE == 5
 3551           goto    0                       ;                                                                   3631           movlw   6
 3552   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                             3632           subwf   ddstype,W
 3553   ;==============================================================================                             3633           bz      ad9951_4_init           ;DDSTYPE == 6
 3554   ;Schreiben in Eeprom                                                                                        3634           return
 3555   ;Eingang:       Addr in data_ee_addr                                                                        3635   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 3556   ;               Daten in data_ee_data                                                                       3636   ;AD9850 und AD9851 init
 3557   ;Ausgang:       Daten im Eeprom intern                                                                      3637   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 3558   ;==============================================================================                             3638   ad9850_init:
 3559   ewrite:                                 ;SCHLEIFE(1)                                                        3639   ad9851_init:
 3560           btfsc   EECON1,WR               ; WR abfragen ob vorheriger WR fertig                               3640           return
 3561           bra     ewrite                  ;ENDE(1) wr geloescht                                               3641   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 3562           movf    data_ee_addr,W          ;Adresse holen                                                      3642   ;AD9850 und AD9851 init ende
 3563           movwf   EEADR                   ;                                                                   3643   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 3564           movf    data_ee_data,W          ;Daten holen                                                        3644   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 3565           movwf   EEDATA                                                                                      3645   ;AD9833 und AD9834 init
 3566           bcf     EECON1, EEPGD           ;to Datamemory                                                      3646   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 3567           bcf     EECON1, CFGS            ;Access program FLASH or Data EEPROM memory                         3647   ad9833_ad9834_init:
 3568           bsf     EECON1, WREN            ;enable writes                                                      3648           rcall   ad9833_ad9834_control_to_dds
 3569   ew1:                                                                                                        3649           MOVLF   B’01000100’,ddsword+1
 3570           bcf     INTCON,GIE              ;disable interrupts                                                 3650           MOVLF   B’10111011’,ddsword
 3571           btfsc   INTCON,GIE              ;                                                                   3651           rcall   ad9833_ad9834_word_to_dds
 3572           bra     ew1                     ;                                                                   3652           MOVLF   B’01000111’,ddsword+1
 3573           movlw   55h                     ;                                                                   3653           MOVLF   B’10101110’,ddsword
 3574           movwf   EECON2                  ;write 55h                                                          3654           goto    ad9833_ad9834_word_to_dds
 3575           movlw   0aah                    ;                                                                   3655   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3576           movwf   EECON2                  ;write aah                                                          3656   ad9833_ad9834_control_to_dds:
 3577           bsf     EECON1,WR               ;set wr bit to begin write                                          3657           MOVLF   B’00100000’,ddsword+1
 3578           btfss   bintsperren             ;? Ist Interrupt dauerhaft gesperrt                                 3658           MOVLF   B’00000000’,ddsword
 3579           bsf     INTCON, GIE             ;0 enable interrupts                                                3659   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3580           bcf     EECON1, WREN            ;disable writes                                                     3660   ad9833_ad9834_word_to_dds:
 3581           return                          ;                                                                   3661           bcf     a_fsync
 3582   ;==============================================================================                             3662           movf    ddsword+1,W
 3583   ;Lesen von Eeprom                                                                                           3663           rcall   ad9833_ad9834_byte_to_dds
 3584   ;Eingang:       Addr in data_ee_addr                                                                        3664           movf    ddsword,W
 3585   ;Ausgang:       Daten in w und in data_ee_data                                                              3665           rcall   ad9833_ad9834_byte_to_dds
 3586   ;==============================================================================                             3666           bsf     a_fsync
 3587   eread:                                  ;SCHLEIFE(1)                                                        3667           return
 3588           btfsc   EECON1,WR               ; WR abfragen ob vorheriger WR fertig                               3668   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3589           bra     eread                   ;ENDE(1) wr geloescht                                               3669   ad9833_ad9834_byte_to_dds:
 3590           movf    data_ee_addr,W          ;Adresse laden                                                      3670           movwf   temp
 3591           movwf   EEADR                   ;                                                                   3671           MOVLF   .8,schleife
 3592           bcf     EECON1,EEPGD            ;von Datamemory                                                     3672   ad9833_ad9834_bytetodds01:
 3593           bcf     EECON1,CFGS             ;Access program FLASH or Data EEPROM memory                         3673           rlcf    temp,F
 3594           bsf     EECON1,RD               ;enable READ                                                        3674           SKPC
 3595           movf    EEDATA,W                ;Daten holen                                                        3675           bcf     a_sdata

Dienstag November 10, 2009                                                                                 mc.pic                                                                                                       23/40
                                                                                                                                                                                                     Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                  Page 47/79            Nov 10, 09 8:32                                   mc.pic                                 Page 48/79
 3676           SKPNC                                                                                            3756   ad9833_ad9834_frq28bit_to_dds:
 3677           bsf     a_sdata                                                                                  3757           rcall   ad9833_ad9834_control_to_dds
 3678           bcf     a_sclk                                                                                   3758           LD2     ddsword,ddsdword
 3679           bsf     a_sclk                                                                                   3759           bcf     ddsword+1,7
 3680           decfsz schleife,F                                                                                3760           bsf     ddsword+1,6
 3681           bra     ad9833_ad9834_bytetodds01                                                                3761           rcall   ad9833_ad9834_word_to_dds
 3682           return                                                                                           3762           RL4     ddsdword
 3683   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          3763           RL4     ddsdword
 3684   ;AD9833 und AD9834 init ende                                                                             3764           LD2     ddsword,ddsdword+2
 3685   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          3765           bcf     ddsword+1,7
 3686   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          3766           bsf     ddsword+1,6
 3687   ;AD9951 init                                                                                             3767           goto    ad9833_ad9834_word_to_dds
 3688   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          3768   ;..............................................................................
 3689   ad9951_1_init:                                                                                           3769   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 3690           MOVLF   b’00100100’,temp;Faktor 4                                                                3770   ;AD9851
 3691           bra     ad9951_init                                                                              3771   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 3692   ad9951_2_init:                                                                                           3772   ad9851_frq32bit_to_dds:
 3693           MOVLF   b’00101100’,temp;Faktor 5                                                                3773           clrf    temp+3          ;=null
 3694           bra     ad9951_init                                                                              3774           bsf     temp+3,0        ;AD9851 Oszi x 6
 3695   ad9951_3_init:                                                                                           3775           bra     bintodds3       ;
 3696           MOVLF   b’10100100’,temp;LSB des cfr2 Registers                                                  3776   ;..............................................................................
 3697                                   ;Faktor 20 ( 0x14)                                                       3777   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 3698           bra     ad9951_init                                                                              3778   ;AD9850
 3699   ad9951_4_init:                                                                                           3779   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 3700           MOVLF   b’00000100’,temp;LSB des cfr2 Registers                                                  3780   ad9850_frq32bit_to_dds:
 3701                                   ;ohne PLL                                                                3781           clrf    temp+3                   ;5. Frequenzbyte setzen
 3702   ad9951_init:                                                                                             3782   bintodds3:
 3703           bcf     a_sclk          ;                                                                        3783           movff   ddsdword,temp+2          ; byte holen
 3704           bcf     a_fsync         ;                                                                        3784           rcall   bittodds                 ; und zum DDS ausgeben
 3705           bcf     a_sdata         ;                                                                        3785           movff   ddsdword+1,temp+2        ; byte holen
 3706           bcf     a_reset         ;                                                                        3786           rcall   bittodds                 ; und zum DDS ausgeben
 3707           MOVLF   01h,sr0         ;Adresse des cfr2 Registers                                              3787           movff   ddsdword+2,temp+2        ; byte holen
 3708           rcall   seroutDDS       ;                                                                        3788           rcall   bittodds                 ; und zum DDS ausgeben
 3709           clrf    sr0             ;0                                                                       3789           movff   ddsdword+3,temp+2        ; byte holen
 3710           rcall   seroutDDS       ;                                                                        3790           rcall   bittodds                 ; und zum DDS ausgeben
 3711           clrf    sr0             ;0                                                                       3791           movff   temp+3,temp+2            ;5. Frequenzbyte holen
 3712           rcall   seroutDDS       ;                                                                        3792           rcall   bittodds                 ;5.Byte als 0 laden
 3713           movff   temp,sr0        ;                                                                        3793           bsf     a_fsync                  ;fallende Flanke = Frequenzausgabe
 3714           rcall   seroutDDS       ;                                                                        3794           bcf     a_fsync                  ;
 3715           bsf     a_fsync         ;                                                                        3795           return
 3716           bcf     a_fsync         ;                                                                        3796   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 3717           return                                                                                           3797   ;Funktion       1 Byte in DDS laden
 3718   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          3798   bittodds:
 3719   seroutDDS:                                                                                               3799           MOVLF   8,schleife
 3720           MOVLF   .8,schleife     ;                                                                        3800   bittodds1:                       ;SCHLEIFE(1)
 3721   rot:                                                                                                     3801           rrcf    temp+2,F        ; Bit nach rechts herausschieben
 3722           rlcf    sr0,F           ;                                                                        3802           btfss   STATUS,C        ; ? Bit = 1
 3723           btfsc   STATUS,C        ;                                                                        3803           bra     bittodds2
 3724           bsf     a_sdata         ;                                                                        3804           bsf     a_sdata         ; 1 datenbit setzen
 3725           bsf     a_sclk          ;                                                                        3805           bra     bittodds3
 3726           bcf     a_sclk          ;                                                                        3806   bittodds2:
 3727           bcf     a_sdata         ;                                                                        3807           bcf     a_sdata         ; 0 datenbit loeschen
 3728           decfsz schleife,F       ;                                                                        3808   bittodds3:
 3729           bra     rot             ;                                                                        3809           bsf     a_sclk          ; fallende Flanke
 3730           return                  ;                                                                        3810           bcf     a_sclk          ; ist Uebernahme
 3731   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          3811           decfsz schleife,F       ;ENDE(1) nach 8 Durchlaeufen
 3732   ;AD9951 init Ende                                                                                        3812           bra     bittodds1
 3733   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          3813           return
 3734   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          3814   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 3735   ;INIT Ende                                                                                               3815   ;AD9951
 3736   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          3816   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 3737   ;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::                          3817   ad9951_frq32bit_to_dds:
 3738   rx2dds:                                         ;TXbin_speicher in den DDS laden                         3818           movlw   04h             ;Adresse des Frequenzregisters
 3739           LD4     ddsdword,ddsbinrx                                                                        3819           movwf   sr0             ;
 3740   frq2dds:                                                                                                 3820           rcall   seroutDDS       ;
 3741           movf    ddstype,F                       ;DDSType 0                                               3821           movff   ddsdword+3,sr0 ;
 3742           bz      ad9833_ad9834_frq28bit_to_dds                                                            3822           rcall   seroutDDS       ;
 3743           movlw   1                                                                                        3823           movff   ddsdword+2,sr0 ;
 3744           subwf   ddstype,W                       ;DDSType 1                                               3824           rcall   seroutDDS       ;
 3745           bz      ad9850_frq32bit_to_dds                                                                   3825           movff   ddsdword+1,sr0 ;
 3746           movlw   2                                                                                        3826           rcall   seroutDDS       ;
 3747           subwf   ddstype,W                       ;DDSType 2                                               3827           movff   ddsdword,sr0     ;
 3748           bz      ad9851_frq32bit_to_dds                                                                   3828           rcall   seroutDDS       ;
 3749           bra     ad9951_frq32bit_to_dds          ;DDSType >= 3                                            3829           bsf     a_fsync         ;
 3750           return                                                                                           3830           bcf     a_fsync         ;
 3751   ;..............................................................................                          3831           return                  ;
 3752   tx2dds:                                         ;RXbin_speicher in den DDS laden                         3832   ;##############################################################################
 3753            LD4    ddsdword,ddsbintx                                                                        3833   ;    DDS Bereich zuende
 3754            bra    frq2dds                                                                                  3834   ;##############################################################################
 3755   ;..............................................................................                          3835   ;##############################################################################

Dienstag November 10, 2009                                                                              mc.pic                                                                                                   24/40
                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 49/79            Nov 10, 09 8:32                            mc.pic        Page 50/79
 3836   ;##############################################################################                         3916           subwf    setupnr,W      ;
 3837   setupnrmax      equ     D’25’           ;                                                               3917           bnz      LCDsetup03     ;
 3838                                                                                                           3918           LCDStr   stext3         ;
 3839   SETUP:                                  ;                                                               3919           btfss    bbeleuchtung   ;
 3840            bsf    a_licht                 ;                                                               3920           rcall    lcd0           ;
 3841            call   LCDDisplayClear         ;                                                               3921           btfsc    bbeleuchtung   ;
 3842   SETUP00:                                ;SCHLEIFE(1)                                                    3922           rcall    lcd1           ;
 3843            call   Tastegedrueckt          ; ? Taste gedrueckt                                             3923           return                  ;
 3844            bc     SETUP00                 ;ENDE(1) Taste nicht mehr gedrueckt                             3924   LCDsetup03:                     ;
 3845            clrf   impulse                 ;                                                               3925           movlw    .4             ;
 3846            MOVLF  1,setupnr               ;                                                               3926           subwf    setupnr,W      ;
 3847   SETUP01:                                ;                                                               3927           bnz      LCDsetup04     ;
 3848            rcall  LCDsetup                ;anzeige des ersten Menues                                      3928           LCDStr   stext4         ;
 3849   SETUP02:                                ;                                                               3929           btfss    b1hzanz        ;
 3850            btfsc  impulse,7               ;? positive Drehrichtung                                        3930           rcall    lcd0           ;
 3851            bra    SETUP03                 ;                                                               3931           btfsc    b1hzanz        ;
 3852            movf   impulse,W               ;                                                               3932           rcall    lcd1           ;
 3853            andlw  B’01111100’             ;1 ? Steps reduzieren/Steps angefallen                          3933           return                  ;
 3854            bz     SETUP04                 ;                                                               3934   LCDsetup04:                     ;
 3855            incf   setupnr,F               ; 1 Ebene +1                                                    3935           movlw    .5             ;
 3856            movlw  setupnrmax + 1          ;    ? maximale Ebene erreicht                                  3936           subwf    setupnr,W      ;
 3857            subwf  setupnr,W               ;                                                               3937           bnz      LCDsetup05     ;
 3858            bnz    SETUP05                 ;                                                               3938           LCDStr   stext5         ;
 3859            MOVLF  1,setupnr               ;    1 Ebene = 1                                                3939           btfss    bkeyerein      ;
 3860   SETUP05:                                ;                                                               3940           rcall    lcd0           ;
 3861            bra    SETUP06                 ;                                                               3941           btfsc    bkeyerein      ;
 3862   SETUP03:                                ;                                                               3942           rcall    lcd1           ;
 3863            movff  impulse,schleife+3      ;0 negative Drehrichtung                                        3943           return                  ;
 3864            negf   schleife+3              ; Impulse merken da nicht reduziert                             3944   LCDsetup05:                     ;
 3865            movf   schleife+3,W            ; und negieren                                                  3945           movlw    .6             ;
 3866            andlw  B’11111100’             ; ? Steps reduzieren/Steps angefallen                           3946           subwf    setupnr,W      ;
 3867            bz     SETUP04                 ;                                                               3947           bnz      LCDsetup051    ;
 3868            decf   setupnr,F               ; 1 Ebene −1                                                    3948           LCDStr   stext6         ;
 3869            incf   setupnr,W               ;    ? Ebene < 0                                                3949           btfss    btxpermzf      ;
 3870            bnz    SETUP06                 ;                                                               3950           rcall    lcd0           ;
 3871            MOVLF  setupnrmax,setupnr      ;    1 Ebene == maxmenu                                         3951           btfsc    btxpermzf      ;
 3872   SETUP06:                                ;                                                               3952           rcall    lcd1           ;
 3873            rcall  LCDsetup                ;anzeige des ersten Menues                                      3953           return                  ;
 3874            clrf   impulse                 ;                                                               3954   LCDsetup051:                    ;
 3875   SETUP04:                                ;                                                               3955           movlw    .7             ;
 3876           call    Tastegedrueckt          ;? Taste gedrueckt                                              3956           subwf    setupnr,W      ;
 3877           bnc     SETUP02                 ;                                                               3957           bnz      LCDsetup052    ;
 3878           call    quittungston            ;1 Quittungston ausgeben                                        3958           LCDStr   stext7         ;
 3879           call    Tastaturstatus          ; ? Tasttaturabfrage Taste 1                                    3959           btfss    bminuszf       ;
 3880           movlw   1                       ;                                                               3960           rcall    lcd0           ;
 3881           subwf   tastennummer,W          ;                                                               3961           btfsc    bminuszf       ;
 3882           bnz     SETUP07                 ;                                                               3962           rcall    lcd1           ;
 3883           rcall   csetup                  ;                                                               3963           return                  ;
 3884           goto    0                       ;Neustart                                                       3964   LCDsetup052:                    ;
 3885   SETUP07:                                ;                                                               3965           movlw    .8             ;
 3886           movlw   4                       ;                                                               3966           subwf    setupnr,W      ;
 3887           subwf   tastennummer,W          ;                                                               3967           bnz      LCDsetup053    ;
 3888           bnz     SETUP04                 ;                                                               3968           LCDStr   stext7_1       ;
 3889           goto    menuende                ;Abbruch −−> zurueck in Taskschleife                            3969           btfss    bbandmode      ;
 3890   ;..............................................................................                         3970           rcall    lcd0           ;
 3891   LCDsetup:                       ;                                                                       3971           btfsc    bbandmode      ;
 3892           LCDStrp stext           ;                                                                       3972           rcall    lcd1           ;
 3893           clrf    WREG            ;                                                                       3973           return                  ;
 3894           call    LCDPos          ;                                                                       3974   LCDsetup053:                    ;
 3895           movlw   .1              ;                                                                       3975           movlw    .9             ;
 3896           subwf   setupnr,W       ;                                                                       3976           subwf    setupnr,W      ;
 3897           bnz     LCDsetup01      ;                                                                       3977           bnz      LCDsetup054    ;
 3898           LCDStr stext1           ;                                                                       3978           LCDStr   stext7_2       ;
 3899           btfss   blcdsmeter      ;                                                                       3979           btfss    bvfox4         ;
 3900           rcall   lcd0            ;                                                                       3980           rcall    lcd0           ;
 3901           btfsc   blcdsmeter      ;                                                                       3981           btfsc    bvfox4         ;
 3902           rcall   lcd1            ;                                                                       3982           rcall    lcd1           ;
 3903           return                  ;                                                                       3983           return                  ;
 3904   LCDsetup01:                     ;                                                                       3984   LCDsetup054:                    ;
 3905           movlw   .2              ;                                                                       3985           movlw    .10            ;
 3906           subwf   setupnr,W       ;                                                                       3986           subwf    setupnr,W      ;
 3907           bnz     LCDsetup02      ;                                                                       3987           bnz      LCDsetup06     ;
 3908           LCDStr stext2           ;                                                                       3988           LCDStr   stext8         ;
 3909           btfss   blauto          ;                                                                       3989           return                  ;
 3910           rcall   lcd0            ;                                                                       3990   LCDsetup06:                     ;
 3911           btfsc   blauto          ;                                                                       3991           movlw    .11            ;
 3912           rcall   lcd1            ;                                                                       3992           subwf    setupnr,W      ;
 3913           return                  ;                                                                       3993           bnz      LCDsetup07     ;
 3914   LCDsetup02:                     ;                                                                       3994           LCDStr   stext9         ;
 3915           movlw   .3              ;                                                                       3995           return                  ;

Dienstag November 10, 2009                                                                             mc.pic                                                                   25/40
                                                                                                                                                                  Printed by Andreas
 Nov 10, 09 8:32                               mc.pic   Page 51/79            Nov 10, 09 8:32                                   mc.pic                                 Page 52/79
 3996   LCDsetup07:                    ;                                      4076           subwf   setupnr,W       ;
 3997           movlw    .12           ;                                      4077           bnz     LCDsetup18      ;
 3998           subwf    setupnr,W     ;                                      4078           LCDStr stext17_2        ;
 3999           bnz      LCDsetup071   ;                                      4079           return                  ;
 4000           LCDStr   stext9_1          ;                                  4080   LCDsetup18:                     ;
 4001           return                 ;                                      4081           return                  ;
 4002   LCDsetup071:                   ;                                      4082   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 4003           movlw    .13           ;                                      4083   ;Anzeige "1" im Display
 4004           subwf    setupnr,W     ;                                      4084   lcd1:
 4005           bnz      LCDsetup08    ;                                      4085           movlw   ’1’             ;
 4006           LCDStr   stext10       ;                                      4086           goto    LCDChar         ;
 4007           return                 ;                                      4087   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 4008   LCDsetup08:                    ;                                      4088   ;Anzeige "0" im Display
 4009           movlw    .14           ;                                      4089   lcd0:
 4010           subwf    setupnr,W     ;                                      4090           movlw   ’0’             ;
 4011           bnz      LCDsetup09    ;                                      4091           goto    LCDChar         ;
 4012           LCDStr   stext11       ;                                      4092   ;..............................................................................
 4013           return                 ;                                      4093   ;Funktion       Sprung zur entsprechenden Setupfunktion
 4014   LCDsetup09:                    ;                                      4094   ;..............................................................................
 4015           movlw    .15           ;                                      4095   csetup:                         ;SCHLEIFE(1)
 4016           subwf    setupnr,W     ;                                      4096           call    Tastegedrueckt ;
 4017           bnz      LCDsetup10    ;                                      4097           bc      csetup          ;ENDE(1) keine Taste gedrueckt
 4018           LCDStr   stext12       ;                                      4098           call    LCDDisplayClear ;LCD loeschen
 4019           return                 ;                                      4099           movlw   .1              ;Funktionsnummer
 4020   LCDsetup10:                    ;                                      4100           subwf   setupnr,W       ;
 4021           movlw    .16           ;                                      4101           bnz     csetup01        ;
 4022           subwf    setupnr,W     ;                                      4102           bra     csmeter         ;S−Meter ein/aus
 4023           bnz      LCDsetup101   ;                                      4103   csetup01:                       ;
 4024           LCDStr   stext12_1         ;                                  4104           movlw   .2              ;
 4025           return                 ;                                      4105           subwf   setupnr,W       ;
 4026   LCDsetup101:                   ;                                      4106           bnz     csetup02        ;
 4027           movlw    .17           ;                                      4107           bra     slightauto      ;Lichtautomatik ein/aus
 4028           subwf    setupnr,W     ;                                      4108   csetup02:                       ;
 4029           bnz      LCDsetup11    ;                                      4109           movlw   .3              ;
 4030           LCDStr   stext13       ;                                      4110           subwf   setupnr,W       ;
 4031           goto     type99        ;                                      4111           bnz     csetup03        ;
 4032   LCDsetup11:                    ;                                      4112           bra     slight          ;Licht dauerhaft ein/aus
 4033           movlw    .18           ;                                      4113   csetup03:                       ;
 4034           subwf    setupnr,W     ;                                      4114           movlw   .4              ;
 4035           bnz      LCDsetup12    ;                                      4115           subwf   setupnr,W       ;
 4036           LCDStr   stext14       ;                                      4116           bnz     csetup04        ;
 4037           return                 ;                                      4117           bra     s1hz            ;1Hz Anzeige ein/aus
 4038   LCDsetup12:                    ;                                      4118   csetup04:                       ;
 4039           movlw    .19           ;                                      4119           movlw   .5              ;
 4040           subwf    setupnr,W     ;                                      4120           subwf   setupnr,W       ;
 4041           bnz      LCDsetup13    ;                                      4121           bnz     csetup05        ;
 4042           LCDStr   stext15       ;                                      4122           bra     skey            ;Keyer ein/aus
 4043           return                 ;                                      4123   csetup05:                       ;
 4044   LCDsetup13:                    ;                                      4124           movlw   .6              ;
 4045           movlw    .20           ;                                      4125           subwf   setupnr,W       ;
 4046           subwf    setupnr,W     ;                                      4126           bnz     csetup051       ;
 4047           bnz      LCDsetup14    ;                                      4127           bra     ctxzf           ;Beim Senden +/− ZF
 4048           LCDStr   stext15_1     ;                                      4128   csetup051:                      ;
 4049           return                 ;                                      4129           movlw   .7              ;
 4050   LCDsetup14:                    ;                                      4130           subwf   setupnr,W       ;
 4051           movlw    .21           ;                                      4131           bnz     csetup052       ;
 4052           subwf    setupnr,W     ;                                      4132           bra     sminuszf        ;VFO = RXfrq +/− ZF
 4053           bnz      LCDsetup141   ;                                      4133   csetup052:                      ;
 4054           LCDStr   stext15_2     ;                                      4134           movlw   .8              ;
 4055           return                 ;                                      4135           subwf   setupnr,W       ;
 4056   LCDsetup141:                   ;                                      4136           bnz     csetup053       ;
 4057           movlw    .22           ;                                      4137           bra     sbandmode       ;Band Modeumschaltung aktiv
 4058           subwf    setupnr,W     ;                                      4138   csetup053:                      ;
 4059           bnz      LCDsetup15    ;                                      4139           movlw   .9              ;
 4060           LCDStr   stext16       ;                                      4140           subwf   setupnr,W       ;
 4061           return                 ;                                      4141           bnz     csetup054       ;
 4062   LCDsetup15:                    ;                                      4142           bra     svfox4          ;VFO x 4
 4063           movlw    .23           ;                                      4143   csetup054:                      ;
 4064           subwf    setupnr,W     ;                                      4144           movlw   .10             ;
 4065           bnz      LCDsetup16    ;                                      4145           subwf   setupnr,W       ;
 4066           LCDStr   stext17       ;                                      4146           bnz     csetup06        ;
 4067           return                 ;                                      4147           bra     sddskonst       ;DDS−Konstande aendern
 4068   LCDsetup16:                    ;                                      4148   csetup06:                       ;
 4069           movlw    .24           ;                                      4149           movlw   .11             ;
 4070           subwf    setupnr,W     ;                                      4150           subwf   setupnr,W       ;
 4071           bnz      LCDsetup17    ;                                      4151           bnz     csetup07        ;
 4072           LCDStr   stext17_1     ;                                      4152           MOVLF   modecw,mode     ;
 4073           return                 ;                                      4153           bra     szfkonst        ;ZF CW aendern
 4074   LCDsetup17:                    ;                                      4154   csetup07:                       ;
 4075           movlw    .25           ;                                      4155           movlw   .12             ;

Dienstag November 10, 2009                                           mc.pic                                                                                                   26/40
                                                                                                                                                                                                        Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 53/79            Nov 10, 09 8:32                                       mc.pic                                 Page 54/79
 4156           subwf   setupnr,W       ;                                                                       4236             bcf       bvfo                    ;FrequenzA einstellen
 4157           bnz     csetup071       ;                                                                       4237             clrf      impulse                 ;Drehimpulse auf 0 stellen
 4158           MOVLF   modecwr,mode    ;                                                                       4238             call      ezfread                 ;entsprechende ZF lesen
 4159           bra     szfkonst        ;ZF CWr aendern                                                         4239             bsf       bohnezf                 ;ZF−Berechnung ausschalten
 4160   csetup071:                      ;                                                                       4240             movff     zwischenfrequenz,mddskonst      ;ZF in Zwischenspeicher
 4161           movlw   .13             ;                                                                       4241             movff     zwischenfrequenz+1,mddskonst+1 ;kopieren
 4162           subwf   setupnr,W       ;                                                                       4242             movff     zwischenfrequenz+2,mddskonst+2 ;
 4163           bnz     csetup08        ;                                                                       4243             movff     zwischenfrequenz+3,mddskonst+3 ;
 4164           MOVLF   modelsb,mode    ;                                                                       4244             call      LCDDisplayClear         ;LCD loeschen
 4165           bra     szfkonst        ;ZF LSB aendern                                                         4245             LCDStrp   qtext6                  ;"<   >    X     ok"
 4166   csetup08:                       ;                                                                       4246             movlw     .0                      ;zuordnen
 4167           movlw   .14             ;                                                                       4247             movwf     stemp                   ;Stellenlaenge = 6
 4168           subwf   setupnr,W       ;                                                                       4248             rcall     z1clr                   ;Zeile1 loeschen
 4169           bnz     csetup09        ;                                                                       4249             LCDStr    tmhz                    ;MHz dahinter
 4170           MOVLF   modeusb,mode    ;                                                                       4250   szfk00:                                     ;SCHLEIFE(3)
 4171           bra     szfkonst        ;ZF USB aendern                                                         4251            movff      mddskonst,frequenza     ; Zwischenspeicher in VFOa
 4172   csetup09:                       ;                                                                       4252            movff      mddskonst+1,frequenza+1 ; kopieren
 4173           movlw   .15             ;                                                                       4253            movff      mddskonst+2,frequenza+2 ; ZF wird direkt am DDS ausgegeben
 4174           subwf   setupnr,W       ;                                                                       4254            movff      mddskonst+3,frequenza+3 ;
 4175           bnz     csetup10        ;                                                                       4255            call       ddsbinausrechnen        ; BINs neu ausrechnen tx + rx
 4176           MOVLF   modedig,mode    ;                                                                       4256            call       bin2ddsrx               ; RX−Frequenz in DDS laden
 4177           bra     szfkonst        ;ZF digital aendern                                                     4257            clrf       WREG                    ; auf LCD neue
 4178   csetup10:                       ;                                                                       4258            call       LCDPos                  ; Frequenz anzeigen
 4179           movlw   .16             ;                                                                       4259            movff      mddskonst,faktor1       ;
 4180           subwf   setupnr,W       ;                                                                       4260            movff      mddskonst+1,faktor1+1   ;
 4181           bnz     csetup101       ;                                                                       4261            movff      mddskonst+2,faktor1+2   ;
 4182           MOVLF   modedigr,mode   ;                                                                       4262            movff      mddskonst+3,faktor1+3   ;
 4183           bra     szfkonst        ;ZF digital revers aendern                                              4263            call       hex2bcd5b               ;
 4184   csetup101:                      ;                                                                       4264            call       bcd2char6b              ;
 4185           movlw   .17             ;                                                                       4265            MOVLF      .10,laenge              ;
 4186           subwf   setupnr,W       ;                                                                       4266            MOVLF      .6,komma                ;
 4187           bnz     csetup11        ;                                                                       4267            movff      stemp,kuerzen           ;
 4188           goto    sddstype        ;DDS−Type auswaehlen                                                    4268            call       printf                  ;
 4189   csetup11:                       ;                                                                       4269   szfk001:
 4190           movlw   .18             ;                                                                       4270            movf       impulse,F              ;   ? Impulse angefallen
 4191           subwf   setupnr,W       ;                                                                       4271            bnz        szfk002                ;
 4192           bnz     csetup12        ;                                                                       4272            bra        szfk022
 4193           bra     stransverter    ;LCDoffset aendern                                                      4273   szfk002:
 4194   csetup12:                       ;                                                                       4274            CLR4       stemp1                 ;
 4195           movlw   .19             ;                                                                       4275            btfsc      impulse,7              ;   1 ? positive Drehrichtung
 4196           subwf   setupnr,W       ;                                                                       4276            bra        szfk023                ;
 4197           bnz     csetup13        ;                                                                       4277            movf       stemp,F                ;     1 ? Anzahl der Stellen
 4198           goto    seichsmeter     ;Kalibrieren S−Meter                                                    4278            bnz        szfk024                ;       8 Stellen aendern
 4199   csetup13:                       ;                                                                       4279            INC4       mddskonst              ;
 4200           movlw   .20             ;                                                                       4280            bra        szfk0224               ;
 4201           subwf   setupnr,W       ;                                                                       4281   szfk024:
 4202           bnz     csetup13_1      ;                                                                       4282            movlw      .2                     ;       6 Stellen aendern
 4203           goto    sspot           ;Tonhoehe Mithoerton einstellen                                         4283            subwf      stemp,W                ;
 4204   csetup13_1:                     ;                                                                       4284            bnz        szfk025                ;
 4205           movlw   .21             ;                                                                       4285            MOVLF      .100,stemp1            ;
 4206           subwf   setupnr,W       ;                                                                       4286            ADD4       mddskonst,stemp1       ;
 4207           bnz     csetup13_2      ;                                                                       4287            bra        szfk0224               ;
 4208           goto    stxhang         ;Tonhoehe Mithoerton einstellen                                         4288   szfk025:
 4209   csetup13_2:                     ;                                                                       4289            movlw      .4                     ;       4 Stellen aendern
 4210           movlw   .22             ;                                                                       4290            subwf      stemp,W                ;
 4211           subwf   setupnr,W       ;                                                                       4291            bnz        szfk026                ;
 4212           bnz     csetup14        ;                                                                       4292            MOVLF      0x10,stemp1            ;
 4213           goto    sendeeprom      ;Eeprom Inhalt senden                                                   4293            MOVLF      0x27,stemp1+1          ;
 4214   csetup14:                       ;                                                                       4294            ADD4       mddskonst,stemp1       ;
 4215           movlw   .23             ;                                                                       4295            bra        szfk0224               ;
 4216           subwf   setupnr,W       ;                                                                       4296   szfk026:                                   ;
 4217           bnz     csetup15        ;                                                                       4297            movlw      .6                     ;       2 Stellen aendern
 4218           goto    leseeprom       ;Eeprom Inhalt senden                                                   4298            subwf      stemp,W                ;
 4219   csetup15:                       ;                                                                       4299            bnz        szfk027                ;
 4220           movlw   .24             ;                                                                       4300            MOVLF      0x40,stemp1            ;
 4221           subwf   setupnr,W       ;                                                                       4301            MOVLF      0x42,stemp1+1          ;
 4222           bnz     csetup16        ;                                                                       4302            MOVLF      0x0f,stemp1+2          ;
 4223           goto    ee2flash        ;Eeprom in Flash speichern                                              4303            ADD4       mddskonst,stemp1       ;
 4224   csetup16:                       ;                                                                       4304            bra        szfk0224               ;
 4225           movlw   .25             ;                                                                       4305   szfk027:                                   ;   0 negative Drehrichtung
 4226           subwf   setupnr,W       ;                                                                       4306   szfk023:                                   ;   0 negative Drehrichtung
 4227           bnz     csetup17        ;                                                                       4307           movf        stemp,F                ;     ? Stellen
 4228           goto    flash2ee        ;Flash in Eeprom laden                                                  4308           bnz         szfk0221               ;
 4229   csetup17:                       ;                                                                       4309           DEC4        mddskonst              ;    8 Stellen aendern
 4230           return                  ;                                                                       4310           bra         szfk0224               ;
 4231   ;..............................................................................                         4311   szfk0221:
 4232   ;Funktion       Aendern der ZF im Ram                                                                   4312           movlw       .2                     ;    6 Stellen aendern
 4233   ;               Anzeige dezimal mit Komma                                                               4313           subwf       stemp,W                ;
 4234   szfkonst:                                                                                               4314           bnz         szfk0222               ;
 4235           movff   mode,modeA              ;Mode an die richtige Stelle kopieren                           4315           MOVLF       .100,stemp1            ;

Dienstag November 10, 2009                                                                             mc.pic                                                                                                       27/40
                                                                                                                                                                                                        Printed by Andreas
 Nov 10, 09 8:32                                     mc.pic                                   Page 55/79            Nov 10, 09 8:32                                   mc.pic                                 Page 56/79
 4316            SUB4     mddskonst,stemp1       ;                                                                  4396            clrf    WREG                   ; Pos 0 auf LCD
 4317            bra      szfk0224               ;                                                                  4397            call    LCDPos                 ;
 4318   szfk0222:                                                                                                   4398            movlw   .13                    ; 1. zeile loeschen
 4319            movlw    .4                     ;     4 Stellen aendern                                            4399            goto    LCDSpacel              ;
 4320            subwf    stemp,W                ;                                                                  4400   ;..............................................................................
 4321            bnz      szfk0223               ;                                                                  4401   sddskonst:
 4322            MOVLF    0x10,stemp1            ;                                                                  4402            bcf     bvfo                   ;FrequenzA einstellen
 4323            MOVLF    0x27,stemp1+1          ;                                                                  4403            bsf     bohnezf                ;ZF aus
 4324            SUB4     mddskonst,stemp1       ;                                                                  4404            movff   ddskonst,mddskonst     ;DDS Konstande
 4325            bra      szfk0224               ;                                                                  4405            movff   ddskonst+1,mddskonst+1 ;kopieren
 4326   szfk0223:                                                                                                   4406            movff   ddskonst+2,mddskonst+2 ;
 4327            movlw    .6                     ;     2 Stellen aendern                                            4407            movff   ddskonst+3,mddskonst+3 ;
 4328            subwf    stemp,W                ;                                                                  4408            movff   ddskonst+4,mddskonst+4 ;
 4329            bnz      szfk0224               ;                                                                  4409            call    LCDDisplayClear        ;LCD loeschen
 4330            MOVLF    0x40,stemp1            ;                                                                  4410            LCDStrp qtext6                 ;"<   >    X    ok"
 4331            MOVLF    0x42,stemp1+1          ;                                                                  4411            movlw   .5                     ;zuordnen
 4332            MOVLF    0x0f,stemp1+2          ;                                                                  4412            movwf   stemp                  ;Stellenlaenge = 5
 4333            SUB4     mddskonst,stemp1       ;                                                                  4413   sddsk00:                                ;SCHLEIFE(3)
 4334   szfk0224:                                                                                                   4414            call    ddsbinausrechnen       ; BINs neu ausrechnen tx + rx
 4335            clrf     impulse                ;     0 Impulse loeschen                                           4415            call    bin2ddsrx              ; RX−Frequenz laden
 4336            bra      szfk00                 ;                                                                  4416            rcall   z1clr                  ; Zeile 1 loeschen
 4337   szfk022:                                 ;                                                                  4417            clrf    WREG                   ; an den Anfang der zeile
 4338            call     Tastegedrueckt         ;   ? Taste gedrueckt                                              4418            call    LCDPos                 ; und
 4339            bc       szfk0231               ;                                                                  4419            movff   stemp,schleife         ; HEX neu auf LCD
 4340            bra      szfk001                ;                                                                  4420            lfsr    0,ddskonst+4           ; darstellen
 4341   szfk0231:                                                                                                   4421   sddsk01:                                ; SCHLEIFE(1)
 4342            call     quittungston           ; 1 Quittungston ausgeben                                          4422           movf     POSTDEC0,W             ;    je nach laenge
 4343            call     Tastaturstatus         ;    ? Welche Taste                                                4423           call     LCDHEX                 ;    HEX darstellen
 4344            movlw    .1                     ;                                                                  4424           decfsz schleife,F               ;
 4345            subwf    tastennummer,W         ;                                                                  4425           bra      sddsk01                ; ENDE(1) stemp==0
 4346            bnz      szfk03                 ;                                                                  4426   sddsk02:                                ;
 4347            incf     stemp,F                ;    1 Taste 1                                                     4427           movf     impulse,F              ; ? Impulse angefallen
 4348            incf     stemp,F                ;                                                                  4428           bz       sddsk022               ;
 4349            movlw    .8                     ;                                                                  4429           btfsc    impulse,7              ; 1 ? positive Drehrichtung
 4350            subwf    stemp,W                ;      ? min erreicht                                              4430           bra      sddsk023               ;
 4351            bnz      szfk021                ;                                                                  4431           movlw    .5                     ;    1 ? Anzahl der Stellen
 4352            clrf     stemp                  ;      1 wieder mit 0 laden                                        4432           subwf    stemp,W                ;      5 Stellen aendern
 4353   szfk021:                                 ;                                                                  4433           bnz      sddsk024               ;
 4354            bra      szfk98                 ;                                                                  4434           INC5     ddskonst               ;
 4355   szfk03:                                  ;                                                                  4435   sddsk024:                               ;
 4356            movlw    .2                     ;                                                                  4436           movlw    .4                     ;      4 Stellen aendern
 4357            subwf    tastennummer,W         ;                                                                  4437           subwf    stemp,W                ;
 4358            bnz      szfk04                 ;                                                                  4438           bnz      sddsk025               ;
 4359            decf     stemp,F                ;    2 Taste 2                                                     4439           INC4     ddskonst+1             ;
 4360            decf     stemp,F                ;                                                                  4440   sddsk025:                               ;
 4361            btfss    stemp,7                ;      ? min erreicht Ueberlauf unter null                         4441           movlw    .3                     ;      3 Stellen aendern
 4362            bra      szfk031                ;                                                                  4442           subwf    stemp,W                ;
 4363            movlw    .6                     ;      1 wieder max einstellen                                     4443           bnz      sddsk026               ;
 4364            movwf    stemp                  ;                                                                  4444           INC3     ddskonst+2             ;
 4365   szfk031:                                 ;                                                                  4445   sddsk026:                               ;
 4366            bra      szfk06                 ;                                                                  4446           movlw    .2                     ;      2 Stellen aendern
 4367   szfk04:                                  ;                                                                  4447           subwf    stemp,W                ;
 4368            movlw    .3                     ;                                                                  4448           bnz      sddsk027               ;
 4369            subwf    tastennummer,W         ;                                                                  4449           INC2     ddskonst+3             ;
 4370            bnz      szfk05                 ;                                                                  4450   sddsk027:                               ;
 4371            bra      szfk99X                ;    3 Taste 3 Cancel                                              4451           movlw    .1                     ;      1 Stelle aendern
 4372   szfk05:                                  ;                                                                  4452           subwf    stemp,W                ;
 4373            movlw    .4                     ;                                                                  4453           bnz      sddsk028               ;
 4374            subwf    tastennummer,W         ;                                                                  4454           incf     ddskonst+4,F           ;
 4375            bnz      szfk06                 ;                                                                  4455   sddsk028:                               ;
 4376            bra      szfk99ok               ;    4 Taste 4 OK                                                  4456           bra      sddsk0225              ;
 4377   szfk06:                                  ;                                                                  4457   sddsk023:                               ; 0 negative Drehrichtung
 4378            rcall    z1clr                  ; Zeile1 loeschen                                                  4458           movlw    .5                     ;    ? Anzahl der Stellen
 4379            LCDStr   tmhz                   ; MHz dahinter                                                     4459           subwf    stemp,W                ;    5 Stellen aendern
 4380   szfk98:                                  ;                                                                  4460           bnz      sddsk0221              ;
 4381           call      Tastegedrueckt         ; SCHLEIFE(2)                                                      4461           DEC5     ddskonst               ;
 4382           bc        szfk98                 ; ENDE(2) Taste nicht mehr gedrueckt                               4462   sddsk0221:                              ;
 4383           bra       szfk00                 ;ENDE(3) Taste X oder OK                                           4463           movlw    .4                     ;    4 Stellen aendern
 4384   szfk99X:                                                                                                    4464           subwf    stemp,W                ;
 4385           return                            ;X                                                                4465           bnz      sddsk0222              ;
 4386   szfk99ok:                                 ;OK                                                               4466           DEC4     ddskonst+1             ;
 4387           movff     mddskonst,zwischenfrequenz     ;Zwischenspeicher wieder                                   4467   sddsk0222:                              ;
 4388           movff     mddskonst+1,zwischenfrequenz+1 ;in ZF laden                                               4468           movlw    .3                     ;    3 Stellen aendern
 4389           movff     mddskonst+2,zwischenfrequenz+2 ;zum Abspeichern                                           4469           subwf    stemp,W                ;
 4390           movff     mddskonst+3,zwischenfrequenz+3 ;                                                          4470           bnz      sddsk0223              ;
 4391           goto      ezfwrite                ; zf speichern                                                    4471           DEC3     ddskonst+2             ;
 4392                                                                                                               4472   sddsk0223:                              ;
 4393   tmhz    db      "MHz",0                                                                                     4473           movlw    .2                     ;    2 Stellen aendern
 4394   ;..............................................................................                             4474           subwf    stemp,W                ;
 4395   z1clr:                                                                                                      4475           bnz      sddsk0224              ;

Dienstag November 10, 2009                                                                                 mc.pic                                                                                                   28/40
                                                                                                                                                                                                       Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                    Page 57/79            Nov 10, 09 8:32                                   mc.pic                                 Page 58/79
 4476            DEC2   ddskonst+3              ;                                                                  4556           movlw   .3                      ;
 4477   sddsk0224:                              ;                                                                  4557           subwf   tastennummer,W          ;
 4478            movlw  .1                      ;    1 Stelle aendern                                              4558           bnz     smzf03                  ;
 4479            subwf  stemp,W                 ;                                                                  4559           bsf     bminuszf                ;
 4480            bnz    sddsk0225               ;                                                                  4560           bra     smzf04                  ;
 4481            decf   ddskonst+4,F            ;                                                                  4561   smzf03:                                 ;
 4482   sddsk0225:                              ;                                                                  4562            movlw   .4                     ;
 4483            clrf   impulse                 ;    01Impulse loeschen                                            4563            subwf   tastennummer,W         ;
 4484            bra    sddsk00                 ;                                                                  4564            bnz     smzf05                 ;
 4485   sddsk022:                               ;                                                                  4565            bcf     bminuszf               ;
 4486            call   Tastegedrueckt          ; ? Taste gedrueckt                                                4566   smzf04:                                 ;
 4487            bnc    sddsk02                 ;                                                                  4567            call    ebandwrite             ;Banddaten speichern
 4488            call   quittungston            ; 1 Quittungston ausgeben                                          4568   smzf05:                                 ;
 4489            call   Tastaturstatus          ;    ? Welche Taste                                                4569            return                         ;
 4490            movlw  .1                      ;                                                                  4570   ;..............................................................................
 4491            subwf  tastennummer,W          ;                                                                  4571   svfox4:                         ;
 4492            bnz    sddsk03                 ;                                                                  4572            LCDStrp qtext20                ;"VFOx4 I/Q Mixer"
 4493            decf   stemp,F                 ;    1 Taste 1                                                     4573            rcall   readflag               ;
 4494            movf   stemp,F                 ;       ? min erreicht                                             4574   svfox4a01:                              ;
 4495            bnz    sddsk021                ;                                                                  4575            call    Tastegedrueckt         ;
 4496            movlw  .5                      ;       1 wieder mit max beginnen                                  4576            bnc     svfox4a01              ;
 4497            movwf  stemp                   ;                                                                  4577            call    Tastaturstatus         ;
 4498   sddsk021:                               ;                                                                  4578            movlw   .1                     ;
 4499            bra    sddsk98                 ;                                                                  4579            subwf   tastennummer,W         ;
 4500   sddsk03:                                ;                                                                  4580            bz      svfox405               ;
 4501            movlw  .2                      ;                                                                  4581   svfox401:                               ;
 4502            subwf  tastennummer,W          ;                                                                  4582            movlw   .2                     ;
 4503            bnz    sddsk04                 ;                                                                  4583            subwf   tastennummer,W         ;
 4504            incf   stemp,F                 ;    2 Taste 2                                                     4584            bz      svfox405               ;
 4505            movlw  .6                      ;       ? max erreicht                                             4585   svfox402:                               ;
 4506            subwf  stemp,W                 ;                                                                  4586            movlw   .3                     ;
 4507            bnz    sddsk031                ;                                                                  4587            subwf   tastennummer,W         ;
 4508            movlw  .1                      ;       1 wieder mit min beginnen                                  4588            bnz     svfox403               ;
 4509            movwf  stemp                   ;                                                                  4589            bsf     ergebnis,7             ;
 4510   sddsk031:                               ;                                                                  4590            bra     svfox404               ;
 4511            bra    sddsk98                 ;                                                                  4591   svfox403:                               ;
 4512   sddsk04:                                ;                                                                  4592            movlw   .4                     ;
 4513            movlw  .3                      ;                                                                  4593            subwf   tastennummer,W         ;
 4514            subwf  tastennummer,W          ;                                                                  4594            bnz     svfox405               ;
 4515            bnz    sddsk05                 ;                                                                  4595            bcf     ergebnis,7             ;
 4516            bra    sddsk99X                ;    3 Taste 3 Cancel                                              4596   svfox404:                               ;
 4517   sddsk05:                                ;                                                                  4597            bra     writeflag              ;
 4518            movlw  .4                      ;                                                                  4598   svfox405:                               ;
 4519            subwf  tastennummer,W          ;                                                                  4599            return                         ;
 4520            bnz    sddsk06                 ;                                                                  4600   ;..............................................................................
 4521            bra    sddsk99ok               ;    4 Taste 4 OK                                                  4601   sbandmode:                              ;
 4522   sddsk06:                                ;                                                                  4602            LCDStrp qtext19                ;"Band/Mode aktiv "
 4523   sddsk98:                                ;                                                                  4603            rcall   readflag               ;
 4524            call   Tastegedrueckt          ; SCHLEIFE(2)                                                      4604   sbma01:                         ;
 4525            bc     sddsk98                 ; ENDE(2) Taste nicht mehr gedrueckt                               4605            call    Tastegedrueckt         ;
 4526            bra    sddsk00                 ;ENDE(3) Taste X oder OK                                           4606            bnc     sbma01                 ;
 4527   sddsk99X:                               ;                                                                  4607            call    Tastaturstatus         ;
 4528            movff  mddskonst,ddskonst      ;Cancel                                                            4608            movlw   .1                     ;
 4529            movff  mddskonst+1,ddskonst+1 ;DDSKonstande alt zurueckkopieren                                   4609            subwf   tastennummer,W         ;
 4530            movff  mddskonst+2,ddskonst+2 ;                                                                   4610            bz      sbm05                  ;
 4531            movff  mddskonst+3,ddskonst+3 ;                                                                   4611   sbm01:                                  ;
 4532            movff  mddskonst+4,ddskonst+4 ;                                                                   4612            movlw   .2                     ;
 4533            return                         ;                                                                  4613            subwf   tastennummer,W         ;
 4534   sddsk99ok:                              ;OK                                                                4614            bz      sbm05                  ;
 4535            movlw  addrddskonst            ;Adresse im Eeprom                                                 4615   sbm02:                                  ;
 4536            movwf  data_ee_addr            ;Vorbereiten zum Eepromlesen adr festlegen                         4616            movlw   .3                     ;
 4537            lfsr   0,ddskonst              ;Adresse im RAM                                                    4617            subwf   tastennummer,W         ;
 4538            MOVLF  5,schleife              ;2 Byte schreiben                                                  4618            bnz     sbm03                  ;
 4539            goto   lewrite                 ;ModeA + ModeB schreiben                                           4619            bsf     ergebnis,6             ;
 4540   ;..............................................................................                            4620            bra     sbm04                  ;
 4541   sminuszf:                               ;                                                                  4621   sbm03:                                  ;
 4542           LCDStrp qtext1                  ;"X   X     on off"                                                4622            movlw   .4                     ;
 4543           LCDStrp qtext11                 ;"VFO = RXfrq − ZF"                                                4623            subwf   tastennummer,W         ;
 4544   smzfa01:                                ;                                                                  4624            bnz     sbm05                  ;
 4545           call    Tastegedrueckt          ;                                                                  4625            bcf     ergebnis,6             ;
 4546           bnc     smzfa01                 ;                                                                  4626   sbm04:                                  ;
 4547           call    Tastaturstatus          ;                                                                  4627            bra     writeflag              ;
 4548           movlw   .1                      ;                                                                  4628   sbm05:                                  ;
 4549           subwf   tastennummer,W          ;                                                                  4629            return                         ;
 4550           bz      smzf05                  ;                                                                  4630   ;..............................................................................
 4551   smzf01:                                 ;                                                                  4631   skey:                                   ;
 4552           movlw   .2                      ;                                                                  4632           LCDStrp qtext7                  ;"Keyer           "
 4553           subwf   tastennummer,W          ;                                                                  4633           rcall    readflag               ;
 4554           bz      smzf05                  ;                                                                  4634   skeya01:                                ;
 4555   smzf02:                                 ;                                                                  4635           call     Tastegedrueckt         ;

Dienstag November 10, 2009                                                                                mc.pic                                                                                                   29/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 59/79            Nov 10, 09 8:32                                   mc.pic                                  Page 60/79
 4636           bnc     skeya01                 ;                                                               4716            bnz     slauto04               ;
 4637           call    Tastaturstatus          ;                                                               4717            bcf     ergebnis,2             ;
 4638           movlw   .1                      ;                                                               4718            bcf     ergebnis,1             ;
 4639           subwf   tastennummer,W          ;                                                               4719   slauto04:                               ;
 4640           bz      skey05                  ;                                                               4720            bra     writeflag              ;
 4641   skey01:                                 ;                                                               4721   slauto05:                               ;
 4642            movlw  .2                      ;                                                               4722            return                         ;
 4643            subwf  tastennummer,W          ;                                                               4723   ;...............................................................................
 4644            bz     skey05                  ;                                                               4724   slight:                                 ;
 4645   skey02:                                 ;                                                               4725            LCDStrp qtext3                 ;"Licht           "
 4646            movlw  .3                      ;                                                               4726            rcall   readflag               ;
 4647            subwf  tastennummer,W          ;                                                               4727   slight01:                               ;
 4648            bnz    skey03                  ;                                                               4728            call    Tastegedrueckt         ;
 4649            bsf    ergebnis,4              ;                                                               4729            bnc     slight01               ;
 4650            bra    skey04                  ;                                                               4730            call    quittungston           ; 1 Quittungston ausgeben
 4651   skey03:                                 ;                                                               4731            call    Tastaturstatus         ;
 4652            movlw  .4                      ;                                                               4732            movlw   .1                     ;
 4653            subwf  tastennummer,W          ;                                                               4733            subwf   tastennummer,W         ;
 4654            bnz    skey05                  ;                                                               4734            bz      slight06               ;
 4655            bcf    ergebnis,4              ;                                                               4735   slight02:                               ;
 4656   skey04:                                 ;                                                               4736            movlw   .2                     ;
 4657            bra    writeflag               ;                                                               4737            subwf   tastennummer,W         ;
 4658   skey05:                                 ;                                                               4738            bz      slight06               ;
 4659            return                         ;                                                               4739   slight03:                               ;
 4660   ;..............................................................................                         4740            movlw   .3                     ;
 4661   s1hz:                                   ;                                                               4741            subwf   tastennummer,W         ;
 4662           LCDStrp qtext5                  ;"1 Hz Aufloesung "                                             4742            bnz     slight04               ;
 4663           rcall   readflag                ;                                                               4743            bsf     ergebnis,1             ;
 4664   s1hza01:                                ;                                                               4744            bcf     ergebnis,2             ;
 4665           call    Tastegedrueckt          ;                                                               4745            bsf     a_licht                ;
 4666           bnc     s1hza01                 ;                                                               4746            bra     slight05               ;
 4667           call    Tastaturstatus          ;                                                               4747   slight04:                               ;
 4668           movlw   .1                      ;                                                               4748            movlw   .4                     ;
 4669           subwf   tastennummer,W          ;                                                               4749            subwf   tastennummer,W         ;
 4670           bz      s1hz05                  ;                                                               4750            bnz     slight06               ;
 4671   s1hz01:                                 ;                                                               4751            bcf     ergebnis,1             ;
 4672           movlw   .2                      ;                                                               4752            bcf     ergebnis,2             ;
 4673           subwf   tastennummer,W          ;                                                               4753   slight05:                               ;
 4674           bz      s1hz05                  ;                                                               4754            bra     writeflag              ;
 4675   s1hz02:                                 ;                                                               4755   slight06:                               ;
 4676           movlw   .3                      ;                                                               4756           return                          ;
 4677           subwf   tastennummer,W          ;                                                               4757   ;...............................................................................
 4678           bnz     s1hz03                  ;                                                               4758   readflag:
 4679           bsf     ergebnis,3              ;                                                               4759           MOVLF    addrflag,data_ee_addr  ;
 4680           bra     s1hz04                  ;                                                               4760           call     eread                  ;
 4681   s1hz03:                                 ;                                                               4761           movff    data_ee_data,ergebnis  ;
 4682           movlw   .4                      ;                                                               4762   ;        call    LCDDisplayClear
 4683           subwf   tastennummer,W          ;                                                               4763   ;        movf    data_ee_data,W
 4684           bnz     s1hz04                  ;                                                               4764   ;        call    LCDHEX
 4685           bcf     ergebnis,3              ;                                                               4765   ;        call    t5Sek
 4686   s1hz04:                                 ;                                                               4766           LCDStrp qtext1                  ;"X   X    on off"
 4687           bra     writeflag               ;                                                               4767           return
 4688   s1hz05:                                 ;                                                               4768   ;...............................................................................
 4689           return                          ;                                                               4769   writeflag:
 4690   ;..............................................................................                         4770           movff    ergebnis,data_ee_data  ;
 4691   slightauto:                             ;                                                               4771           MOVLF    addrflag,data_ee_addr  ;
 4692           LCDStrp qtext2                  ;"Lichtautomatik "                                              4772   ;        call    LCDDisplayClear
 4693           rcall   readflag                ;                                                               4773   ;        movf    data_ee_data,W
 4694   slightauto01:                           ;                                                               4774   ;        call    LCDHEX
 4695           call    Tastegedrueckt          ;                                                               4775   ;        call    t5Sek
 4696           bnc     slightauto01            ;                                                               4776           goto     ewrite                 ;
 4697           call    quittungston            ;1 Quittungston ausgeben                                        4777   ;...............................................................................
 4698           call    Tastaturstatus          ;                                                               4778   csmeter:                                ;
 4699           movlw   .1                      ;                                                               4779           LCDStrp qtext4                  ;"S−Meter         "
 4700           subwf   tastennummer,W          ;                                                               4780           rcall    readflag               ;
 4701           bz      slauto05                ;                                                               4781   csmeter01:                              ;
 4702   slauto01:                               ;                                                               4782           call     Tastegedrueckt         ;
 4703           movlw   .2                      ;                                                               4783           bnc      csmeter01              ;
 4704           subwf   tastennummer,W          ;                                                               4784           call     quittungston           ;1 Quittungston ausgeben
 4705           bz      slauto05                ;                                                               4785           call     Tastaturstatus         ;
 4706   slauto02:                               ;                                                               4786           movlw    .1                     ;
 4707           movlw   .3                      ;                                                               4787           subwf    tastennummer,W         ;
 4708           subwf   tastennummer,W          ;                                                               4788           bz       csmeter06              ;
 4709           bnz     slauto03                ;                                                               4789   csmeter02:                              ;
 4710           bsf     ergebnis,2              ;                                                               4790           movlw    .2                     ;
 4711           bcf     ergebnis,1              ;                                                               4791           subwf    tastennummer,W         ;
 4712           bra     slauto04                ;                                                               4792           bz       csmeter06              ;
 4713   slauto03:                               ;                                                               4793   csmeter03:                              ;
 4714           movlw   .4                      ;                                                               4794           movlw    .3                     ;
 4715           subwf   tastennummer,W          ;                                                               4795           subwf    tastennummer,W         ;

Dienstag November 10, 2009                                                                             mc.pic                                                                                                    30/40
                                                                                                                                                                                                Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                  Page 61/79            Nov 10, 09 8:32                                     mc.pic                          Page 62/79
 4796            bnz     csmeter04               ;                                                               4876           LCDStr   tmhz                    ;MHz dahinter
 4797            bsf     ergebnis,0              ;                                                               4877   strans00:                                ;SCHLEIFE(3)
 4798            bra     csmeter05               ;                                                               4878           clrf     WREG                    ;
 4799   csmeter04:                               ;                                                               4879           call     LCDPos                  ; Pos 0 in LCD
 4800            movlw   .4                      ;                                                               4880           movff    mddskonst,faktor1       ; in Operator
 4801            subwf   tastennummer,W          ;                                                               4881           movff    mddskonst+1,faktor1+1   ; kopieren
 4802            bnz     csmeter06               ;                                                               4882           movff    mddskonst+2,faktor1+2   ;
 4803            bcf     ergebnis,0              ;                                                               4883           movff    mddskonst+3,faktor1+3   ;
 4804   csmeter05:                               ;                                                               4884           movff    mddskonst+4,faktor1+4   ;
 4805            bra     writeflag               ;                                                               4885           call     hex2bcd5b               ; in BCD wandeln
 4806   csmeter06:                               ;                                                               4886           call     bcd2char6b              ; in Char wandeln
 4807            return                          ;                                                               4887           MOVLF    .11,laenge              ; printf Ausgabe
 4808   ;...............................................................................                         4888           MOVLF    .6,komma                ;
 4809   ctxzf:                                   ;                                                               4889           movff    stemp,kuerzen           ;
 4810            LCDStrp qtext8                  ;"TX ZF permanent "                                             4890           call     printf                  ;
 4811            rcall   readflag                ;                                                               4891   strans001:                               ;
 4812   ctxzf01:                                 ;                                                               4892           movf     impulse,F               ; ? Impulse angefallen
 4813            call    Tastegedrueckt          ;                                                               4893           bnz      strans002               ;
 4814            bnc     ctxzf01                 ;                                                               4894           bra      strans022               ;
 4815            call    quittungston            ;1 Quittungston ausgeben                                        4895   strans002:                               ; 1
 4816            call    Tastaturstatus          ;                                                               4896           CLR5     stemp1                  ;    loeschen des Operators
 4817            movlw   .1                      ;                                                               4897           btfsc    impulse,7               ;    ? positive Drehrichtung
 4818            subwf   tastennummer,W          ;                                                               4898           bra      strans023               ;
 4819            bz      ctxzf06                 ;                                                               4899           movf     stemp,F                 ;    1 ? Anzahl der Stellen
 4820   ctxzf02:                                 ;                                                               4900           bnz      strans024               ;      10 Stellen aendern
 4821            movlw   .2                      ;                                                               4901           INC5     mddskonst               ;
 4822            subwf   tastennummer,W          ;                                                               4902           bra      strans0225              ;
 4823            bz      ctxzf06                 ;                                                               4903   strans024:                               ;
 4824   ctxzf03:                                 ;                                                               4904           movlw    .2                      ;      8 Stellen aendern
 4825            movlw   .3                      ;                                                               4905           subwf    stemp,W                 ;
 4826            subwf   tastennummer,W          ;                                                               4906           bnz      strans025               ;
 4827            bnz     ctxzf04                 ;                                                               4907           MOVLF    .100,stemp1             ;      100 addieren
 4828            bsf     ergebnis,5              ;                                                               4908           ADD5     mddskonst,stemp1        ;
 4829            bra     ctxzf05                 ;                                                               4909           bra      strans0225              ;
 4830   ctxzf04:                                 ;                                                               4910   strans025:                               ;
 4831           movlw    .4                      ;                                                               4911           movlw    .4                      ;      6 Stellen aendern
 4832           subwf    tastennummer,W          ;                                                               4912           subwf    stemp,W                 ;
 4833           bnz      ctxzf06                 ;                                                               4913           bnz      strans026               ;      10 000 addieren
 4834           bcf      ergebnis,5              ;                                                               4914           MOVLF    0x10,stemp1             ;
 4835   ctxzf05:                                                                                                 4915           MOVLF    0x27,stemp1+1           ;
 4836           bra      writeflag               ;                                                               4916           ADD5     mddskonst,stemp1        ;
 4837   ctxzf06:                                 ;                                                               4917           bra      strans0225              ;
 4838           return                           ;                                                               4918   strans026:                               ;
 4839   ;...............................................................................                         4919           movlw    .6                      ;      4 Stellen aendern
 4840   stransverter:                                                                                            4920           subwf    stemp,W                 ;
 4841           LCDStrp qtext9                   ;"Displayshift=0 "                                              4921           bnz      strans027               ;
 4842           LCDStrp qtext10                  ;"ok           next"                                            4922           MOVLF    0x40,stemp1             ;      1 000 000 addieren
 4843   str01:                                   ;SCHLEIFE(1,3)                                                  4923           MOVLF    0x42,stemp1+1           ;
 4844           call     Tastegedrueckt          ;                                                               4924           MOVLF    0x0f,stemp1+2           ;
 4845           bnc      str01                   ; ENDE(1) Taste gedrueckt                                       4925           ADD5     mddskonst,stemp1        ;
 4846           call     Tastaturstatus          ; Abfrage der Taste                                             4926           bra      strans0225              ;
 4847           movlw    4                       ; ? Taste 4                                                     4927   strans027:                               ;
 4848           subwf    tastennummer,W          ;                                                               4928           movlw    .8                      ;      2 Stellen aendern
 4849           bz       str02                   ; 1 −−−> weiter                                                 4929           subwf    stemp,W                 ;
 4850           movlw    1                       ; ? Taste 1                                                     4930           bnz      strans028               ;
 4851           subwf    tastennummer,W          ;                                                               4931           MOVLF    0xe1,stemp1+1           ;      100 000 000 addieren
 4852           bnz      str03                   ;                                                               4932           MOVLF    0xf5,stemp1+2           ;
 4853           CLR5     lcdoffset               ; 1 loeschen vom LCD offset                                     4933           MOVLF    0x05,stemp1+3           ;
 4854           bra      strans99null            ;    −−−> break zum Speichern                                   4934           ADD5     mddskonst,stemp1        ;
 4855   str03:                                   ; SCHLEIFE(2)                                                   4935           bra      strans0225              ;
 4856           call     Tastegedrueckt          ;                                                               4936   strans028:                               ;
 4857           bc       str03                   ; ENDE(2) keine Taste gedrueckt                                 4937   strans023:                               ; 0 negative Drehrichtung
 4858           bra      str01                   ;ENDE(3) ewige Schleife                                         4938           movf     stemp,F                 ;    ? Stellen
 4859   str02:                                                                                                   4939           bnz      strans0221              ;
 4860           call     Tastegedrueckt          ;                                                               4940           DEC5     mddskonst               ;    10 Stellen aendern
 4861           bc       str02                   ;                                                               4941           bra      strans0225              ;
 4862   stransonst                                                                                               4942   strans0221:                              ;
 4863           bcf      bvfo                    ;FrequenzA einstellen                                           4943           movlw    .2                      ;    8 Stellen aendern
 4864           clrf     impulse                 ;                                                               4944           subwf    stemp,W                 ;
 4865           movff    lcdoffset,mddskonst     ;LCDoffset Konstande                                            4945           bnz      strans0222              ;
 4866           movff    lcdoffset+1,mddskonst+1 ;kopieren                                                       4946           MOVLF    .100,stemp1             ;    100 subtrahieren
 4867           movff    lcdoffset+2,mddskonst+2 ;                                                               4947           SUB5     mddskonst,stemp1        ;
 4868           movff    lcdoffset+3,mddskonst+3 ;                                                               4948           bra      strans0225              ;
 4869           movff    lcdoffset+4,mddskonst+4 ;                                                               4949   strans0222:
 4870           ADD5     mddskonst,frequenza     ;                                                               4950           movlw    .4                      ;   6 Stellen aendern
 4871           call     LCDDisplayClear         ;LCD loeschen                                                   4951           subwf    stemp,W                 ;
 4872           LCDStrp qtext6                   ;"<   >    X     ok"                                            4952           bnz      strans0223              ;
 4873           movlw    .0                      ;zuordnen                                                       4953           MOVLF    0x10,stemp1             ;   10 000 subtrahieren
 4874           movwf    stemp                   ;Stellenlaenge = 6                                              4954           MOVLF    0x27,stemp1+1           ;
 4875           rcall    z1clr                   ;Zeile1 loeschen                                                4955           SUB5     mddskonst,stemp1        ;

Dienstag November 10, 2009                                                                              mc.pic                                                                                              31/40
                                                                                                                                                                                                       Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                    Page 63/79            Nov 10, 09 8:32                                   mc.pic                                  Page 64/79
 4956           bra     strans0225              ;                                                                  5036   ddstypemax      equ     .6
 4957   strans0223:                                                                                                5037
 4958           movlw   .6                      ;    4 Stellen aendern                                             5038   sddstype:                                ;
 4959           subwf   stemp,W                 ;                                                                  5039            call    Tastegedrueckt          ;
 4960           bnz     strans0224              ;                                                                  5040            bc      sddstype                ;
 4961           MOVLF   0x40,stemp1             ;    1 000 000 subtrahieren                                        5041            LCDStrp qtext6                  ;"<   >    X    ok"
 4962           MOVLF   0x42,stemp1+1           ;                                                                  5042            rcall   typlcd                  ;DDS−Type anzeigen
 4963           MOVLF   0x0f,stemp1+2           ;                                                                  5043   sddst00:
 4964           SUB5    mddskonst,stemp1        ;                                                                  5044            call    Tastegedrueckt          ;
 4965           bra     strans0225              ;                                                                  5045            bc      sddst00                 ;
 4966   strans0224:                             ;                                                                  5046   sddst01:                                 ;
 4967           movlw   .8                      ;    2 Stellen aendern                                             5047            call    Tastegedrueckt          ;
 4968           subwf   stemp,W                 ;                                                                  5048            bnc     sddst01                 ;
 4969           bnz     strans0225              ;                                                                  5049            call    quittungston            ;1 Quittungston ausgeben
 4970           MOVLF   0xe1,stemp1+1           ;    100 000 000 subtrahieren                                      5050            call    Tastaturstatus          ;
 4971           MOVLF   0xf5,stemp1+2           ;                                                                  5051            movlw   .1                      ;
 4972           MOVLF   0x05,stemp1+3           ;                                                                  5052            subwf   tastennummer,W          ;
 4973           SUB5    mddskonst,stemp1        ;                                                                  5053            bnz     sddst02                 ;
 4974   strans0225:                                                                                                5054            incf    ddstype,F               ;
 4975           clrf    impulse                 ;    01Impulse loeschen                                            5055            movlw   ddstypemax+1            ;
 4976           bra     strans00                        ;                                                          5056            subwf   ddstype,W               ;
 4977   strans022:                              ;                                                                  5057            bnz     sddst011                        ;
 4978           call    Tastegedrueckt          ; ? Taste gedrueckt                                                5058            clrf    ddstype                 ;
 4979           bc      strans0231              ;                                                                  5059   sddst011:                                ;
 4980           bra     strans001                       ;                                                          5060            bra     sddstype                ;
 4981   strans0231:                                                                                                5061   sddst02:                                 ;
 4982           call    quittungston            ; 1 Quittungston ausgeben                                          5062            movlw   .2                      ;
 4983           call    Tastaturstatus          ;    ? Welche Taste                                                5063            subwf   tastennummer,W          ;
 4984           movlw   .1                      ;                                                                  5064            bnz     sddst03                 ;
 4985           subwf   tastennummer,W          ;                                                                  5065            decf    ddstype,F               ;
 4986           bnz     strans03                        ;                                                          5066            incf    ddstype,W               ;
 4987           incf    stemp,F                 ;    1 Taste 1                                                     5067            bnz     sddst021                        ;
 4988           incf    stemp,F                 ;                                                                  5068            MOVLF   ddstypemax,ddstype      ;
 4989           movlw   .10                     ;                                                                  5069   sddst021:                                ;
 4990           subwf   stemp,W                 ;      ? min erreicht                                              5070            bra     sddstype                ;
 4991           bnz     strans021                       ;                                                          5071   sddst03:                                 ;
 4992           clrf    stemp                   ;      1 wieder mit 0 laden                                        5072            movlw   .3                      ;
 4993   strans021:                              ;                                                                  5073            subwf   tastennummer,W          ;
 4994           bra     strans98                ;                                                                  5074            bnz     sddst04                 ;
 4995   strans03:                               ;                                                                  5075            bra     sddst06                 ;
 4996           movlw   .2                      ;                                                                  5076   sddst04:                                 ;
 4997           subwf   tastennummer,W          ;                                                                  5077           movlw    .4                      ;
 4998           bnz     strans04                ;                                                                  5078           subwf    tastennummer,W          ;
 4999           decf    stemp,F                 ;    2 Taste 2                                                     5079           bnz      sddst06                 ;
 5000           decf    stemp,F                 ;                                                                  5080            MOVLF   addrddstype,data_ee_addr;
 5001           btfss   stemp,7                 ;      ? min erreicht Ueberlauf unter null                         5081            movff   ddstype,data_ee_data    ;
 5002           bra     strans031               ;                                                                  5082            goto    ewrite                  ;
 5003           movlw   .8                      ;      1 wieder max einstellen                                     5083   sddst06:                                 ;
 5004           movwf   stemp                   ;                                                                  5084           return
 5005   strans031:                              ;                                                                  5085   ;...............................................................................
 5006           bra     strans06                ;                                                                  5086   typlcd:
 5007   strans04:                               ;                                                                  5087           movf     ddstype,F
 5008           movlw   .3                      ;                                                                  5088           bnz      type01
 5009           subwf   tastennummer,W          ;                                                                  5089           LCDStrp tlcd01
 5010           bnz     strans05                ;                                                                  5090           bra      type99
 5011           bra     strans99X               ;    3 Taste 3 Cancel                                              5091   type01:
 5012   strans05:                               ;                                                                  5092           movlw    .1
 5013           movlw   .4                      ;                                                                  5093           subwf    ddstype,W
 5014           subwf   tastennummer,W          ;                                                                  5094           bnz      type02
 5015           bnz     strans06                ;                                                                  5095           LCDStrp tlcd02
 5016           bra     strans99ok              ;    4 Taste 4 OK                                                  5096           bra      type99
 5017   strans06:                               ;                                                                  5097   type02:
 5018           rcall   z1clr                   ; Zeile1 loeschen                                                  5098           movlw    .2
 5019           LCDStr tmhz                     ; MHz dahinter                                                     5099           subwf    ddstype,W
 5020   strans98:                               ;                                                                  5100           bnz      type03
 5021           call    Tastegedrueckt          ; SCHLEIFE(2)                                                      5101           LCDStrp tlcd03
 5022           bc      strans98                ; ENDE(2) Taste nicht mehr gedrueckt                               5102           bra      type99
 5023           bra     strans00                ;ENDE(3) Taste X oder OK                                           5103   type03:
 5024   strans99X:                                                                                                 5104           movlw    .3
 5025           return                          ;X                                                                 5105           subwf    ddstype,W
 5026   strans99ok:                             ;OK                                                                5106           bnz      type04
 5027           SUB5    mddskonst,frequenza     ;Frequenz wieder subtrahieren                                      5107           LCDStrp tlcd04
 5028           movff   mddskonst,lcdoffset     ;neuer Wert wird in                                                5108           bra      type99
 5029           movff   mddskonst+1,lcdoffset+1 ;LCDoffset                                                         5109   type04:
 5030           movff   mddskonst+2,lcdoffset+2 ;gespeichert                                                       5110           movlw    .4
 5031           movff   mddskonst+3,lcdoffset+3 ;                                                                  5111           subwf    ddstype,W
 5032           movff   mddskonst+4,lcdoffset+4 ;                                                                  5112           bnz      type05
 5033   strans99null:                           ;Einsprung fuer nur abspeichern                                    5113           LCDStrp tlcd05
 5034           goto    ebandwrite              ;Banddaten speichern                                               5114           bra      type99
 5035   ;...............................................................................                           5115   type05:

Dienstag November 10, 2009                                                                                mc.pic                                                                                                    32/40
                                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                 Page 65/79            Nov 10, 09 8:32                                   mc.pic                                 Page 66/79
 5116             movlw     .5                                                                                  5196            call    mtausrechnen           ;
 5117             subwf     ddstype,W                                                                           5197            LCDStrp qtext21                ;"SPOT= "
 5118             bnz       type06                                                                              5198            CLR4    faktor1+1              ;
 5119             LCDStrp   tlcd06                                                                              5199            movff   mithoerton,faktor1     ;
 5120             bra       type99                                                                              5200            call    hex2bcd5b              ;
 5121   type06:                                                                                                 5201            movf    ergebnis,W             ;
 5122             movlw     .6                                                                                  5202            call    LCDHEX                 ;
 5123             subwf     ddstype,W                                                                           5203            movlw   ’0’                    ;
 5124             bnz       type07                                                                              5204            call    LCDChar                ;
 5125             LCDStrp   tlcd07                                                                              5205            LCDStr qtext22                 ;
 5126   type07:                                                                                                 5206   sspot02:                                ;
 5127   type99:                                                                                                 5207            call    Tastegedrueckt         ;
 5128           CLR5    faktor1                 ;                                                               5208            bnc     sspot06                ;
 5129           movff   ddstype,faktor1         ;                                                               5209            call    quittungston           ;1 Quittungston ausgeben
 5130           call    hex2bcd5b               ; in BCD wandeln                                                5210            call    Tastaturstatus         ;
 5131           call    bcd2char6b              ; in Char wandeln                                               5211            movlw   .4                     ;
 5132           MOVLF   .2,laenge               ; printf Ausgabe                                                5212            subwf   tastennummer,W         ;
 5133           MOVLF   .0,komma                ;                                                               5213            bnz     sspot03                ;
 5134           MOVLF   .0,kuerzen              ;                                                               5214            return                         ;
 5135           goto    printf                  ;                                                               5215   sspot03:                                ;
 5136   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         5216            movlw   .1                     ;
 5137   stxhang:                                                                                                5217            subwf   tastennummer,W         ;
 5138           LCDStrp qtext12                 ;"ok        cancel"                                             5218            bz      sspot05                ;
 5139   stxhang01:                                                                                              5219   sspot06:                                ;
 5140           LCDStrp qtext29                 ;"TXhang= "                                                     5220            movf    impulse,F              ;
 5141           call    math_ramclr             ;                                                               5221            bz      sspot02                ;
 5142           movff   stimer,faktor1          ;                                                               5222            btfsc   impulse,7              ;
 5143           MOVLF   .5,faktor2              ;                                                               5223            bra     sspot08                ;
 5144           call    mul5b                   ;                                                               5224            btfss   impulse,4              ;
 5145           call    ergebnis2faktor1_5b     ;                                                               5225            bra     sspot02                ;
 5146           call    hex2bcd5b               ;                                                               5226            incf    mithoerton,F           ;
 5147           call    bcd2char6b              ; in Char wandeln                                               5227            clrf    impulse                ;
 5148           MOVLF   .4,laenge               ; printf Ausgabe                                                5228            bra     sspot01                ;
 5149           MOVLF   .0,komma                ;                                                               5229   sspot08:                                ;
 5150           MOVLF   .0,kuerzen              ;                                                               5230            negf    impulse                ;
 5151           call    printf                  ;                                                               5231            btfss   impulse,4              ;
 5152           LCDStr qtext30                  ;                                                               5232            bra     sspot09                ;
 5153   stxhang02:                                                                                              5233            decf    mithoerton,F           ;
 5154           call    Tastegedrueckt          ;                                                               5234            clrf    impulse                ;
 5155           bnc     stxhang06               ;                                                               5235            bra     sspot01                ;
 5156           call    quittungston            ;1 Quittungston ausgeben                                        5236   sspot09:                                ;
 5157           call    Tastaturstatus          ;                                                               5237            negf    impulse                ;
 5158           movlw   .4                      ;                                                               5238            bra     sspot02                ;
 5159           subwf   tastennummer,W          ;                                                               5239   sspot05:                                ;
 5160           bnz     stxhang03               ;                                                               5240           call     writesicherung         ;
 5161           return                          ;                                                               5241   sspot07:                                ;
 5162   stxhang03:                              ;                                                               5242           return                          ;
 5163           movlw   .1                      ;                                                               5243   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 5164           subwf   tastennummer,W          ;                                                               5244   testanzeige:
 5165           bz      stxhang05               ;                                                               5245           LCDHEX2Z1        xsm     ;
 5166   stxhang06:                              ;                                                               5246           LCDHEX2Z2        ysm     ;
 5167           movf    impulse,F               ;                                                               5247           goto     t5Sek
 5168           bz      stxhang02               ;                                                               5248
 5169           btfsc   impulse,7               ;                                                               5249   eichanz:
 5170           bra     stxhang08               ;                                                               5250           movf    messh,W                 ;
 5171           btfss   impulse,4               ;                                                               5251           call    LCDHEX                  ;
 5172           bra     stxhang02               ;                                                               5252           movf    messl,W                 ;
 5173           incf    stimer,F                ;                                                               5253           goto    LCDHEX                  ;
 5174           clrf    impulse                 ;                                                               5254   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−
 5175           bra     stxhang01               ;                                                               5255   seichsmeter:
 5176   stxhang08:                              ;                                                               5256           LCDStrp qtext12                 ;"ok        cancel"
 5177           negf    impulse                 ;                                                               5257   seichsm01:
 5178           btfss   impulse,4               ;                                                               5258           LCDStrp qtext13                 ;"S0 = "
 5179           bra     stxhang09               ;                                                               5259           call    umesssmeter             ;Spannung messen
 5180           decf    stimer,F                ;                                                               5260           rcall   eichanz                 ;
 5181           clrf    impulse                 ;                                                               5261           call    t100mSek                ;
 5182           bra     stxhang01               ;                                                               5262           call    Tastegedrueckt          ;
 5183   stxhang09:                              ;                                                               5263           bnc     seichsm01               ;
 5184           negf    impulse                 ;                                                               5264           call    quittungston            ;1 Quittungston ausgeben
 5185           bra     stxhang02               ;                                                               5265           call    Tastaturstatus          ;
 5186   stxhang05:                              ;                                                               5266           movlw   .4                      ;
 5187           call    writesicherung          ;                                                               5267           subwf   tastennummer,W          ;
 5188   stxhang07:                              ;                                                               5268           bnz     seichsm02               ;
 5189           return                          ;                                                               5269           return                          ;
 5190                                                                                                           5270   seichsm02:
 5191   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                         5271           movlw   .1                      ;
 5192   sspot:                                                                                                  5272           subwf   tastennummer,W          ;
 5193           LCDStrp qtext12                 ;"ok        cancel"                                             5273           bz      seichsm03               ;
 5194   sspot01:                                                                                                5274           bra     seichsm01               ;
 5195           bsf     tonenable               ;                                                               5275   seichsm03:

Dienstag November 10, 2009                                                                             mc.pic                                                                                                   33/40
                                                                                                                                                                                                     Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                  Page 67/79            Nov 10, 09 8:32                                   mc.pic                                 Page 68/79
 5276           call    Tastegedrueckt          ;                                                                5356           call    Tastegedrueckt          ;
 5277           bc      seichsm03               ;                                                                5357           bnc     berechnen_xysm05        ;
 5278           movff   messl,xsm               ;                                                                5358           call    Tastaturstatus          ;
 5279           movff   messh,xsm+1             ;                                                                5359           movlw   .4                      ;
 5280   ;       rcall   testanzeige             ;                                                                5360           subwf   tastennummer,W          ;
 5281   seichsm04:                                                                                               5361           bnz     berechnen_xysm06        ;
 5282           LCDStrp qtext14                 ;"S9 = "                                                         5362           return                          ;
 5283           call    umesssmeter             ;Spannung messen                                                 5363   berechnen_xysm06:
 5284           rcall   eichanz                 ;                                                                5364           movlw   .1                      ;
 5285           call    t100mSek                ;                                                                5365           subwf   tastennummer,W          ;
 5286           call    Tastegedrueckt          ;                                                                5366           bz      berechnen_xysm07        ;
 5287           bnc     seichsm04               ;                                                                5367           bra     berechnen_xysm05        ;
 5288           call    quittungston            ;1 Quittungston ausgeben                                         5368   berechnen_xysm07:                       ;
 5289           call    Tastaturstatus          ;                                                                5369           goto    writesicherung          ;Sichern
 5290           movlw   .4                      ;                                                                5370   ;=========================================================================
 5291           subwf   tastennummer,W          ;                                                                5371   sendeeprom:
 5292           bnz     seichsm05               ;                                                                5372           LCDStrp qtext16                 ;"PIC −−−> PC TX "
 5293           return                          ;                                                                5373           LCDStrp qtext12                 ;"OK        Abruch"
 5294   seichsm05:                                                                                               5374   sendeeprom01:                           ;
 5295           movlw   .1                      ;                                                                5375           call    Tastegedrueckt          ;
 5296           subwf   tastennummer,W          ;                                                                5376           bnc     sendeeprom01            ;
 5297           bz      seichsm06               ;                                                                5377           call    quittungston            ;Quittungston ausgeben
 5298           bra     seichsm04               ;                                                                5378           call    Tastaturstatus          ;
 5299   seichsm06:                                                                                               5379           movlw   .4                      ;
 5300           call    Tastegedrueckt          ;                                                                5380           subwf   tastennummer,W          ;
 5301           bc      seichsm06               ;                                                                5381           bnz     sendeeprom02            ;
 5302           movff   messl,ysm               ;                                                                5382           return                          ;
 5303           movff   messh,ysm+1             ;                                                                5383   sendeeprom02:                           ;
 5304   ;       rcall   testanzeige             ;                                                                5384           call    Tastaturstatus          ;
 5305   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                          5385           movlw   .1                      ;
 5306   berechnen_xysm:                                                                                          5386           subwf   tastennummer,W          ;
 5307           call    math_ramclr             ;operanten loeschen                                              5387           bz      sendeeprom03            ;
 5308           movff   ysm,minuend             ;messungS0 holen                                                 5388           bra     sendeeprom              ;
 5309           movff   ysm+1,minuend+1         ;                                                                5389   sendeeprom03:                           ;
 5310           movff   xsm,subtrahend          ;messungS9 holen                                                 5390           call    LCDDisplayClear         ;
 5311           movff   xsm+1,subtrahend+1      ;                                                                5391           LCDStrp qtext16                 ;"PIC −−−> PC TX "
 5312           SUB5    subtrahend,minuend      ;messungS9 = messungS0 − messungS9                               5392           bcf     INTCON,GIE              ;Interrups sperren
 5313           nop                                                                                              5393           bsf     bintsperren             ;Interrupt dauerhaft sperren
 5314           CLR5    minuend                 ;Operant loeschen                                                5394           clrf    schleife+2              ;
 5315           nop                                                                                              5395           clrf    data_ee_addr            ;
 5316           MOVLF   D’20’,minuend+3         ;                                                                5396   sendeeprom04:                           ;
 5317           nop                                                                                              5397           movlw   0x40                    ;
 5318           NEG5    minuend                 ;ergebnis = (−20 * 2 hoch 16)/(messS0 − messS9)                  5398           call    LCDPos                  ;
 5319           call    div5b                   ;                                                                5399           movf    data_ee_addr,W          ;
 5320           btfsc   ergebnis+4,7            ;? ist das ergebnis negativ                                      5400           call    LCDHEX                  ;
 5321           bra     berechnen_xysm02        ;                                                                5401           call    eread                   ;
 5322           btfss   ergebnis,7              ;0 ? Aufrunden                                                   5402           call    rs232tx                 ;
 5323           bra     berechnen_xysm01        ;                                                                5403           call    t10mSek         ;
 5324           INC2    ergebnis+1              ; 1 um eins aufrunden                                            5404           incf    data_ee_addr,F          ;
 5325           bra     berechnen_xysm01        ;                                                                5405           decfsz schleife+2,F             ;
 5326   berechnen_xysm02:                                                                                        5406           bra     sendeeprom04            ;
 5327           btfsc   ergebnis,7              ;1 ? Aufrunden                                                   5407           LCDStrp qtext17                 ;"finished!       "
 5328           bra     berechnen_xysm01        ;                                                                5408           call    t5Sek                   ;
 5329           DEC2    ergebnis+1              ; 1 um eins aufrunden im negativ Bereich                         5409   sendeeprom05:                           ;
 5330   berechnen_xysm01:                                                                                        5410           call    Tastegedrueckt          ;
 5331           movff   ergebnis+1,ysm          ;Ergebnis abspeichern ist gleich X−Wert                          5411           bc      sendeeprom05            ;
 5332           movff   ergebnis+2,ysm+1        ;                                                                5412           return                          ;
 5333           call    math_ramclr             ;operanten loeschen                                              5413   ;=========================================================================
 5334           call    xsmladen                ;messungS9 holen in faktor2                                      5414   ee2flash:
 5335           CLR5    faktor1                 ;op faktor1 loeschen                                             5415           LCDStrp qtext23                 ;"Eeprom −−> Flash"
 5336           movff   ysm,faktor1             ;X−Wert ist faktor1                                              5416           LCDStrp qtext12                 ;"OK        Abruch"
 5337           movff   ysm+1,faktor1+1         ;                                                                5417   ee2flash01:                             ;
 5338           btfss   ysm+1,7                 ;? ist X−Wert negativ                                            5418           call    Tastegedrueckt          ;
 5339           bra     berechnen_xysm03        ;                                                                5419           bnc     ee2flash01              ;
 5340           comf    faktor1+2,F             ;1 die freien Stellen auch noch negieren                         5420           call    quittungston            ;Quittungston ausgeben
 5341           comf    faktor1+3,F             ; so das der Operant 5 stellig richtig                           5421           call    Tastaturstatus          ;
 5342           comf    faktor1+4,F             ; ist                                                            5422           movlw   .4                      ;
 5343   berechnen_xysm03:                       ;                                                                5423           subwf   tastennummer,W          ;
 5344           call    mul5b                   ;ergebnis = X−Wert * messungS9                                   5424           bnz     ee2flash02              ;
 5345           btfss   ergebnis+1,7            ;? eventuell aufrunden                                           5425           return                          ;
 5346           bra     berechnen_xysm04        ;                                                                5426   ee2flash02:                             ;
 5347           INC2    ergebnis+2              ;                                                                5427   ;........................................
 5348   berechnen_xysm04:                                                                                        5428           call    Tastaturstatus          ;
 5349           movff   ysm,xsm                 ;X−Wert an die richtige Stelle kopieren                          5429           movlw   .1                      ;
 5350           movff   ysm+1,xsm+1             ;                                                                5430           subwf   tastennummer,W          ;
 5351           movff   ergebnis+2,ysm          ;Y−Wert an die richtige Stelle kopieren                          5431           bz      ee2flash03              ;
 5352           movff   ergebnis+3,ysm+1        ;                                                                5432           bra     ee2flash                ;
 5353           NEG2    ysm                     ;Y−Wert muss negativ sein                                        5433   ;........................................
 5354           LCDStrp qtext15                 ;"Save?           "                                              5434   ee2flash03:                             ;
 5355   berechnen_xysm05:                       ;                                                                5435           call    Tastegedrueckt          ;

Dienstag November 10, 2009                                                                              mc.pic                                                                                                   34/40
                                                                                                                                                                                                     Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                  Page 69/79            Nov 10, 09 8:32                                   mc.pic                                 Page 70/79
 5436           bc      ee2flash03              ;                                                                5516           movlw   0xaa                    ;
 5437   ;........................................                                                                5517           movwf   EECON2                  ;
 5438           LCDStrp qtext24                 ;"Speicherplatz    "                                             5518           bsf     EECON1,WR               ;Schreibstart
 5439           LCDStrp qtext25                 ;"1    2     3   4"                                              5519           nop                             ;
 5440   ee2flash04:                             ;                                                                5520           TBLRD*+                         ;
 5441           call    Tastegedrueckt          ;                                                                5521           decfsz PRODL,F                  ;
 5442           bnc     ee2flash04              ;                                                                5522           bra     flwrite02               ;
 5443   ;........................................                                                                5523           return                          ;
 5444           call    quittungston            ;Quittungston ausgeben                                           5524   ;=========================================================================
 5445           call    Tastaturstatus          ;                                                                5525   flash2ee:                               ;
 5446           movlw   .1                      ;                                                                5526           bsf     a_licht                 ;
 5447           subwf   tastennummer,W          ;                                                                5527           LCDStrp qtext27                 ;"Flash −−> Eeprom"
 5448           bz      ee2flash05              ;                                                                5528           LCDStrp qtext12                 ;"OK        Abruch"
 5449           call    Tastaturstatus          ;                                                                5529   flash2ee001:                            ;
 5450           movlw   .2                      ;                                                                5530           call    Tastegedrueckt          ;
 5451           subwf   tastennummer,W          ;                                                                5531           bc      flash2ee001             ;
 5452           bz      ee2flash06              ;                                                                5532   flash2ee01:                             ;
 5453           call    Tastaturstatus          ;                                                                5533           call    Tastegedrueckt          ;
 5454           movlw   .3                      ;                                                                5534           bnc     flash2ee01              ;
 5455           subwf   tastennummer,W          ;                                                                5535           call    quittungston            ;Quittungston ausgeben
 5456           bz      ee2flash07              ;                                                                5536           call    Tastaturstatus          ;
 5457           call    Tastaturstatus          ;                                                                5537           movlw   .4                      ;
 5458           movlw   .4                      ;                                                                5538           subwf   tastennummer,W          ;
 5459           subwf   tastennummer,W          ;                                                                5539           bnz     flash2ee02              ;
 5460   ;........................................                                                                5540           return                          ;
 5461           POINT   0x7e00                  ;                                                                5541   flash2ee02:                             ;
 5462           bra     ee2flash08              ;                                                                5542   ;........................................
 5463   ;........................................                                                                5543           call    Tastaturstatus          ;
 5464   ee2flash05:                                                                                              5544           movlw   .1                      ;
 5465           POINT   0x7b00                  ;                                                                5545           subwf   tastennummer,W          ;
 5466           bra     ee2flash08              ;                                                                5546           bz      flash2ee03              ;
 5467   ;........................................                                                                5547           bra     flash2ee                ;
 5468   ee2flash06:                                                                                              5548   ;........................................
 5469           POINT   0x7c00                  ;                                                                5549   flash2ee03:                             ;
 5470           bra     ee2flash08              ;                                                                5550           call    Tastegedrueckt          ;
 5471   ;........................................                                                                5551           bc      flash2ee03              ;
 5472   ee2flash07:                                                                                              5552   ;........................................
 5473           POINT   0x7d00                  ;                                                                5553           LCDStrp qtext24                 ;"Speicherplatz   "
 5474   ;........................................                                                                5554           LCDStrp qtext25                 ;"1    2    3    4"
 5475   ee2flash08:                                                                                              5555   flash2ee04:                             ;
 5476           bcf     INTCON,GIE              ;Interrups sperren                                               5556           call    Tastegedrueckt          ;
 5477           bsf     bintsperren             ;Interrupt dauerhaft sperren                                     5557           bnc     flash2ee04              ;
 5478           clrf    schleife+2              ;256 Byte                                                        5558   ;........................................
 5479           clrf    data_ee_addr            ;bei Adresse 0 im Eeprom beginnen                                5559           call    quittungston            ;Quittungston ausgeben
 5480           lfsr    FSR0,flbuffer           ;zuerst in Ram speichern                                         5560           call    Tastaturstatus          ;
 5481   ee2flash09:                             ;SCHLEIFE(1)                                                     5561           movlw   .1                      ;
 5482           call    eread                   ; eeprom lesen                                                   5562           subwf   tastennummer,W          ;
 5483           movwf   POSTINC0                ; in Ram ablegen                                                 5563           bz      flash2ee05              ;
 5484           incf    data_ee_addr,F          ; adr+1                                                          5564           call    Tastaturstatus          ;
 5485           decfsz schleife+2,F             ;                                                                5565           movlw   .2                      ;
 5486           bra     ee2flash09              ;ENDE(1) nach 256 Byte                                           5566           subwf   tastennummer,W          ;
 5487   ;........................................                                                                5567           bz      flash2ee06              ;
 5488           lfsr    FSR0,flbuffer           ;                                                                5568           call    Tastaturstatus          ;
 5489   ee2flash10:                             ;                                                                5569           movlw   .3                      ;
 5490           rcall   flashwrite              ;                                                                5570           subwf   tastennummer,W          ;
 5491   ;........................................                                                                5571           bz      flash2ee07              ;
 5492           LCDStrp qtext17                 ;"finished!       "                                              5572           call    Tastaturstatus          ;
 5493           call    t1Sek                   ;                                                                5573           movlw   .4                      ;
 5494   ee2flash99:                             ;                                                                5574           subwf   tastennummer,W          ;
 5495           call    Tastegedrueckt          ;                                                                5575   ;........................................
 5496           bc      ee2flash99              ;                                                                5576           POINT   0x7e00                  ;
 5497           return                          ;                                                                5577           bra     flash2ee08              ;
 5498   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                               5578   ;........................................
 5499   flashwrite:                             ;                                                                5579   flash2ee05:                             ;
 5500           MOVLF   .32,PRODL               ;                                                                5580           POINT   0x7b00                  ;
 5501   flwrite02:                              ;                                                                5581           bra     flash2ee08              ;
 5502           movlw   b’11111000’             ;                                                                5582   ;........................................
 5503           andwf   TBLPTRL,F               ;                                                                5583   flash2ee06:                             ;
 5504           movlw   .8                      ;                                                                5584           POINT   0x7c00                  ;
 5505   flwrite01:                              ;SCHLEIFE(1)                                                     5585           bra     flash2ee08              ;
 5506           movff   POSTINC0,TABLAT         ;    Ram −> Wreg ,Adr + 1                                        5586   ;........................................
 5507           TBLWT*                          ;    TABLAT −> Zwischenspeicher, Adr + 1                         5587   flash2ee07:                             ;
 5508           TBLRD*+                         ;                                                                5588           POINT   0x7d00                  ;
 5509           decfsz WREG,F                   ;                                                                5589   ;........................................
 5510           bra     flwrite01               ;ENDE(1) PRODH == 0                                              5590   flash2ee08:                             ;
 5511           TBLRD*−                         ;zurueck in den Block                                            5591           call    urladungerweitert       ;
 5512           movlw   b’10000100’             ;                                                                5592   ;........................................
 5513           movwf   EECON1                  ;                                                                5593           LCDStrp qtext17                 ;"finished!       "
 5514           movlw   0x55                    ;                                                                5594           call    t1Sek                   ;
 5515           movwf   EECON2                  ;                                                                5595   flash2ee99:                             ;

Dienstag November 10, 2009                                                                              mc.pic                                                                                                   35/40
                                                                                                                                                                                                     Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                   Page 71/79            Nov 10, 09 8:32                                   mc.pic                                  Page 72/79
 5596           call    Tastegedrueckt          ;                                                                 5676           movwf   CAT_in_byte             ; Zeichen zwischenspeichern
 5597           bc      flash2ee99              ;                                                                 5677           movlw   LOW end_CAT_buffer+1    ; ? Test ob Pufferende erreicht
 5598           return                          ;                                                                 5678           subwf   FSR1L,W                 ;
 5599   ;=========================================================================                                5679           bnz     read_ptr_in_range       ;
 5600   leseeprom:                                                                                                5680           lfsr    1,start_CAT_buffer      ; 1 Wieder an den Anfang des Ringbuffers
 5601           LCDStrp qtext18                 ;"PC −−−> PIC RX "                                                5681   read_ptr_in_range:
 5602           LCDStrp qtext12                 ;"OK        Abruch"                                               5682           movff   FSR1L, FSRL_rs232_read ; Pointer merken
 5603   leseeprom01:                            ;                                                                 5683           movff   FSR1H, FSRH_rs232_read ;
 5604           call    Tastegedrueckt          ;                                                                 5684           movf    CAT_in_byte,W           ; Byte holen in WREG
 5605           bnc     leseeprom01             ;                                                                 5685           bsf     STATUS,C                ; Byte vorhanden C setzen
 5606           call    quittungston            ;Quittungston ausgeben                                            5686           return                          ;
 5607           call    Tastaturstatus          ;                                                                 5687   ;==============================================================================
 5608           movlw   .4                      ;                                                                 5688   swrmessen:                              ;SWR messen und darstellen
 5609           subwf   tastennummer,W          ;                                                                 5689           call    Tastegedrueckt          ;SCHLEIFE(1)
 5610           bnz     leseeprom02             ;                                                                 5690           bc      swrmessen               ;ENDE(1) keine Taste
 5611           return                          ;                                                                 5691           call    bin2ddstx               ;Sendefrequenz einstellen
 5612   leseeprom02:                            ;                                                                 5692           bsf     a_senderein             ;Sender einschalten
 5613           call    Tastaturstatus          ;                                                                 5693           bsf     a_tastungein            ;Sender tasten
 5614           movlw   .1                      ;                                                                 5694   ;       bsf     tonenable               ;Mithoerton ein
 5615           subwf   tastennummer,W          ;                                                                 5695           call    LCDDisplayClear         ;Display loeschen
 5616           bz      leseeprom03             ;                                                                 5696   swrm02:                                 ;SCHLEIFE(2)
 5617           bra     leseeprom               ;                                                                 5697           call    math_ramclr             ;
 5618   leseeprom03:                            ;                                                                 5698           MOVLF   .8,schleife+1           ;
 5619           call    LCDDisplayClear         ;                                                                 5699           CLR2    uvor                    ; Loeschen der Vor und Rueck
 5620           LCDStrp qtext18                 ;"PC −−−> PIC RX "                                                5700           CLR2    urueck                  ; Spannungen
 5621           bcf     INTCON,GIE              ;Interrups sperren                                                5701   swrm01:                                 ; SCHLEIFE(1)
 5622           bsf     bintsperren             ;Interrupt dauerhaft sperren                                      5702           call    umessvor                ;    Uvorwaertz messen
 5623           clrf    schleife+3              ;                                                                 5703           ADD2    uvor,mess               ;    Uvor aufaddieren
 5624           clrf    data_ee_addr            ;                                                                 5704           call    umessrueck              ;    Urueckwaertz messen
 5625   leseeprom04:                            ;                                                                 5705           ADD2    urueck,mess             ;    Urueck aufaddieren
 5626           movlw   0x40                    ;                                                                 5706           decfsz schleife+1,F             ; ENDE(1) 8 Durchlaeufe
 5627           call    LCDPos                  ;                                                                 5707           bra     swrm01                  ;
 5628           movf    data_ee_addr,W          ;                                                                 5708           CMP2    urueck,uvor             ; ? Urueck > Uvor
 5629           call    LCDHEX                  ;                                                                 5709           bnc     swrm05                  ;
 5630           call    LCDSpace                                                                                  5710           LDK2    faktor1,HIGH .9999,LOW .9999;
 5631           call    rs232rx                 ;                                                                 5711           bra     swrm06                  ;
 5632           movwf   data_ee_data            ;                                                                 5712   swrm05:
 5633           call    LCDHEX                  ;                                                                 5713           LD2     faktor1,uvor            ; Uges = Uvor + Urueck
 5634           call    ewrite                  ;                                                                 5714           CLR3    faktor1+2               ;
 5635           incf    data_ee_addr,F          ;                                                                 5715           ADD2    faktor1,urueck          ;
 5636           decfsz schleife+3,F             ;                                                                 5716           LDK2    faktor2,0,D’100’        ;
 5637           bra     leseeprom04             ;                                                                 5717           CLR5    faktor2+2               ;
 5638           LCDStrp qtext17                 ;"finished!       "                                               5718           call    mul5b                   ; Uges = Uges * 100
 5639           call    t5Sek                   ;                                                                 5719           LD5     faktor1,ergebnis        ;
 5640   leseeprom05:                            ;                                                                 5720           LD2     swr,ergebnis            ;
 5641           call    Tastegedrueckt          ;                                                                 5721           LD2     faktor2,uvor            ;
 5642           bc      leseeprom05             ;                                                                 5722           CLR3    faktor2+2               ;
 5643           return                                                                                            5723           SUB2    faktor2,urueck          ; Uges1 = Uvor − Urueck
 5644   ;=========================================================================                                5724           call    div5b                   ; SWR = Uges / Uges1
 5645   ;Initialisieren der UART Port RC6 bis RC7                                                                 5725           LD5     faktor1,ergebnis        ;
 5646   ;=========================================================================                                5726           LD2     swrmerke,ergebnis       ; SWR merken
 5647   baud9600:       equ     (((pictakt*d’1000’)/d’9600’)/d’64’)−1                                             5727   swrm06:
 5648                                                                                                             5728           call    hex2bcd5b               ; HEX in BCD wandeln
 5649   rs232init:                                                                                                5729           call    bcd2char6b              ; BCD in Char wandeln
 5650           movlw   baud9600        ;Setze Baudrate                                                           5730           MOVLF   .4,laenge               ; 3 stellige Anzeige
 5651           movwf   SPBRG                                                                                     5731           MOVLF   .2,komma                ; 2 Stelle hintern Komma
 5652           bcf     TXSTA,BRGH      ;keine baud rate high speed option                                        5732           clrf    kuerzen                 ; von rechts nichts kuerzen
 5653           bsf     TXSTA,TXEN      ;enable transmission                                                      5733           LCDStrp stext18                 ; "SWR="
 5654           bsf     RCSTA,CREN      ;enable reception                                                         5734           call    printf                  ; Formatiert ausgeben
 5655           bsf     RCSTA,SPEN      ;enable serial port                                                       5735           call    t10mSek                 ; einen Moment warten
 5656           return                                                                                            5736           LD2     faktor1,swrmerke        ; SWR = SWR / 10
 5657   ;==============================================================================                           5737           CLR3    faktor1+2               ;
 5658   ;Funktion       Auslesen des RS232 Empfangsbuffers und auswerten der Zeichen                              5738           MOVLF   .10,faktor2             ;
 5659   ;Eingang.       Auslesen des Empfangsbuffer Pointer in FSR1 bis Empfangsbuffer                            5739           CLR4    faktor2+1               ;
 5660   ;               keine Zeichen mehr enthaelt                                                               5740           call    div5b                   ;
 5661   ;Ausgang                                                                                                  5741           LDK2    faktor2,0,.10           ; SWR = SWR − 10
 5662   ;−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−−                           5742           SUB2    ergebnis,faktor2        ;
 5663   rxbuffer:                               ;                                                                 5743           LD2     swrmerke,ergebnis       ;
 5664           movff   FSRL_rs232_read, FSR1L ;Pointer laden                                                     5744           LD2     faktor1,ergebnis        ;
 5665           movff   FSRH_rs232_read, FSR1H ;                                                                  5745           CLR3    faktor1+2               ;
 5666   rxbuffer02:                             ;                                                                 5746           CLR4    faktor2+1               ;
 5667           movf    FSRL_rs232_write,W      ;? Pointer Schreiben von RS232 in Buffer                          5747           MOVLF   .3,faktor2              ; b1 = SWR / 3
 5668           subwf   FSR1L,W                 ; == Pointer Lesen aus Buffer                                     5748           call    div5b                   ;
 5669           bnz     rxbuffer01              ;                                                                 5749           movlw   .16                     ; ? b1 > 16
 5670           clrc                            ; kein Zeichen C loeschen                                         5750           subwf   ergebnis,W              ;
 5671           return                          ; Funktion wieder verlassen keine Zeichen                         5751           bnc     swrm07                  ;
 5672                                           ;                                                                 5752           MOVLF   .16,bargraph            ; 1 b1 = 16
 5673   rxbuffer01:                             ;                                                                 5753           CLR2    bargraph+1              ;    b2 = 0
 5674           bcf     bnofunktion             ;0 Zeitkritische Funktion startet                                 5754           bra     swrm08                  ;    b3 = 0
 5675           movf    POSTINC1,W              ; Lesen des Zeichens aus dem Buffer                               5755   swrm07:                                 ;

Dienstag November 10, 2009                                                                               mc.pic                                                                                                    36/40
                                                                                                                                                                                                       Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                  Page 73/79            Nov 10, 09 8:32                                     mc.pic                                 Page 74/79
 5756           movff    ergebnis,bargraph      ; 0 b3 = 16 − b1                                                 5836           movff    FSRH_rs232_write, FSR0H ;Pointer fuer Buffer in
 5757           movff    faktor1,bargraph+1     ;                                                                5837           movff    FSRL_rs232_write, FSR0L ;FSR0 laden
 5758           MOVLF    .16,faktor1            ;                                                                5838   get_RS232:
 5759           movf     bargraph,W             ;                                                                5839           btfss    PIR1,RCIF              ;?   liegen Bytes an RS232 an
 5760           subwf    faktor1,W              ;                                                                5840           bra      end_ISR_rs232          ;
 5761           movwf    bargraph+2             ;                                                                5841           movf     RCREG, W               ;1   Byte holen
 5762           tstfsz   bargraph+1             ;                                                                5842                                           ;
 5763           decf     bargraph+2,F           ;                                                                5843           btfss   RCSTA, OERR             ;    ? error
 5764   swrm08:                                 ;                                                                5844           bra     checkinrange            ;      −> alles ok
 5765           movlw   0x40                    ; Anfang 2. Zeile                                                5845           movf    RCREG, W                ;    1 Byte holen
 5766           call    LCDPos                  ;                                                                5846           bcf     RCSTA, CREN             ;      und OERR loeschen
 5767           tstfsz bargraph                 ; ? b1 != 0                                                      5847           bsf     RCSTA, CREN             ;
 5768           call    s3                      ; 1 Alle ||| ausgeben                                            5848           bra     get_RS232               ;
 5769           tstfsz bargraph+1               ; ? b2 != 0                                                      5849   checkinrange:                           ;
 5770           call    s12                     ; 1 | oder || ausgeben                                           5850           movwf   POSTINC0                ;    und in den Buffer speichern
 5771           tstfsz bargraph+2               ; ? b3 != 0                                                      5851           movlw   LOW end_CAT_buffer+1    ;
 5772           call    sleer                   ; 1 mit Leerzeichen auffuellen                                   5852           subwf   FSR0L,W                 ;    test above top limit
 5773           call    Tastegedrueckt          ; ? Taste gedrueckt                                              5853           bnz     write_ptr_in_range      ;
 5774           bc      swrm03                  ;                                                                5854           lfsr    0,start_CAT_buffer      ;
 5775           btfsc   e_strichpin             ; ? Keyer Strich gedrueckt                                       5855   write_ptr_in_range:                     ;
 5776           bra     swrm02                  ;ENDE(2) keine Taste gedrueckt + Keyerstrich                     5856           bra     get_RS232               ;
 5777   swrm03:                                 ;                                                                5857   end_ISR_rs232:                          ;
 5778           call    quittungston            ;Quittungston ausgeben                                           5858           movff   FSR0H, FSRH_rs232_write ;    Pointer merken
 5779           bcf     tonenable               ;Mithoerton ein                                                  5859           movff   FSR0L, FSRL_rs232_write ;
 5780           bcf     a_tastungein            ;Sender tasten                                                   5860
 5781           bcf     a_senderein             ;Sender einschalten                                              5861            btfss   INTCON,T0IF            ;Timer 0 (Tonausgabe)
 5782           call    bin2ddsrx               ;Empfangsfrequenz einstellen                                     5862            bra     ir1                    ;
 5783   swrm04:                                 ;SCHLEIFE(1)                                                     5863            bcf     INTCON,T0IF            ;Timer0 Bit loeschen
 5784           btfss   e_strichpin             ; ? Strichpin gedrueckt                                          5864            movff   tmr0const,TMR0L        ;
 5785           bra     swrm04                  ;                                                                5865            btfsc   tonenable              ;? Ton eingeschaltet
 5786           call    Tastegedrueckt          ; ? Taste gedrueckt                                              5866            btg     a_mton                 ;1 Ausgangsbit wechseln
 5787           bc      swrm04                  ;ENDE(1) keine Taste + keine Strichpin                           5867            btfss   tonenable              ;? Ton eingeschaltet
 5788           call    t100mSek                ;Wartezeit Entprellung                                           5868            bcf     a_mton                 ;0 Tonbit bei aus auf Low
 5789           return                          ;                                                                5869   ir1:
 5790   ;..............................................................................                          5870            btfss   INTCON,INT0IF          ;?   RB0 Interrupt durch Drehgeber
 5791   s3:                                     ;                                                                5871            bra     ir2                    ;
 5792           movff   bargraph,schleife       ;                                                                5872            btfss   INTCON2,INTEDG0        ;1   ? Impulsflanke
 5793   s301:                                   ;SCHLEIFE(1)                                                     5873            bra     ir2_3                  ;
 5794           movlw   6                       ; Zeichen |||                                                    5874            btfsc   e_DrehgeberD           ;    1 ? Drehrichtung links herum
 5795           call    LCDChar                 ; ausgeben                                                       5875            bra     ir2_1                  ;
 5796           decfsz schleife,F               ;ENDE(1) Schleife zuende                                         5876            decf    impulse,F              ;      1 Impulse =−1
 5797           bra     s301                    ;                                                                5877            bra     ir2_2                  ;
 5798           return                          ;                                                                5878   ir2_1:                                  ;
 5799   ;..............................................................................                          5879            incf    impulse,F              ;      0 Impulse =+1
 5800   s12:                                    ;                                                                5880            bra     ir2_2                  ;
 5801           movlw   3                       ;3 addieren                                                      5881   ir2_3:                                  ;
 5802           addwf   bargraph+1,F            ;                                                                5882            btfss   e_DrehgeberD           ;    0 ? Drehrichtung links herum
 5803           movf    bargraph+1,W            ;                                                                5883            bra     ir2_4                  ;
 5804           goto    LCDChar                 ;und | oder || ausgeben                                          5884            decf    impulse,F              ;      1 Impulse =−1
 5805   ;..............................................................................                          5885            bra     ir2_2                  ;
 5806   sleer:                                  ;                                                                5886   ir2_4:                                  ;
 5807           movf    bargraph+2,W            ;mit Leerzeichen                                                 5887            incf    impulse,F              ;      0 Impulse =+1
 5808           goto    LCDSpacel               ;auffuellen                                                      5888   ir2_2:
 5809   ;..............................................................................                          5889            btg     INTCON2,INTEDG0        ;    Impulsflanke wechseln
 5810   bandrs232:                                                                                               5890            bcf     INTCON,INT0IF          ;    Bit wieder bereit
 5811           btfss   bbandmode               ;? Band/Mode−umschaltung aktiv deaktiviert                       5891   ir2:                                    ;
 5812           return                          ;1 −−−> break beenden                                            5892            btfss   PIR1,TMR1IF            ;?   timer1 (verschiedene Timer)
 5813           movlw   0x80                    ;Kennung fuer Bandumschaltung                                    5893            bra     ir3                    ;
 5814           call    rs232tx                 ;auf RS232 ausgeben                                              5894            bcf     PIR1,TMR1IF            ;
 5815           movf    band,W                  ;Bandnummer                                                      5895            movf    zs1,F                  ;1   ? zs1 > 0
 5816           goto    rs232tx                 ;auf RS232 ausgeben                                              5896            bz      ir3_1                  ;
 5817   ;..............................................................................                          5897            decf    zs1,F                  ;    1 zs1 =−1
 5818   moders232:                                                                                               5898   ir3_1:
 5819           btfss   bbandmode               ;? Band/Mode−umschaltung aktiv deaktiviert                       5899            movf    zs2,F                  ;1 ? > 0
 5820           return                          ;1 −−−> break beenden                                            5900            bz      ir3_2                  ;
 5821           movlw   0x81                    ;Kennung fuer Modeumschaltung                                    5901            decf    zs2,F                  ; 1 zs2 =−1
 5822           call    rs232tx                 ;auf RS232 ausgeben                                              5902   ir3_2:                                  ;
 5823           movf    mode,W                  ;Mode vfoA                                                       5903            MOVLF   tmr1lconst,TMR1L       ; timer1 neu laden
 5824           goto    rs232tx                 ;auf RS232 ausgeben                                              5904            MOVLF   tmr1hconst,TMR1H       ;
 5825   ;##############################################################################                          5905   ir3:                                    ;
 5826                                                                                                            5906            btfsc   PIR2,EEIF              ;Eeprom write interrupt
 5827   ;;;;;;; Interruptbehandlung Hohe Prioritaet ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                          5907            bcf     PIR2,EEIF              ;
 5828                                                                                                            5908
 5829   interrupt1:                                                                                              5909            btfss   PIR1,TMR2IF            ;?   Timer 2 Interrupt (Punktlaenge)
 5830           movwf    W_TEMP                ;W_TEMP is in virtual bank                                        5910            bra     ir4                    ;
 5831           movff    STATUS, STATUS_TEMP   ;STATUS_TEMP located anywhere                                     5911            bcf     PIR1,TMR2IF            ;1   Bit loeschen
 5832           movff    BSR, BSR_TEMP         ;BSR located anywhere ;                                           5912            movf    zs3,F                  ;    ? zs3 > 0
 5833           movff    FSR0H, FSR0H_TEMP     ;FSR0 sichern                                                     5913            bz      ir4                    ;
 5834           movff    FSR0L, FSR0L_TEMP     ;                                                                 5914            decf    zs3,F                  ;    1 zs3 =−1
 5835                                                                                                            5915   ir4:

Dienstag November 10, 2009                                                                              mc.pic                                                                                                     37/40
                                                                                                                                                                                                      Printed by Andreas
 Nov 10, 09 8:32                                           mc.pic                         Page 75/79            Nov 10, 09 8:32                                          mc.pic                             Page 76/79
 5916             movff    FSR0H_TEMP, FSR0H         ;Restore     FSR0                                          5996
 5917             movff    FSR0L_TEMP, FSR0L         ;                                                          5997   qtext1:           DB      0x40,"X   X     on off",0
 5918             movff    BSR_TEMP,BSR              ;Restore     BSR                                           5998   qtext2:           DB      0x0 ,"Lightautomatic ",0
 5919             movf     W_TEMP,W                  ;Restore     WREG                                          5999   qtext3:           DB      0x0 ,"Light             ",0
 5920             movff    STATUS_TEMP,STATUS        ;Restore     STATUS                                        6000   qtext4:           DB      0x0 ,"S−Meter           ",0
 5921             retfie                                                                                        6001   qtext5:           DB      0x0 ,"1 Hz Resolution ",0
 5922                                                                                                           6002   qtext6:           DB      0x40,"<   >     X     ok",0
 5923   ;;;;;;; Interruptbehandlung niedrige Prioritaet ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                         6003   qtext7:           DB      0x0 ,"Keyer             ",0
 5924                                                                                                           6004   qtext8:           DB      0x0 ,"TX ZF permanent ",0
 5925   interrupt2:                                                                                             6005   qtext9:           DB      0x0 ,"Displayshift=0 ",0
 5926           movwf      W_TEMP                   ; W_TEMP is in virtual bank                                 6006   qtext10:          DB      0x40,"ok            next",0
 5927           movff      STATUS, STATUS_TEMP      ; STATUS_TEMP located anywhere                              6007   qtext11:          DB      0x0 ,"VFO = RXfrq − ZF",0
 5928           movff      BSR, BSR_TEMP            ; BSR located anywhere ;                                    6008   qtext12:          DB      0x40,"ok          cancel",0
 5929                                                                                                           6009   qtext13:          DB      0x0 ,"S0 = ",0
 5930           movff   BSR_TEMP, BSR           ; Restore BSR                                                   6010   qtext14:          DB      0x0 ,"S9 = ",0
 5931           movf    W_TEMP, W               ; Restore WREG                                                  6011   qtext15:          DB      0x0 ,"Save?             ",0
 5932           movff   STATUS_TEMP,STATUS      ; Restore STATUS                                                6012   qtext16:          DB      0x0 ,"PIC −−−> PC TX ",0
 5933           retfie                                                                                          6013   qtext17:          DB      0x40,"finished!         ",0
 5934   ;##############################################################################                         6014   qtext18:          DB      0x0 ,"PC −−−> PIC RX ",0
 5935   ;##############################################################################                         6015   qtext19:          DB      0x0 ,"Band/Mode aktiv ",0
 5936   ;##############################################################################                         6016   qtext20           DB      0x0 ,"VFOx4 I/Q Mixer ",0
 5937                                                                                                           6017   qtext21           DB      0x0 ,"SPOT= ",0
 5938   text1:             DB      0,    "V1.08 09.11.2009",0                                                   6018   qtext22           DB           " Hz",0
 5939                                                                                                           6019   qtext23:          DB      0x0 ,"Eeprom −−> Flash",0
 5940             if       bytevariante == .1;                                                                  6020   qtext24:          DB      0x0 ,"Memory space      ",0
 5941   text2:             DB      40H,"(c)DL4JAL Va:1      ",0                                                 6021   qtext25:          DB      0x40,"1     2     3    4",0
 5942             endif                                                                                         6022   qtext26:          DB      0x40,"                  ",0
 5943             if       bytevariante == .2;                                                                  6023   qtext27:          DB      0x0 ,"Flash −−> Eeprom",0
 5944   text2:             DB      40H,"(c)DL4JAL Va:2      ",0                                                 6024   qtext28:          DB      0x0 ,"Eeprom refresh ",0
 5945             endif                                                                                         6025   qtext29           DB      0x0 ,"TXhang= ",0
 5946             if       bytevariante == .3;                                                                  6026   qtext30           DB           " mS",0
 5947   text2:             DB      40H,"(c)DL4JAL Va:3      ",0                                                 6027
 5948             endif                                                                                         6028   tmode0:           DB      .13,"MHz",0
 5949             if       bytevariante == .21;                                                                 6029   tmode1:           DB      .13,"CW ",0
 5950   text2:             DB      40H,"(c)DL4JAL Va.21 ",0                                                     6030   tmode2:           DB      .13,"CWr",0
 5951             endif                                                                                         6031   tmode3:           DB      .13,"LSB",0
 5952             if       bytevariante == .22;                                                                 6032   tmode4:           DB      .13,"USB",0
 5953   text2:             DB      40H,"(c)DL4JAL Va.22 ",0                                                     6033   tmode5:           DB      .13,"DIG",0
 5954             endif                                                                                         6034   tmode6:           DB      .13,"DIr",0
 5955             if       bytevariante == .23;                                                                 6035
 5956   text2:             DB      40H,"(c)DL4JAL Va.23 ",0                                                     6036   text3:            DB      40H,"change frequenz",0
 5957           endif                                                                                           6037   text4:            DB      .8 ," Volt",0
 5958   ;...............................................                                                        6038   text5:            DB      40H,"WpM: ",0
 5959           if      (bytevariante == .1)||(bytevariante == .21);englisch                                    6039   text6:            DB      0 ,"Daten to Puffer ",0
 5960                                                                                                           6040
 5961   tlcd01:            DB      0x0   ,"AD9833/AD9834   ",0                                                  6041   text1po           DB      0,    "basic setting     ",0
 5962   tlcd02:            DB      0x0   ,"AD9850/51       ",0                                                  6042   text2po           DB      0,    "finish            ",0
 5963   tlcd03:            DB      0x0   ,"AD9851 PLL*6    ",0                                                  6043
 5964   tlcd04:            DB      0x0   ,"AD9951 PLL*4    ",0                                                  6044   ;                         Taste   2     3   4
 5965   tlcd05:            DB      0x0   ,"AD9951 PLL*5    ",0                                                  6045   menu1:            DB      40H,"1 A/B STEP RIT      ",0
 5966   tlcd06:            DB      0x0   ,"AD9951 PLL*20   ",0                                                  6046   menu2:            DB      40H,"2 A=B Spot 100k     ",0
 5967   tlcd07:            DB      0x0   ,"AD9951 no PLL   ",0                                                  6047   menu3:            DB      40H,"3 B=A Mem Lock      ",0
 5968                                                                                                           6048   menu4:            DB      40H,"4 SWR SET Ubat      ",0
 5969   stext:             DB      0x40,"SET           X ",0                                                    6049   menu5:            DB      40H,"5 CW LSB USB        ",0
 5970   stext1:            DB           "01 S−Meter     ",0                                                     6050   menu6:            DB      40H,"6 CWr DIG DIr       ",0
 5971   stext2:            DB           "02 Light auto ",0                                                      6051   menu7:            DB      40H,"7 Mess 160m 80m     ",0
 5972   stext3:            DB           "03 Light perm. ",0                                                     6052   menu8:            DB      40H,"8    60m 40m 30m    ",0
 5973   stext4:            DB           "04 Frq 1Hz     ",0                                                     6053   menu9:            DB      40H,"9    20m 17m 15m    ",0
 5974   stext5:            DB           "05 Keyer       ",0                                                     6054   menu10:           DB      40H,"10 12m 10m 6m       ",0
 5975   stext6:            DB           "06 TX ZF perm. ",0                                                     6055   menu11:           DB      40H,"11 2m tr1 tr2       ",0
 5976   stext7:            DB           "07 VFO=RXf−ZF ",0                                                      6056   menu12:           DB      40H,"12 tr3 tr4 tr5      ",0
 5977   stext7_1:          DB           "08 Band/Mode   ",0                                                     6057
 5978   stext7_2:          DB           "09 VFOx4 I/Qmix",0                                                     6058             endif
 5979   stext8:            DB           "10 DDS−Const    ",0                                                    6059
 5980   stext9:            DB           "11 ZF CW        ",0                                                    6060           if        (bytevariante == .2)||(bytevariante ==.3)||(bytevariante ==.22)||(bytevariante ==
 5981   stext9_1           DB           "12 ZF CW Revers ",0                                                           .23);deutsch
 5982   stext10:           DB           "13 ZF LSB       ",0                                                    6061
 5983   stext11:           DB           "14 ZF USB       ",0                                                    6062   tlcd01:           DB      0x0   ,"AD9833/AD9834   ",0
 5984   stext12:           DB           "15 ZF DIG       ",0                                                    6063   tlcd02:           DB      0x0   ,"AD9850/51       ",0
 5985   stext12_1:         DB           "16 ZF DIG Revers",0                                                    6064   tlcd03:           DB      0x0   ,"AD9851 PLL*6    ",0
 5986   stext13:           DB           "17 DDS Type   ",0                                                      6065   tlcd04:           DB      0x0   ,"AD9951 PLL*4    ",0
 5987   stext14:           DB           "18 LCDshift + RX",0                                                    6066   tlcd05:           DB      0x0   ,"AD9951 PLL*5    ",0
 5988   stext15:           DB           "19 Cal. S−Meter",0                                                     6067   tlcd06:           DB      0x0   ,"AD9951 PLL*20   ",0
 5989   stext15_1:         DB           "20 Spot adjust ",0                                                     6068   tlcd07:           DB      0x0   ,"AD9951 o. PLL   ",0
 5990   stext15_2:         DB           "21 TX hang time ",0                                                    6069
 5991   stext16:           DB           "22 Eepr. PIC−>PC",0                                                    6070   stext:            DB      0x40,"SET           X ",0
 5992   stext17:           DB           "23 Eepr. PC−>PIC",0                                                    6071   stext1:           DB           "01 S−Meter     ",0
 5993   stext17_1:         DB           "24 Eepr −> Flash",0                                                    6072   stext2:           DB           "02 Licht auto ",0
 5994   stext17_2:         DB           "25 Flash −> Eepr",0                                                    6073   stext3:           DB           "03 Licht perm. ",0
 5995   stext18:           DB      0x00,"SWR=",0                                                                6074   stext4:           DB           "04 Frq 1Hz     ",0

Dienstag November 10, 2009                                                                             mc.pic                                                                                                       38/40
                                                                                                                                                                                    Printed by Andreas
 Nov 10, 09 8:32                                       mc.pic            Page 77/79            Nov 10, 09 8:32                                       mc.pic                               Page 78/79
 6075   stext5:           DB           "05   Keyer       ",0                                   6155   ;                         Taste   2    3   4
 6076   stext6:           DB           "06   TX ZF perm. ",0                                   6156   menu1:            DB      40H,"1 A/B STEP RIT ",0
 6077   stext7:           DB           "07   VFO=RX−ZF   ",0                                   6157   menu2:            DB      40H,"2 A=B Mton 100k ",0
 6078   stext7_1:         DB           "08   Band/Mode   ",0                                   6158   menu3:            DB      40H,"3 B=A Mem Lock ",0
 6079   stext7_2:         DB           "09   VFOx4 I/Qmix",0                                   6159   menu4:            DB      40H,"4 SWR SET Ubat ",0
 6080   stext8:           DB           "10   DDS−Const    ",0                                  6160   menu5:            DB      40H,"5 CW LSB USB ",0
 6081   stext9:           DB           "11   ZF CW        ",0                                  6161             if      (bytevariante == .2)||(bytevariante ==.22)
 6082   stext9_1          DB           "12   ZF CW Revers ",0                                  6162   menu6:            DB      40H,"6 CWr DIG DIr ",0
 6083   stext10:          DB           "13   ZF LSB       ",0                                  6163             endif
 6084   stext11:          DB           "14   ZF USB       ",0                                  6164             if      (bytevariante == .3)||(bytevariante ==.23)
 6085   stext12:          DB           "15   ZF DIG       ",0                                  6165   menu6:            DB      40H,"6 CWr DIG FM ",0
 6086           if        (bytevariante ==   .2)||(bytevariante ==.22)                         6166             endif
 6087   stext12_1:        DB           "16   ZF DIG Revers",0                                  6167   menu7:            DB      40H,"7 Mess 160m   80m   ",0
 6088           endif                                                                          6168   menu8:            DB      40H,"8   60m 40m   30m   ",0
 6089           if        (bytevariante == .3)||(bytevariante ==.23)                           6169   menu9:            DB      40H,"9   20m 17m   15m   ",0
 6090   stext12_1:        DB           "16 ZF FM        ",0                                    6170   menu10:           DB      40H,"10 12m 10m     6m   ",0
 6091           endif                                                                          6171   menu11:           DB      40H,"11 2m tr1     tr2   ",0
 6092   stext13:          DB           "17 DDS Type   ",0                                      6172   menu12:           DB      40H,"12 tr3 tr4    tr5   ",0
 6093   stext14:          DB           "18 LCDshift + RX",0                                    6173
 6094   stext15:          DB           "19 Kal. S−Meter",0                                     6174             endif
 6095   stext15_1:        DB           "20 Mithoerton   ",0                                    6175
 6096   stext15_2:        DB           "21 TX hang time ",0                                    6176   ;##############################################################################
 6097   stext16:          DB           "22 Eepr. PIC−>PC",0                                    6177
 6098   stext17:          DB           "23 Eepr. PC−>PIC",0                                    6178                   ORG       0x7F00
 6099   stext17_1:        DB           "24 Eepr −> Flash",0                                    6179   mgrunddatenanf:
 6100   stext17_2:        DB           "25 Flash −> Eepr",0                                    6180   ;mddskonst_mstep:db      0c4h,01dh,0f3h,02ah,0x0,1       ;DDSTakt=100MHz Step=10Hz
 6101   stext18:          DB      0x00,"SWV=",0                                                6181   ;mddskonst_mstep:db      0a2h,07dh,08eh,0dch,0x17,1      ;DDSTakt=180MHz Step=10Hz
 6102                                                                                          6182   ;mddskonst_mstep:db      079h,0c0h,04fh,02fh,0xb,1       ;DDSTakt=24MHz Step=10Hz
 6103   qtext1:           DB      0x40,"X   X    on off",0                                     6183   mddskonst_mstep:db       017h,071h,0c7h,0bch,0x0a,1      ;DDSTakt=400MHz Step=10Hz
 6104   qtext2:           DB      0x0 ,"Lichtautomatik ",0                                     6184   mband_mflag:    db       .2,b’01010011’                  ;Startband, Flag
 6105   qtext3:           DB      0x0 ,"Licht            ",0                                   6185   mdsstype_mst    db       .6,.1                           ;DDS−Type, SenderEinTimer 10mSek
 6106   qtext4:           DB      0x0 ,"S−Meter          ",0                                   6186   mzfcw:          db       0x20,0xa1,0x07,0                ;ZF CW
 6107   qtext5:           DB      0x0 ,"1 Hz Aufloesung ",0                                    6187   mzfcwr:         db       0x20,0xa1,0x07,0                ;ZF CWr
 6108   qtext6:           DB      0x40,"<   >    X     ok",0                                   6188   mzflsb:         db       0x40,0x42,0x0f,0                ;ZF LSB
 6109   qtext7:           DB      0x0 ,"Keyer            ",0                                   6189   mzfusb:         db       0x60,0xe3,0x16,0                ;ZF USB
 6110   qtext8:           DB      0x0 ,"TX ZF permanent ",0                                    6190   mzfdig:         db       0x80,0x84,0x1e,0                ;ZF DIG
 6111   qtext9:           DB      0x0 ,"Displayshift=0 ",0                                     6191   mzfdigr         db       0x80,0x84,0x1e,0                ;ZF DIGr
 6112   qtext10:          DB      0x40,"ja         weiter",0                                   6192   mxsm:           db       0x93,0x07                       ;1939
 6113   qtext11:          DB      0x0 ,"VFO = RXfrq − ZF",0                                    6193   mysm            db       0,0                             ;0
 6114   qtext12:          DB      0x40,"OK         Abruch",0                                   6194   mt              db       .68,0                           ;Mithoerton, 1 Fuellbyte
 6115   qtext13:          DB      0x0 ,"S0 = ",0                                               6195   mmess:          db       0x80,0x96,0x98,0                ;10 MHz
 6116   qtext14:          DB      0x0 ,"S9 = ",0                                               6196                   db       0x80,0x96,0x98,0                ;10 MHz
 6117   qtext15:          DB      0x0 ,"Speichern?       ",0                                   6197                   db       0x00,0x00                       ;modeA mess modeB mess
 6118   qtext16:          DB      0x0 ,"PIC −−−> PC TX ",0                                     6198   m160m:          db       0x50,0x9e,0x1b,0                ;1,810 MHz
 6119   qtext17:          DB      0x40,"Fertig!          ",0                                   6199                   db       0x90,0x3a,0x1c,0                ;1,850 MHz
 6120   qtext18:          DB      0x0 ,"PC −−−> PIC RX ",0                                     6200                   db       0x01,0x03                       ;modeA CW modeB LSB
 6121   qtext19:          DB      0x0 ,"Band/Mode aktiv ",0                                    6201   m80m:           db       0x40,0x52,0x36,0                ;3,560 MHz
 6122   qtext20           DB      0x0 ,"VFOx4 I/Q Mixer ",0                                    6202                   db       0x20,0x75,0x38,0                ;3,700 MHz
 6123   qtext21           DB      0x0 ,"MT= ",0                                                6203                   db       0x01,0x03                       ;modeA CW modeB LSB
 6124   qtext22           DB           " Hz",0                                                 6204   m60m:           db       0x20,0x5c,0x51,0                ;5,332 MHz
 6125   qtext23:          DB      0x0 ,"Eeprom −−> Flash",0                                    6205                   db       0x20,0x5c,0x51,0                ;5,332 MHz
 6126   qtext24:          DB      0x0 ,"Speicherplatz    ",0                                   6206                   db       0x01,0x03                       ;modeA CW modeB LSB
 6127   qtext25:          DB      0x40,"1     2    3    4",0                                   6207   m40m:           db       0xf0,0x44,0x6b,0                ;7,03 MHz
 6128   qtext26:          DB      0x40,"                 ",0                                   6208                   db       0x60,0x56,0x6c,0                ;7,1 MHz
 6129   qtext27:          DB      0x0 ,"Flash −−> Eeprom",0                                    6209                   db       0x01,0x03                       ;modeA CW modeB LSB
 6130   qtext28:          DB      0x0 ,"Eepr.auffrischen",0                                    6210   m30m:           db       0x20,0x1d,0x9a,0                ;10,1 MHz
 6131   qtext29           DB      0x0 ,"TXhang= ",0                                            6211                   db       0x20,0x1d,0x9a,0                ;10,1 MHz
 6132   qtext30           DB           " mS",0                                                 6212                   db       0x01,0x04                       ;modeA CW modeB USB
 6133                                                                                          6213   m20m:           db       0xe0,0x89,0xd6,0                ;14,06 MHz
 6134   tmode0:           DB      .13,"MHz",0                                                  6214                   db       0xc0,0xac,0xd8,0                ;14,2 MHz
 6135   tmode1:           DB      .13,"CW ",0                                                  6215                   db       0x01,0x04                       ;modeA CW modeB USB
 6136   tmode2:           DB      .13,"CWr",0                                                  6216   m17m:           db       0x80,0x1f,0x14,1                ;18,096 MHz
 6137   tmode3:           DB      .13,"LSB",0                                                  6217                   db       0x80,0x1f,0x14,1                ;18,096 MHz
 6138   tmode4:           DB      .13,"USB",0                                                  6218                   db       0x01,0x04                       ;modeA CW modeB USB
 6139   tmode5:           DB      .13,"DIG",0                                                  6219   m15m:           db       0xa0,0x59,0x41,1                ;21,06 MHz
 6140             if      (bytevariante == .2)||(bytevariante ==.22)                           6220                   db       0x30,0xb9,0x42,1                ;21,15 MHz
 6141   tmode6:           DB      .13,"DIr",0                                                  6221                   db       0x01,0x04                       ;modeA CW modeB USB
 6142             endif                                                                        6222   m12m:           db       0x90,0xca,0x7b,1                ;24,89 MHz
 6143             if      (bytevariante == .3)||(bytevariante ==.23)                           6223                   db       0x90,0xca,0x7b,1                ;24,89 MHz
 6144   tmode6:           DB      .13,"FM ",0                                                  6224                   db       0x01,0x04                       ;modeA CW modeB USB
 6145             endif                                                                        6225   m10m:           db       0x60,0x29,0xac,1                ;28,060 MHz
 6146                                                                                          6226                   db       0xe0,0xd2,0xaf,1                ;28,300 MHz
 6147   text3:            DB      40H,"Bandwechsel    ",0                                      6227                   db       0x01,0x04                       ;modeA CW modeB USB
 6148   text4:            DB      .8 ," Volt",0                                                6228   m6m:            db       0x00,0x29,0xfc,2                ;50,08 MHz
 6149   text5:            DB      40H,"WpM: ",0                                                6229                   db       0x00,0x29,0xfc,2                ;50,08 MHz
 6150   text6:            DB      0 ,"Daten im Buffer ",0                                      6230                   db       0x01,0x04                       ;modeA CW modeB USB
 6151                                                                                          6231   m2m:            db       0xe0,0xd7,0x99,8                ;144,300 MHz
 6152   text1po           DB      0,   "Urladung        ",0                                    6232                   db       0xe0,0xd7,0x99,8                ;144,300 MHz
 6153   text2po           DB      0,   "Urladung beendet",0                                    6233                   db       0x01,0x04                       ;modeA CW modeB USB
 6154                                                                                          6234   mtv1:           db       0x00,0x3f,0xab,1                ;28 MHz

Dienstag November 10, 2009                                                            mc.pic                                                                                                      39/40
                                                                                                                  Printed by Andreas
 Nov 10, 09 8:32                                   mc.pic                                  Page 79/79
 6235                   db      0x00,0x3f,0xab,1                ;28 MHz
 6236                   db      0x01,0x04                       ;ModeA ModeB
 6237                   db      0,0,0,0,0,0                     ;LCD−Offset Flag
 6238   mtv2:           db      0x00,0x3f,0xab,1                ;28 MHz
 6239                   db      0x00,0x3f,0xab,1                ;28 MHz
 6240                   db      0x01,0x04                       ;ModeA ModeB
 6241                   db      0,0,0,0,0,0                     ;LCD−Offset Flag
 6242   mtv3:           db      0x00,0x3f,0xab,1                ;28 MHz
 6243                   db      0x00,0x3f,0xab,1                ;28 MHz
 6244                   db      0x01,0x04                       ;ModeA ModeB
 6245                   db      0,0,0,0,0,0                     ;LCD−Offset Flag
 6246   mtv4:           db      0x00,0x3f,0xab,1                ;28 MHz
 6247                   db      0x00,0x3f,0xab,1                ;28 MHz
 6248                   db      0x01,0x04                       ;ModeA ModeB
 6249                   db      0,0,0,0,0,0                     ;LCD−Offset Flag
 6250   mtv5:           db      0x00,0x3f,0xab,1                ;28 MHz
 6251                   db      0x00,0x3f,0xab,1                ;28 MHz
 6252                   db      0x01,0x04                       ;ModeA ModeB
 6253                   db      0,0,0,0,0,0                     ;LCD−Offset Flag
 6254                   db      0,0,0,0,0,version               ;letzte Address ist die Versionsnummer
 6255   ;##############################################################################
 6256
 6257          end




Dienstag November 10, 2009                                                                               mc.pic               40/40
